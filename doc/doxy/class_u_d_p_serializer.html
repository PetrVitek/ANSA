<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>INET Framework for OMNeT++/OMNEST: UDPSerializer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">INET Framework for OMNeT++/OMNEST</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_u_d_p_serializer.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">UDPSerializer Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="UDPSerializer" -->
<p><code>#include &lt;UDPSerializer.h&gt;</code></p>

<p><a href="class_u_d_p_serializer-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p_serializer.html#aceb678993f057d550163c108da36927d">UDPSerializer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p_serializer.html#af442bc00006930edf772c9edbd3fcbc3">serialize</a> (const UDPPacket *pkt, unsigned char *buf, unsigned int bufsize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p_serializer.html#a33ac27c3de4d8176edc2ce5e0c4b087c">parse</a> (const unsigned char *buf, unsigned int bufsize, UDPPacket *pkt)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Converts between UDPPacket and binary (network byte order) <a class="el" href="class_u_d_p.html">UDP</a> header. </p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aceb678993f057d550163c108da36927d"></a><!-- doxytag: member="UDPSerializer::UDPSerializer" ref="aceb678993f057d550163c108da36927d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UDPSerializer::UDPSerializer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a33ac27c3de4d8176edc2ce5e0c4b087c"></a><!-- doxytag: member="UDPSerializer::parse" ref="a33ac27c3de4d8176edc2ce5e0c4b087c" args="(const unsigned char *buf, unsigned int bufsize, UDPPacket *pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDPSerializer::parse </td>
          <td>(</td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>bufsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UDPPacket *&#160;</td>
          <td class="paramname"><em>pkt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Puts a packet sniffed from the wire into an UDPPacket. </p>

<p>Referenced by <a class="el" href="class_i_p_serializer.html#a1d1662f970e5537475f840bd228b413b">IPSerializer::parse()</a>.</p>
<div class="fragment"><pre class="fragment">{
    int32 size_common_header = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1common__header.html">common_header</a>);
    int32 size_init_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html">init_chunk</a>);
    int32 size_init_ack_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html">init_ack_chunk</a>);
    int32 size_data_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html">data_chunk</a>);
    int32 size_sack_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html">sack_chunk</a>);
    int32 size_heartbeat_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__chunk.html">heartbeat_chunk</a>);
    int32 size_heartbeat_ack_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__ack__chunk.html">heartbeat_ack_chunk</a>);
    int32 size_abort_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1abort__chunk.html">abort_chunk</a>);
    int32 size_cookie_echo_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1cookie__echo__chunk.html">cookie_echo_chunk</a>);
    uint16 paramType;
    int32 parptr, chunklen, cLen, woPadding;
    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1common__header.html">common_header</a> *<a class="code" href="struct_i_n_e_t_fw_1_1common__header.html">common_header</a> = (<span class="keyword">struct </span>common_header*) (buf);
    int32 tempChecksum = common_header-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1common__header.html#ad9a0af9b8746c7819868702a962fabea">checksum</a>;
    common_header-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1common__header.html#ad9a0af9b8746c7819868702a962fabea">checksum</a> = 0;
    int32 chksum = <a class="code" href="structcommon__header.html#aa26277b84373f48bbeca774cfb91bd6e">checksum</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)common_header, bufsize);
    common_header-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1common__header.html#ad9a0af9b8746c7819868702a962fabea">checksum</a> = tempChecksum;

    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *chunks = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) (buf + size_common_header);
    <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;SCTPSerializer::parse SCTPMessage\n&quot;</span>;
    <span class="keywordflow">if</span> (tempChecksum == chksum)
        dest-&gt;setChecksumOk(<span class="keyword">true</span>);
    <span class="keywordflow">else</span>
        dest-&gt;setChecksumOk(<span class="keyword">false</span>);
    <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;checksumOK=&quot;</span>&lt;&lt;dest-&gt;getChecksumOk()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
    dest-&gt;setSrcPort(ntohs(common_header-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1common__header.html#a16df1d45094b56d46256db05ebb39fc3">source_port</a>));
    dest-&gt;setDestPort(ntohs(common_header-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1common__header.html#a6b69320aeac29fa21ad450b2104336c1">destination_port</a>));
    dest-&gt;setTag(ntohl(common_header-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1common__header.html#a7405e47d14a91f6fa6558a25770b94b2">verification_tag</a>));
    dest-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
    <span class="comment">// chunks</span>
    uint32 chunkPtr = 0;

    <span class="comment">// catch ALL chunks - when a chunk is taken, the chunkPtr is set to the next chunk</span>
    <span class="keywordflow">while</span>(chunkPtr &lt; (bufsize - size_common_header))
    {
        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a> * <a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a> = (<span class="keyword">struct </span>chunk*)(chunks + chunkPtr);
        int32 chunkType = chunk-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html#a69925dfff6d4ce8883b99cfafed2ce27">type</a>;
<a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;chunkType=&quot;</span>&lt;&lt;chunkType&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
        woPadding = ntohs(chunk-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html#a022a582b013130ede9f353c628d32b49">length</a>);
<a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;chunk-&gt;length=&quot;</span>&lt;&lt;ntohs(chunk-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html#a022a582b013130ede9f353c628d32b49">length</a>)&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
        cLen = <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(woPadding);
        <span class="keywordflow">switch</span>(chunkType)
        {
            <span class="keywordflow">case</span> <a class="code" href="_consts80211_8h.html#ad70ed57eb996b190fc586f309107250ea9d7d6f31868d66330397c967c4afd2d2">DATA</a>:
            {
                ev&lt;&lt;<span class="stringliteral">&quot;Data received\n&quot;</span>;
                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html">data_chunk</a> *dc = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html">data_chunk</a>*) (chunks + chunkPtr);
                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;cLen=&quot;</span>&lt;&lt;cLen&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
                <span class="keywordflow">if</span>(cLen == 0)
                    <span class="keywordflow">throw</span> <span class="keyword">new</span> cRuntimeError(<span class="stringliteral">&quot;Incoming SCTP packet contains data chunk with length==0&quot;</span>);
                SCTPDataChunk *chunk = <span class="keyword">new</span> SCTPDataChunk(<span class="stringliteral">&quot;DATA&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                chunk-&gt;setUBit(dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a41dcf9feaa1ad2f81414ca7eab15e3b8">flags</a> &amp; UNORDERED_BIT);
                chunk-&gt;setBBit(dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a41dcf9feaa1ad2f81414ca7eab15e3b8">flags</a> &amp; BEGIN_BIT);
                chunk-&gt;setEBit(dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a41dcf9feaa1ad2f81414ca7eab15e3b8">flags</a> &amp; END_BIT);
                chunk-&gt;setTsn(ntohl(dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a25db3ec53867059f7ffe5b050a43ae14">tsn</a>));
                chunk-&gt;setSid(ntohs(dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a22aace84bd5e2295d4e706a55437cc1d">sid</a>));
                chunk-&gt;setSsn(ntohs(dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a240c6255e13bad8f6a7d41f5ec3559ef">ssn</a>));
                chunk-&gt;setPpid(ntohl(dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a379ae5a1ddc385ee44d98cffd39632ee">ppi</a>));
                chunk-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>*8);
                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;parse data: woPadding=&quot;</span>&lt;&lt;woPadding&lt;&lt;<span class="stringliteral">&quot; size_data_chunk=&quot;</span>&lt;&lt;size_data_chunk&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
                <span class="keywordflow">if</span>(woPadding &gt; size_data_chunk)
                {
                    SCTPSimpleMessage* msg=<span class="keyword">new</span> SCTPSimpleMessage(<span class="stringliteral">&quot;data&quot;</span>);
                    int32 datalen = (woPadding - size_data_chunk);
                    msg-&gt;setBitLength(datalen*8);
                    msg-&gt;setDataLen(datalen);
                    msg-&gt;setDataArraySize(datalen);
                    <span class="keywordflow">for</span>(int32 i=0; i&lt;datalen; i++)
                        msg-&gt;setData(i, dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a3747c423ac3fa73c5954351d1e38ded0">user_data</a>[i]);

                    chunk-&gt;encapsulate(msg);
                }
                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;datachunkLength=&quot;</span>&lt;&lt;chunk-&gt;getBitLength()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
                dest-&gt;addChunk(chunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a0cb1b2c6a7db1f1084886c98909a3f36">INIT</a>:
            {
                ev&lt;&lt;<span class="stringliteral">&quot;parse INIT\n&quot;</span>;
                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html">init_chunk</a> *<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html">init_chunk</a> = (<span class="keyword">struct </span>init_chunk*) (chunks + chunkPtr); <span class="comment">// (recvBuffer + size_ip + size_common_header);</span>
                chunklen = <a class="code" href="_s_c_t_p_association_8h.html#a685f1682f68294dbb12e7953e02748a0">SCTP_INIT_CHUNK_LENGTH</a>;
                SCTPInitChunk *chunk = <span class="keyword">new</span> SCTPInitChunk(<span class="stringliteral">&quot;INIT&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                chunk-&gt;setName(<span class="stringliteral">&quot;INIT&quot;</span>);
                chunk-&gt;setInitTag(ntohl(init_chunk-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#a7315d4164cc15995adf0bdec0511af1c">initiate_tag</a>));
                chunk-&gt;setA_rwnd(ntohl(init_chunk-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#a54cf1029a7b2d050336e4c76cd197654">a_rwnd</a>));
                chunk-&gt;setNoOutStreams(ntohs(init_chunk-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#a947a36c02bac8bb6549ad270fe51714e">mos</a>));
                chunk-&gt;setNoInStreams(ntohs(init_chunk-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#ae3094436bd6843ba61ab9b20f44e87f9">mis</a>));
                chunk-&gt;setInitTSN(ntohl(init_chunk-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#ad0e25ef59a88465391ed7ed5608f9b70">initial_tsn</a>));
                chunk-&gt;setAddressesArraySize(0);
                chunk-&gt;setUnrecognizedParametersArraySize(0);
                <span class="comment">//sctpEV3&lt;&lt;&quot;INIT arrived from wire\n&quot;;</span>
                <span class="keywordflow">if</span>(cLen &gt; size_init_chunk)
                {
                    int32 parcounter = 0, addrcounter = 0;
                    parptr = 0;
                    <span class="keywordtype">bool</span> stopProcessing = <span class="keyword">false</span>;
                    <span class="keywordflow">while</span>(cLen &gt; size_init_chunk+parptr &amp;&amp; !stopProcessing)
                    {
                        <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;Process INIT parameters\n&quot;</span>;
                        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a> *parameter = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a>*)(((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)init_chunk) + size_init_chunk + parptr);
                        paramType = ntohs(parameter-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#a0376609c5b5aeb16ae4840581987d033">type</a>);
                        <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;search for param &quot;</span>&lt;&lt;paramType&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
                        <span class="keywordflow">switch</span> (paramType)
                        {
                            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8d59686e974f326f12076166b80dcad1af17cc3bab233e3bca306ffc579984acc">SUPPORTED_ADDRESS_TYPES</a>:
                            {
                                <span class="keywordflow">break</span>;
                            }
                            <span class="keywordflow">case</span> <a class="code" href="sctp_8h.html#a42777cc0d8e665b540eb6edc1ee831dd">INIT_PARAM_IPV4</a>:
                            {
                                <span class="comment">// we supppose an ipv4 address parameter</span>
                                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;IPv4\n&quot;</span>;
                                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html">init_ipv4_address_parameter</a> *v4addr;
                                v4addr = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html">init_ipv4_address_parameter</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)init_chunk) + size_init_chunk + parptr);
                                chunk-&gt;setAddressesArraySize(++addrcounter);
                                <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> *localv4Addr;
                                localv4Addr = <span class="keyword">new</span> <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>(<span class="stringliteral">&quot;0.0.0.0&quot;</span>);
                                localv4Addr-&gt;<a class="code" href="class_i_pv_x_address.html#a723c95dd39fbdc72118f03eb386086fb">set</a>(ntohl(v4addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html#a9538c188df90d12ec2860698be2d2368">address</a>));
                                chunk-&gt;setAddresses(addrcounter-1, *localv4Addr);
                                chunklen += 8;
                                <span class="keywordflow">break</span>;
                            }
                            <span class="keywordflow">case</span> <a class="code" href="sctp_8h.html#a5e8308210ed9cdacf7346535647bbb00">INIT_PARAM_IPV6</a>:
                            {
                                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;IPv6\n&quot;</span>;
                                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html">init_ipv6_address_parameter</a> *ipv6addr;
                                ipv6addr = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html">init_ipv6_address_parameter</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)init_chunk) + size_init_chunk + parptr);
                                <a class="code" href="class_i_pv6_address.html">IPv6Address</a> ipv6Addr = <a class="code" href="class_i_pv6_address.html">IPv6Address</a>(ipv6addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html#adfb4cf9aa03f83ebf1636acd6e501af4">address</a>[0], ipv6addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html#adfb4cf9aa03f83ebf1636acd6e501af4">address</a>[1],
                                                                    ipv6addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html#adfb4cf9aa03f83ebf1636acd6e501af4">address</a>[2], ipv6addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html#adfb4cf9aa03f83ebf1636acd6e501af4">address</a>[3]);
                                <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> *localv6Addr;
                                localv6Addr = <span class="keyword">new</span> <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>(<span class="stringliteral">&quot;0:0:0:0:0:0:0:0&quot;</span>);
                                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;address&quot;</span>&lt;&lt;ipv6Addr&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
                                localv6Addr-&gt;<a class="code" href="class_i_pv_x_address.html#a723c95dd39fbdc72118f03eb386086fb">set</a>(ipv6Addr);
                                chunk-&gt;setAddressesArraySize(++addrcounter);
                                chunk-&gt;setAddresses(addrcounter-1, *localv6Addr);
                                chunklen += 20;
                                <span class="keywordflow">break</span>;
                            }
                            <span class="keywordflow">default</span>:
                            {
                                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;ExtInterface: Unknown SCTP INIT parameter type &quot;</span> &lt;&lt; paramType&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
                                uint16 skip = (paramType &amp; 0x8000) &gt;&gt; 15;
                                <span class="keywordflow">if</span> (skip == 0)
                                    stopProcessing = <span class="keyword">true</span>;
                                uint16 report = (paramType &amp; 0x4000) &gt;&gt; 14;
                                <span class="keywordflow">if</span> (report != 0)
                                {
                                    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a> *unknown;
                                    unknown = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)init_chunk) + size_init_chunk + parptr);
                                    uint32 unknownLen=chunk-&gt;getUnrecognizedParametersArraySize();
                                    chunk-&gt;setUnrecognizedParametersArraySize(unknownLen+<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(ntohs(unknown-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ad8504a2c0218d4213b377e2ddb240a9c">length</a>)));
                                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1data__vector.html">data_vector</a>* dv = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1data__vector.html">data_vector</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)init_chunk) + size_init_chunk + parptr);

                                    <span class="keywordflow">for</span> (uint32 i=unknownLen; i&lt;unknownLen+<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(ntohs(unknown-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ad8504a2c0218d4213b377e2ddb240a9c">length</a>)); i++)
                                        chunk-&gt;setUnrecognizedParameters(i,dv-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__vector.html#afde96dce63b62a4c06a7deb55600afff">data</a>[i-unknownLen]);
                                }
                                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;stopProcessing=&quot;</span>&lt;&lt;stopProcessing&lt;&lt;<span class="stringliteral">&quot; report=&quot;</span>&lt;&lt;report&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
                                <span class="keywordflow">break</span>;
                            }
                        }
                        parptr += <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(ntohs(parameter-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ad8504a2c0218d4213b377e2ddb240a9c">length</a>));
                        parcounter++;
                    }


                }
                chunk-&gt;setBitLength(chunklen*8);
                dest-&gt;addChunk(chunk);
                <span class="comment">//chunkPtr += cLen;</span>
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12abb473557985d30fdf16d2525388e3a22">INIT_ACK</a>:
            {
                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html">init_ack_chunk</a> *iac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html">init_ack_chunk</a>*) (chunks + chunkPtr);
                chunklen = <a class="code" href="_s_c_t_p_association_8h.html#a685f1682f68294dbb12e7953e02748a0">SCTP_INIT_CHUNK_LENGTH</a>;
                SCTPInitAckChunk *chunk = <span class="keyword">new</span> SCTPInitAckChunk(<span class="stringliteral">&quot;INIT_ACK&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                chunk-&gt;setInitTag(ntohl(iac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html#a7a54bd2ed88345cdb5c902f56bc8d3c7">initiate_tag</a>));
                chunk-&gt;setA_rwnd(ntohl(iac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html#aa95033ee21e5290df42be51a8b696679">a_rwnd</a>));
                chunk-&gt;setNoOutStreams(ntohs(iac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html#af32685d03e6d9489916b3e6824261ac5">mos</a>));
                chunk-&gt;setNoInStreams(ntohs(iac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html#af18c98e1baef7393f88d5141b17e0c91">mis</a>));
                chunk-&gt;setInitTSN(ntohl(iac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html#af9294b9a9ff18b46973e93b122b74413">initial_tsn</a>));
                chunk-&gt;setUnrecognizedParametersArraySize(0);
                <span class="keywordflow">if</span>(cLen &gt; size_init_ack_chunk)
                {
                    int32 parcounter = 0, addrcounter = 0;
                    parptr = 0;
                    <span class="keywordtype">bool</span> stopProcessing = <span class="keyword">false</span>;
                    <span class="comment">//sctpEV3&lt;&lt;&quot;cLen=&quot;&lt;&lt;cLen&lt;&lt;&quot;\n&quot;;</span>
                    <span class="keywordflow">while</span>(cLen &gt; size_init_ack_chunk+parptr &amp;&amp; !stopProcessing)
                    {
                        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a> *parameter = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a>*)(((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)iac) + size_init_ack_chunk + parptr);
                        paramType = ntohs(parameter-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#a0376609c5b5aeb16ae4840581987d033">type</a>);
                        <span class="comment">//sctpEV3&lt;&lt;&quot;ParamType = &quot;&lt;&lt;paramType&lt;&lt;&quot; parameterLength=&quot;&lt;&lt;ntohs(parameter-&gt;length)&lt;&lt;&quot;\n&quot;;</span>
                        <span class="keywordflow">switch</span> (paramType)
                        {
                            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8d59686e974f326f12076166b80dcad1af17cc3bab233e3bca306ffc579984acc">SUPPORTED_ADDRESS_TYPES</a>:
                            {
                                <span class="keywordflow">break</span>;
                            }
                            <span class="keywordflow">case</span> <a class="code" href="sctp_8h.html#a42777cc0d8e665b540eb6edc1ee831dd">INIT_PARAM_IPV4</a>:
                            {
                                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;parse IPv4\n&quot;</span>;
                                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html">init_ipv4_address_parameter</a> *v4addr;
                                v4addr = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html">init_ipv4_address_parameter</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)iac) + size_init_ack_chunk + parptr);
                                chunk-&gt;setAddressesArraySize(++addrcounter);
                                <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> *localv4Addr;
                                localv4Addr = <span class="keyword">new</span> <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>(<span class="stringliteral">&quot;0.0.0.0&quot;</span>);
                                localv4Addr-&gt;<a class="code" href="class_i_pv_x_address.html#a723c95dd39fbdc72118f03eb386086fb">set</a>(ntohl(v4addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html#a9538c188df90d12ec2860698be2d2368">address</a>));
                                chunk-&gt;setAddresses(addrcounter-1, *localv4Addr);
                                chunklen += 8;
                                <span class="keywordflow">break</span>;
                            }
                            <span class="keywordflow">case</span> <a class="code" href="sctp_8h.html#a5e8308210ed9cdacf7346535647bbb00">INIT_PARAM_IPV6</a>:
                            {
                                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;IPv6\n&quot;</span>;
                                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html">init_ipv6_address_parameter</a> *ipv6addr;
                                ipv6addr = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html">init_ipv6_address_parameter</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)iac) + size_init_chunk + parptr);
                                <a class="code" href="class_i_pv6_address.html">IPv6Address</a> ipv6Addr = <a class="code" href="class_i_pv6_address.html">IPv6Address</a>(ipv6addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html#adfb4cf9aa03f83ebf1636acd6e501af4">address</a>[0], ipv6addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html#adfb4cf9aa03f83ebf1636acd6e501af4">address</a>[1],
                                                                    ipv6addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html#adfb4cf9aa03f83ebf1636acd6e501af4">address</a>[2], ipv6addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv6__address__parameter.html#adfb4cf9aa03f83ebf1636acd6e501af4">address</a>[3]);
                                <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> *localv6Addr;
                                localv6Addr = <span class="keyword">new</span> <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>(<span class="stringliteral">&quot;0:0:0:0:0:0:0:0&quot;</span>);
                                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;address&quot;</span>&lt;&lt;ipv6Addr&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
                                localv6Addr-&gt;<a class="code" href="class_i_pv_x_address.html#a723c95dd39fbdc72118f03eb386086fb">set</a>(ipv6Addr);

                                chunk-&gt;setAddressesArraySize(++addrcounter);
                                chunk-&gt;setAddresses(addrcounter-1, *localv6Addr);
                                chunklen += 20;
                                <span class="keywordflow">break</span>;
                            }
                            <span class="keywordflow">case</span> <a class="code" href="sctp_8h.html#a34127e7f145642fb19969a905c0511dc">INIT_PARAM_COOKIE</a>:
                            {
                                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a> *cookie = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)iac) + size_init_ack_chunk + parptr);
                                int32 cookieLen = ntohs(cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ad8504a2c0218d4213b377e2ddb240a9c">length</a>) - 4;
                                <span class="comment">// put cookie data into chunk (char array cookie)</span>
                                chunk-&gt;setCookieArraySize(cookieLen);
                                <span class="keywordflow">for</span>(int32 i=0; i&lt;cookieLen; i++)
                                    chunk-&gt;setCookie(i, cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ab0de063235e7569ee8c41a4d3f94312c">value</a>[i]);
                                chunklen+=cookieLen+4;
                                <span class="keywordflow">break</span>;
                            }
                            <span class="keywordflow">default</span>:
                            {
                                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;ExtInterface: Unknown SCTP INIT-ACK parameter type &quot;</span> &lt;&lt; paramType&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
                                uint16 skip = (paramType &amp; 0x8000) &gt;&gt; 15;
                                <span class="keywordflow">if</span> (skip == 0)
                                    stopProcessing = <span class="keyword">true</span>;
                                uint16 report = (paramType &amp; 0x4000) &gt;&gt; 14;
                                <span class="keywordflow">if</span> (report != 0)
                                {
                                    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a> *unknown;
                                    unknown = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)iac) + size_init_ack_chunk + parptr);
                                    uint32 unknownLen=chunk-&gt;getUnrecognizedParametersArraySize();
                                    chunk-&gt;setUnrecognizedParametersArraySize(unknownLen+<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(ntohs(unknown-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ad8504a2c0218d4213b377e2ddb240a9c">length</a>)));
                                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1data__vector.html">data_vector</a>* dv = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1data__vector.html">data_vector</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)iac) + size_init_ack_chunk + parptr);

                                    <span class="keywordflow">for</span> (uint32 i=unknownLen; i&lt;unknownLen+<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(ntohs(unknown-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ad8504a2c0218d4213b377e2ddb240a9c">length</a>)); i++)
                                        chunk-&gt;setUnrecognizedParameters(i,dv-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__vector.html#afde96dce63b62a4c06a7deb55600afff">data</a>[i-unknownLen]);
                                }
                                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;stopProcessing=&quot;</span>&lt;&lt;stopProcessing&lt;&lt;<span class="stringliteral">&quot;  report=&quot;</span>&lt;&lt;report&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;

                                <span class="keywordflow">break</span>;
                            }
                        }
                        parptr += <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(ntohs(parameter-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ad8504a2c0218d4213b377e2ddb240a9c">length</a>));
                        <span class="comment">//sctpEV3&lt;&lt;&quot;parptr=&quot;&lt;&lt;parptr&lt;&lt;&quot;\n&quot;;</span>
                        parcounter++;
                    }
                }
                chunk-&gt;setBitLength(chunklen*8);
                dest-&gt;addChunk(chunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a689bf9c7470080fd0180eb7f5c293bd4">SACK</a>:
            {
                ev&lt;&lt;<span class="stringliteral">&quot;SCTPMessage: SACK received\n&quot;</span>;
                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html">sack_chunk</a> *sac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html">sack_chunk</a>*) (chunks + chunkPtr);
                SCTPSackChunk *chunk = <span class="keyword">new</span> SCTPSackChunk(<span class="stringliteral">&quot;SACK&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                uint32 cumtsnack = ntohl(sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html#a561d6bef13b80381e25a0712b3b283a0">cum_tsn_ack</a>);
                chunk-&gt;setCumTsnAck(cumtsnack);
                chunk-&gt;setA_rwnd(ntohl(sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html#a9d989ff6f677f8d5afcbbe2d73ece439">a_rwnd</a>));

                int32 ngaps = ntohs(sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html#addf4a98ed2d76970afe2a63340a95f00">nr_of_gaps</a>);
                int32 ndups = ntohs(sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html#a36b9ecced9fc135bc8906b8d5a58c7ed">nr_of_dups</a>);
                chunk-&gt;setNumGaps(ngaps);
                chunk-&gt;setNumDupTsns(ndups);

                chunk-&gt;setGapStartArraySize(ngaps);
                chunk-&gt;setGapStopArraySize(ngaps);
                chunk-&gt;setDupTsnsArraySize(ndups);

                <span class="keywordflow">for</span>(int32 i=0; i&lt;ngaps; i++)
                {
                    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html">sack_gap</a> *gap = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html">sack_gap</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)sac) + size_sack_chunk + i*<span class="keyword">sizeof</span>(<a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html">sack_gap</a>));
                    chunk-&gt;setGapStart(i, ntohs(gap-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html#a06092a86c2ef2a22d5412e2d7096563f">start</a>) + cumtsnack);
                    chunk-&gt;setGapStop(i, ntohs(gap-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html#aff0a1d1c21dd6d36e7b0fff135c93e23">stop</a>) + cumtsnack);
                }
                <span class="keywordflow">for</span>(int32 i=0; i&lt;ndups; i++)
                {
                    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__duptsn.html">sack_duptsn</a> *dup = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__duptsn.html">sack_duptsn</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)sac) + size_sack_chunk + ngaps*<span class="keyword">sizeof</span>(<a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html">sack_gap</a>) + i*<span class="keyword">sizeof</span>(<a class="code" href="struct_i_n_e_t_fw_1_1sack__duptsn.html">sack_duptsn</a>));
                    chunk-&gt;setDupTsns(i, ntohl(dup-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__duptsn.html#a264c16210059305d5716d62f3f44366e">tsn</a>));
                }

                chunk-&gt;setBitLength(cLen*8);
                dest-&gt;addChunk(chunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a0f286b0bbc1ee4f20be5136a55cf8923">HEARTBEAT</a>:
            {
                <span class="comment">//sctpEV3&lt;&lt;&quot;SCTPMessage: Heartbeat received\n&quot;;</span>
                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__chunk.html">heartbeat_chunk</a> *hbc = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__chunk.html">heartbeat_chunk</a>*) (chunks + chunkPtr);
                SCTPHeartbeatChunk *chunk = <span class="keyword">new</span> SCTPHeartbeatChunk(<span class="stringliteral">&quot;HEARTBEAT&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                <span class="keywordflow">if</span>(cLen &gt; size_heartbeat_chunk)
                {
                    int32 parcounter = 0;
                    parptr = 0;
                    <span class="keywordflow">while</span>(cLen &gt; size_heartbeat_chunk+parptr)
                    {
                        <span class="comment">// we supppose type 1 here</span>
                        <span class="comment">//sctpEV3&lt;&lt;&quot;HB-chunk+parptr=&quot;&lt;&lt;size_heartbeat_chunk+parptr&lt;&lt;&quot;\n&quot;;</span>
                        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html">heartbeat_info</a> *hbi = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html">heartbeat_info</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)hbc) + size_heartbeat_chunk + parptr);
                        <span class="keywordflow">if</span>(ntohs(hbi-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html#a9c496e01fb626983dd7449c4d299c4dd">type</a>) == 1) <span class="comment">// sender specific hb info</span>
                        {
                            <span class="comment">//sctpEV3&lt;&lt;&quot;HBInfo\n&quot;;</span>
                            int32 infoLen = ntohs(hbi-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html#a165225a4bed745a098ebc07d514b0a62">length</a>) - 4;
                            parptr += <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(infoLen) + 4;
                            parcounter++;
                            chunk-&gt;setInfoArraySize(infoLen);
                            <span class="keywordflow">for</span>(int32 i=0; i&lt;infoLen; i++)
                                chunk-&gt;setInfo(i, <a class="code" href="sctp_8h.html#a35a07f4d1137779b208b608ac62f7561">HBI_INFO</a>(hbi)[i]);
                        }
                        <span class="keywordflow">else</span>
                        {
                            parptr += <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(ntohs(hbi-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html#a165225a4bed745a098ebc07d514b0a62">length</a>));  <span class="comment">// set pointer forwards with count of bytes in length field of TLV</span>
                            parcounter++;
                            <span class="keywordflow">continue</span>;
                        }
                    }
                }
                chunk-&gt;setBitLength(cLen*8);
                dest-&gt;addChunk(chunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a5621dd83f6f32ee90c0d505867c67b71">HEARTBEAT_ACK</a>:
            {
                ev&lt;&lt;<span class="stringliteral">&quot;SCTPMessage: Heartbeat_Ack received\n&quot;</span>;
                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__ack__chunk.html">heartbeat_ack_chunk</a> *hbac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__ack__chunk.html">heartbeat_ack_chunk</a>*) (chunks + chunkPtr);
                SCTPHeartbeatAckChunk *chunk = <span class="keyword">new</span> SCTPHeartbeatAckChunk(<span class="stringliteral">&quot;HEARTBEAT_ACK&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                <span class="keywordflow">if</span>(cLen&gt;size_heartbeat_ack_chunk)
                {
                    int32 parcounter = 0;
                    parptr = 0;
                    <span class="keywordflow">while</span>(cLen &gt; size_heartbeat_ack_chunk+parptr)
                    {
                        <span class="comment">// we supppose type 1 here, the same provided in heartbeat chunks</span>
                        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html">heartbeat_info</a> *hbi = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html">heartbeat_info</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)hbac) + size_heartbeat_ack_chunk + parptr);
                        <span class="keywordflow">if</span>(ntohs(hbi-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html#a9c496e01fb626983dd7449c4d299c4dd">type</a>) == 1) <span class="comment">// sender specific hb info</span>
                        {
                            parptr += <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html">heartbeat_info</a>);
                            parcounter++;
                            chunk-&gt;setRemoteAddr(<a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>(ntohl(<a class="code" href="sctp_8h.html#aed9342dc5ddcea1e525b7b449fab35a3">HBI_ADDR</a>(hbi))));
                            chunk-&gt;setTimeField(ntohl((uint32)<a class="code" href="sctp_8h.html#a350cf5878ce2f8cb42cca735e0f99c1d">HBI_TIME</a>(hbi)));
                        }
                        <span class="keywordflow">else</span>
                        {
                            parptr += ntohs(hbi-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html#a165225a4bed745a098ebc07d514b0a62">length</a>);   <span class="comment">// set pointer forwards with count of bytes in length field of TLV</span>
                            parcounter++;
                            <span class="keywordflow">continue</span>;
                        }

                    }
                }
                chunk-&gt;setBitLength(cLen*8);
                dest-&gt;addChunk(chunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a781ad2788df9e25c59a70894c7832096">ABORT</a>:
            {
                ev&lt;&lt;<span class="stringliteral">&quot;SCTPMessage: Abort received\n&quot;</span>;
                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1abort__chunk.html">abort_chunk</a> *ac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1abort__chunk.html">abort_chunk</a>*) (chunks + chunkPtr);
                cLen = ntohs(ac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1abort__chunk.html#ac0550cef90bd35ba1bf8430ee783743d">length</a>);
                SCTPAbortChunk *chunk = <span class="keyword">new</span> SCTPAbortChunk(<span class="stringliteral">&quot;ABORT&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                chunk-&gt;setT_Bit(ac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1abort__chunk.html#af7c6588f89c568b6ca8dcf40cb32daf7">flags</a> &amp; T_BIT);
                <span class="keywordflow">if</span>(cLen&gt;size_abort_chunk)
                {
                    <span class="comment">// TODO: handle attached error causes</span>
                }
                chunk-&gt;setBitLength(cLen*8);
                dest-&gt;addChunk(chunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12ac6c3901afa866152be0e645c2c38f471">COOKIE_ECHO</a>:
            {
                SCTPCookieEchoChunk *chunk = <span class="keyword">new</span> SCTPCookieEchoChunk(<span class="stringliteral">&quot;COOKIE_ECHO&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;Parse Cookie-Echo\n&quot;</span>;
                <span class="keywordflow">if</span>(cLen&gt;size_cookie_echo_chunk)
                {
                    int32 cookieSize = woPadding-size_cookie_echo_chunk;
                    <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;cookieSize=&quot;</span>&lt;&lt;cookieSize&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
                    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html">cookie_parameter</a> *cookie = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html">cookie_parameter</a>*)(chunks+chunkPtr+4);
                    SCTPCookie* stateCookie = <span class="keyword">new</span> SCTPCookie();
                    stateCookie-&gt;setCreationTime(ntohl(cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html#a96b0f36a38c9886943c75ba5b29c0ef0">creationTime</a>));
                    stateCookie-&gt;setLocalTag(ntohl(cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html#a023a4299beb2cfb28dd2ef1dfd0478c7">localTag</a>));
                    stateCookie-&gt;setPeerTag(ntohl(cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html#a648153b48ec8424e1f72ff921b8a644d">peerTag</a>));
                    stateCookie-&gt;setLocalTieTagArraySize(32);
                    stateCookie-&gt;setPeerTieTagArraySize(32);
                    <span class="keywordflow">for</span>(int32 i=0; i&lt;32; i++)
                    {
                        stateCookie-&gt;setLocalTieTag(i, cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html#ad99c0071b11d8dfd434ec386226611f7">localTieTag</a>[i]);
                        stateCookie-&gt;setPeerTieTag(i, cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html#a34286a6e985ef4527a947f4199333dc0">peerTieTag</a>[i]);
                    }
                    stateCookie-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a3aeb03eaba88c9681ecb920f24c689d2">SCTP_COOKIE_LENGTH</a>*8);
                    chunk-&gt;setStateCookie(stateCookie);
                }
                chunk-&gt;setBitLength(woPadding*8);
                dest-&gt;addChunk(chunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a8cb5544ff09ee0b2ae1f1171de9597bd">COOKIE_ACK</a>:
            {
                ev&lt;&lt;<span class="stringliteral">&quot;SCTPMessage: Cookie_Ack received\n&quot;</span>;
                SCTPCookieAckChunk *chunk = <span class="keyword">new</span> SCTPCookieAckChunk(<span class="stringliteral">&quot;COOKIE_ACK&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                chunk-&gt;setBitLength(cLen*8);
                dest-&gt;addChunk(chunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a7690b021f467450541d8d89123429d40">SHUTDOWN</a>:
            {
                ev&lt;&lt;<span class="stringliteral">&quot;SCTPMessage: Shutdown received\n&quot;</span>;
                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1shutdown__chunk.html">shutdown_chunk</a> *sc = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1shutdown__chunk.html">shutdown_chunk</a>*) (chunks + chunkPtr);
                SCTPShutdownChunk *chunk = <span class="keyword">new</span> SCTPShutdownChunk(<span class="stringliteral">&quot;SHUTDOWN&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                uint32 cumtsnack = ntohl(sc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1shutdown__chunk.html#a294183dee80de069c3e9583ff376b791">cumulative_tsn_ack</a>);
                chunk-&gt;setCumTsnAck(cumtsnack);
                chunk-&gt;setBitLength(cLen*8);
                dest-&gt;addChunk(chunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a7f11b152058ba8f4656266d735a50c4b">SHUTDOWN_ACK</a>:
            {
                ev&lt;&lt;<span class="stringliteral">&quot;SCTPMessage: ShutdownAck received\n&quot;</span>;
                SCTPShutdownAckChunk *chunk = <span class="keyword">new</span> SCTPShutdownAckChunk(<span class="stringliteral">&quot;SHUTDOWN_ACK&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                chunk-&gt;setBitLength(cLen*8);
                dest-&gt;addChunk(chunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a1ac9ae29771c5095efe16ce822d561d7">SHUTDOWN_COMPLETE</a>:
            {
                ev&lt;&lt;<span class="stringliteral">&quot;SCTPMessage: ShutdownComplete received\n&quot;</span>;
                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1shutdown__complete__chunk.html">shutdown_complete_chunk</a> *scc = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1shutdown__complete__chunk.html">shutdown_complete_chunk</a>*) (chunks + chunkPtr);
                SCTPShutdownCompleteChunk *chunk = <span class="keyword">new</span> SCTPShutdownCompleteChunk(<span class="stringliteral">&quot;SHUTDOWN_COMPLETE&quot;</span>);
                chunk-&gt;setChunkType(chunkType);
                chunk-&gt;setTBit(scc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1shutdown__complete__chunk.html#a234c2bbc04b3655058a07315144f5dc8">flags</a> &amp; T_BIT);
                chunk-&gt;setBitLength(cLen*8);
                dest-&gt;addChunk(chunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a511842f389362e9f11f52a88556455f1">ERRORTYPE</a>:
            {
                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html">error_chunk</a> *error;
                error = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html">error_chunk</a>*) (chunks + chunkPtr);
                <a class="code" href="class_s_c_t_p_error_chunk.html">SCTPErrorChunk</a> *errorchunk;
                errorchunk = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_error_chunk.html">SCTPErrorChunk</a>(<span class="stringliteral">&quot;ERROR&quot;</span>);
                errorchunk-&gt;setChunkType(chunkType);
                errorchunk-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#aabfb8449670ea3f037420cabb853b8fa">SCTP_ERROR_CHUNK_LENGTH</a>*8);
                parptr = 0;
                dest-&gt;addChunk(errorchunk);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">default</span>:
                <span class="comment">//printf(&quot;TODO: Implement chunk type %d, found in chunk array on %d!\n&quot;, chunkType, ct);</span>
                <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Parser: Unknown SCTP chunk type &quot;</span> &lt;&lt; chunkType;

                <span class="comment">/*throw new cRuntimeError(&quot;TODO: unknown chunktype in incoming packet from external interface! Implement it!&quot;);*/</span>

                <span class="keywordflow">break</span>;
        }   <span class="comment">// end of switch(chunkType)</span>
        chunkPtr += cLen;
    }   <span class="comment">// end of while()</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="af442bc00006930edf772c9edbd3fcbc3"></a><!-- doxytag: member="UDPSerializer::serialize" ref="af442bc00006930edf772c9edbd3fcbc3" args="(const UDPPacket *pkt, unsigned char *buf, unsigned int bufsize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int UDPSerializer::serialize </td>
          <td>(</td>
          <td class="paramtype">const UDPPacket *&#160;</td>
          <td class="paramname"><em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>bufsize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Serializes an UDPPacket for transmission on the wire. Returns the length of data written into buffer. </p>

<p>Referenced by <a class="el" href="class_i_p_serializer.html#a92c164748ccd3346e0f6c156f56b0887">IPSerializer::serialize()</a>.</p>
<div class="fragment"><pre class="fragment">{
    int32 size_init_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html">init_chunk</a>);
    int32 size_sack_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html">sack_chunk</a>);
    int32 size_heartbeat_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__chunk.html">heartbeat_chunk</a>);
    int32 size_heartbeat_ack_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__ack__chunk.html">heartbeat_ack_chunk</a>);
    int32 size_chunk = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);


    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1common__header.html">common_header</a> *ch = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1common__header.html">common_header</a>*) (buf);
    uint32 writtenbytes = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1common__header.html">common_header</a>);

    <span class="comment">// fill SCTP common header structure</span>
    ch-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1common__header.html#a16df1d45094b56d46256db05ebb39fc3">source_port</a> = htons(msg-&gt;getSrcPort());
    ch-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1common__header.html#a6b69320aeac29fa21ad450b2104336c1">destination_port</a> = htons(msg-&gt;getDestPort());
    ch-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1common__header.html#a7405e47d14a91f6fa6558a25770b94b2">verification_tag</a> = htonl(msg-&gt;getTag());


    <span class="comment">// SCTP chunks:</span>
    int32 noChunks = msg-&gt;getChunksArraySize();
        <span class="keywordflow">for</span>(int32 cc = 0; cc &lt; noChunks; cc++)
        {
            <span class="keyword">const</span> SCTPChunk *<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a> = check_and_cast&lt;SCTPChunk *&gt;(((<a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *)msg)-&gt;getChunks(cc));
            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> chunkType = <a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>-&gt;getChunkType();
            <span class="keywordflow">switch</span>(chunkType)
            {
                <span class="keywordflow">case</span> <a class="code" href="_consts80211_8h.html#ad70ed57eb996b190fc586f309107250ea9d7d6f31868d66330397c967c4afd2d2">DATA</a>:
                {
                    <span class="comment">//sctpEV3&lt;&lt;simulation.simTime()&lt;&lt;&quot; SCTPAssociation:: Data sent \n&quot;;</span>
                    SCTPDataChunk *dataChunk = check_and_cast&lt;SCTPDataChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);
                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html">data_chunk</a> *dc = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html">data_chunk</a>*) (buf + writtenbytes); <span class="comment">// append data to buffer</span>
                    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structdata__chunk.html#aa705d8bf5f389d647f322aa875f12fb6">flags</a> = 0;

                    <span class="comment">// fill buffer with data from SCTP data chunk structure</span>
                    dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a109e8b0a1dcbe8922d54aa7a1e959e33">type</a> = dataChunk-&gt;getChunkType();
                    <span class="keywordflow">if</span> (dataChunk-&gt;getUBit())
                        flags |= UNORDERED_BIT;
                    <span class="keywordflow">if</span> (dataChunk-&gt;getBBit())
                        flags |= BEGIN_BIT;
                    <span class="keywordflow">if</span> (dataChunk-&gt;getEBit())
                        flags |= END_BIT;
                    dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a41dcf9feaa1ad2f81414ca7eab15e3b8">flags</a> = <a class="code" href="structdata__chunk.html#aa705d8bf5f389d647f322aa875f12fb6">flags</a>;
                    dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a0ab55ad1c1ba0ab2aa4082aed1ccf537">length</a> = htons(dataChunk-&gt;getByteLength());
                    dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a25db3ec53867059f7ffe5b050a43ae14">tsn</a> = htonl(dataChunk-&gt;getTsn());
                    dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a22aace84bd5e2295d4e706a55437cc1d">sid</a> = htons(dataChunk-&gt;getSid());
                    dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a240c6255e13bad8f6a7d41f5ec3559ef">ssn</a> = htons(dataChunk-&gt;getSsn());
                    dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a379ae5a1ddc385ee44d98cffd39632ee">ppi</a> = htonl(dataChunk-&gt;getPpid());
                    writtenbytes += <a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>;

                    SCTPSimpleMessage *smsg = check_and_cast&lt;SCTPSimpleMessage *&gt;(dataChunk-&gt;getEncapsulatedPacket());
                        <span class="comment">// T.D. 09.02.2010: Only copy data when there is something to copy!</span>
                        <span class="keyword">const</span> uint32 datalen = smsg-&gt;getDataLen();
                        <span class="keywordflow">if</span>( smsg-&gt;getDataArraySize() &gt;= datalen) {
                            <span class="keywordflow">for</span> (uint32 i = 0; i &lt; datalen; i++) {
                                dc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1data__chunk.html#a3747c423ac3fa73c5954351d1e38ded0">user_data</a>[i] = smsg-&gt;getData(i);
                            }
                        }
                        writtenbytes += <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(datalen);
                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a0cb1b2c6a7db1f1084886c98909a3f36">INIT</a>:
                {
                    <span class="comment">//sctpEV3&lt;&lt;&quot;serialize INIT sizeKeyVector=&quot;&lt;&lt;sizeKeyVector&lt;&lt;&quot;\n&quot;;</span>
                    <span class="comment">// source data from internal struct:</span>
                    SCTPInitChunk *initChunk = check_and_cast&lt;SCTPInitChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);
                    <span class="comment">//sctpEV3&lt;&lt;simulation.simTime()&lt;&lt;&quot; SCTPAssociation:: Init sent \n&quot;;</span>
                    <span class="comment">// destination is send buffer:</span>
                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html">init_chunk</a> *ic = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html">init_chunk</a>*) (buf + writtenbytes); <span class="comment">// append data to buffer</span>
                    <span class="comment">//buflen += (initChunk-&gt;getBitLength() / 8);</span>

                    <span class="comment">// fill buffer with data from SCTP init chunk structure</span>
                    ic-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#a9cdebf76f678051b3692f14e6d92aae0">type</a> = initChunk-&gt;getChunkType();
                    ic-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#a8b0d56d06d49b51197d6200cddba834a">flags</a> = 0; <span class="comment">// no flags available in this type of SCTPChunk</span>
                    ic-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#a7315d4164cc15995adf0bdec0511af1c">initiate_tag</a> = htonl(initChunk-&gt;getInitTag());
                    ic-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#a54cf1029a7b2d050336e4c76cd197654">a_rwnd</a> = htonl(initChunk-&gt;getA_rwnd());
                    ic-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#a947a36c02bac8bb6549ad270fe51714e">mos</a> = htons(initChunk-&gt;getNoOutStreams());
                    ic-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#ae3094436bd6843ba61ab9b20f44e87f9">mis</a> = htons(initChunk-&gt;getNoInStreams());
                    ic-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__chunk.html#ad0e25ef59a88465391ed7ed5608f9b70">initial_tsn</a> = htonl(initChunk-&gt;getInitTSN());
                    int32 parPtr = 0;
                    <span class="comment">// Var.-Len. Parameters</span>
                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1supported__address__types__parameter.html">supported_address_types_parameter</a>* sup_addr = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1supported__address__types__parameter.html">supported_address_types_parameter</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)ic) + size_init_chunk + parPtr);
                    sup_addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1supported__address__types__parameter.html#a149ee2f7dad36d74724e488903940246">type</a> = htons(INIT_SUPPORTED_ADDRESS);
                    sup_addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1supported__address__types__parameter.html#a51610238a939c7fd088bf7a795d70357">length</a> = htons(6);
                    sup_addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1supported__address__types__parameter.html#a11dffde51b23deb764cd03e2f340db26">address_type</a> = htons(INIT_PARAM_IPV4);
                    parPtr += 8;
                    int32 numaddr = initChunk-&gt;getAddressesArraySize();
                    <span class="keywordflow">for</span>(int32 i=0; i&lt;numaddr; i++)
                    {
                            <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html">init_ipv4_address_parameter</a> *ipv4addr = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html">init_ipv4_address_parameter</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)ic) + size_init_chunk + parPtr);
                            ipv4addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html#ae6f54209bc788f8225512e9caf290da0">type</a> = htons(INIT_PARAM_IPV4);
                            ipv4addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html#a823367d591586e1469d57df9a3278d30">length</a> = htons(8);
                            ipv4addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html#a9538c188df90d12ec2860698be2d2368">address</a> = htonl(initChunk-&gt;getAddresses(i).get4().getInt());
                            parPtr += <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html">init_ipv4_address_parameter</a>);
                    }
                    ic-&gt;length = htons(<a class="code" href="_s_c_t_p_association_8h.html#a685f1682f68294dbb12e7953e02748a0">SCTP_INIT_CHUNK_LENGTH</a>+parPtr);
                    writtenbytes += <a class="code" href="_s_c_t_p_association_8h.html#a685f1682f68294dbb12e7953e02748a0">SCTP_INIT_CHUNK_LENGTH</a>+parPtr;
                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12abb473557985d30fdf16d2525388e3a22">INIT_ACK</a>:
                {
                    <span class="comment">//sctpEV3&lt;&lt;&quot;serialize INIT_ACK sizeKeyVector=&quot;&lt;&lt;sizeKeyVector&lt;&lt;&quot;\n&quot;;</span>
                    SCTPInitAckChunk *initAckChunk = check_and_cast&lt;SCTPInitAckChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);
                    <span class="comment">//sctpEV3&lt;&lt;simulation.simTime()&lt;&lt;&quot; SCTPAssociation:: InitAck sent \n&quot;;</span>
                    <span class="comment">// destination is send buffer:</span>
                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html">init_ack_chunk</a> *iac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html">init_ack_chunk</a>*) (buf + writtenbytes); <span class="comment">// append data to buffer</span>
                    <span class="comment">// fill buffer with data from SCTP init ack chunk structure</span>
                    iac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html#a0b3250c76a08f6fa3363814b5f91f25c">type</a> = initAckChunk-&gt;getChunkType();
<span class="comment">//                  iac-&gt;flags = initAckChunk-&gt;getFlags(); // no flags available in this type of SCTPChunk</span>
                    iac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html#a7a54bd2ed88345cdb5c902f56bc8d3c7">initiate_tag</a> = htonl(initAckChunk-&gt;getInitTag());
                    iac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html#aa95033ee21e5290df42be51a8b696679">a_rwnd</a> = htonl(initAckChunk-&gt;getA_rwnd());
                    iac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html#af32685d03e6d9489916b3e6824261ac5">mos</a> = htons(initAckChunk-&gt;getNoOutStreams());
                    iac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html#af18c98e1baef7393f88d5141b17e0c91">mis</a> = htons(initAckChunk-&gt;getNoInStreams());
                    iac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ack__chunk.html#af9294b9a9ff18b46973e93b122b74413">initial_tsn</a> = htonl(initAckChunk-&gt;getInitTSN());
                    <span class="comment">// Var.-Len. Parameters</span>
                    int32 parPtr=0;

                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1supported__address__types__parameter.html">supported_address_types_parameter</a>* sup_addr = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1supported__address__types__parameter.html">supported_address_types_parameter</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)iac) + size_init_chunk + parPtr);
                    sup_addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1supported__address__types__parameter.html#a149ee2f7dad36d74724e488903940246">type</a> = htons(INIT_SUPPORTED_ADDRESS);
                    sup_addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1supported__address__types__parameter.html#a51610238a939c7fd088bf7a795d70357">length</a> = htons(6);
                    sup_addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1supported__address__types__parameter.html#a11dffde51b23deb764cd03e2f340db26">address_type</a> = htons(INIT_PARAM_IPV4);
                    parPtr += 8;


                    int32 numaddr = initAckChunk-&gt;getAddressesArraySize();
                    <span class="keywordflow">for</span>(int32 i=0; i&lt;numaddr; i++)
                    {
                        <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html">init_ipv4_address_parameter</a> *ipv4addr = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html">init_ipv4_address_parameter</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)iac) + size_init_chunk + parPtr);
                        ipv4addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html#ae6f54209bc788f8225512e9caf290da0">type</a> = htons(INIT_PARAM_IPV4);
                        ipv4addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html#a823367d591586e1469d57df9a3278d30">length</a> = htons(8);
                        ipv4addr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__ipv4__address__parameter.html#a9538c188df90d12ec2860698be2d2368">address</a> = htonl(initAckChunk-&gt;getAddresses(i).get4().getInt());
                        parPtr += 8;
                    }
                    uint32 uLen = initAckChunk-&gt;getUnrecognizedParametersArraySize();
                    <span class="keywordflow">if</span> (uLen&gt;0)
                    {
                        <span class="comment">//sctpEV3&lt;&lt;&quot;uLen=&quot;&lt;&lt;uLen&lt;&lt;&quot;\n&quot;;</span>
                        int32 k=0;
                        uint32 pLen=0;
                        <span class="keywordflow">while</span> (uLen&gt;0)
                        {
                            <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a>* unknown = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)iac) + size_init_chunk + parPtr);
                            unknown-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#a0376609c5b5aeb16ae4840581987d033">type</a> = htons(<a class="code" href="_s_c_t_p_association_8h.html#a8d59686e974f326f12076166b80dcad1a84eff3c1951655fd6a05c80649382f6b">UNRECOGNIZED_PARAMETER</a>);
                            pLen = initAckChunk-&gt;getUnrecognizedParameters(k+2)*16+initAckChunk-&gt;getUnrecognizedParameters(k+3);
                            unknown-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ad8504a2c0218d4213b377e2ddb240a9c">length</a> = htons(pLen+4);
                            <span class="comment">//sctpEV3&lt;&lt;&quot;unknown-&gt;length=&quot;&lt;&lt;pLen&lt;&lt;&quot;\n&quot;;</span>
                            <span class="keywordflow">for</span> (uint32 i=0; i&lt;<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(pLen); i++,k++)
                                unknown-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ab0de063235e7569ee8c41a4d3f94312c">value</a>[i] = initAckChunk-&gt;getUnrecognizedParameters(k);
                            parPtr += <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(pLen+4);
                            uLen-=<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(pLen);
                        }
                    }

                    <span class="comment">/*if(cookielen == 0)</span>
<span class="comment">                    {</span>
<span class="comment">                        cookielen = 4;</span>
<span class="comment">                        initAckChunk-&gt;setCookieArraySize(cookielen);</span>
<span class="comment">                        initAckChunk-&gt;setCookie(0, &#39;1&#39;);</span>
<span class="comment">                        initAckChunk-&gt;setCookie(1, &#39;3&#39;);</span>
<span class="comment">                        initAckChunk-&gt;setCookie(2, &#39;3&#39;);</span>
<span class="comment">                        initAckChunk-&gt;setCookie(3, &#39;7&#39;);</span>
<span class="comment">                        iac-&gt;length = htons(ntohs(iac-&gt;length) + 8);</span>
<span class="comment">                    }*/</span>
                    int32 cookielen = initAckChunk-&gt;getCookieArraySize();
                    <span class="keywordflow">if</span> (cookielen == 0)
                    {
                        SCTPCookie* stateCookie = check_and_cast&lt;SCTPCookie*&gt;(initAckChunk-&gt;getStateCookie());
                        <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__cookie__parameter.html">init_cookie_parameter</a> *cookie = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1init__cookie__parameter.html">init_cookie_parameter</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)iac) + size_init_chunk + parPtr);
                        cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__cookie__parameter.html#a14e5be998afe475f8ff332622f3bfc5f">type</a> = htons(INIT_PARAM_COOKIE);
                        cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__cookie__parameter.html#aca52f335a966cd309357456ebdffdd73">length</a> = htons(<a class="code" href="_s_c_t_p_association_8h.html#a3aeb03eaba88c9681ecb920f24c689d2">SCTP_COOKIE_LENGTH</a> + 4);
                        cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__cookie__parameter.html#aebe858a7bbcb4e6993ce77152b5fdd2a">creationTime</a> = htonl((uint32)stateCookie-&gt;getCreationTime().dbl());
                        cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__cookie__parameter.html#ab2cae663323b64da289760e11bf97a29">localTag</a> = htonl(stateCookie-&gt;getLocalTag());
                        cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__cookie__parameter.html#af89b5edd30a497adb8d1236173653c16">peerTag</a> = htonl(stateCookie-&gt;getPeerTag());
                        <span class="keywordflow">for</span>(int32 i=0; i&lt;32; i++)
                        {
                            cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__cookie__parameter.html#aa289cc30d97125318f42cb82346cb042">localTieTag</a>[i] = stateCookie-&gt;getLocalTieTag(i);
                            cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1init__cookie__parameter.html#a4ef1c054d13571f1aa5c827596f18989">peerTieTag</a>[i] = stateCookie-&gt;getPeerTieTag(i);
                        }
                        parPtr += (<a class="code" href="_s_c_t_p_association_8h.html#a3aeb03eaba88c9681ecb920f24c689d2">SCTP_COOKIE_LENGTH</a> + 4);
                    }
                    <span class="keywordflow">else</span>
                    {
                        <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a> *cookie = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)iac) + size_init_chunk + parPtr);
                        cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#a0376609c5b5aeb16ae4840581987d033">type</a> = htons(INIT_PARAM_COOKIE);
                        cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ad8504a2c0218d4213b377e2ddb240a9c">length</a> = htons(cookielen+4);
                        <span class="keywordflow">for</span>(int32 i=0; i&lt;cookielen; i++)
                            cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ab0de063235e7569ee8c41a4d3f94312c">value</a>[i] = initAckChunk-&gt;getCookie(i);
                        parPtr += cookielen + 4;
                    }
                    iac-&gt;length = htons(<a class="code" href="_s_c_t_p_association_8h.html#a685f1682f68294dbb12e7953e02748a0">SCTP_INIT_CHUNK_LENGTH</a>+parPtr);
                    writtenbytes += <a class="code" href="_s_c_t_p_association_8h.html#a685f1682f68294dbb12e7953e02748a0">SCTP_INIT_CHUNK_LENGTH</a>+parPtr;
                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a689bf9c7470080fd0180eb7f5c293bd4">SACK</a>:
                {
                    SCTPSackChunk *sackChunk = check_and_cast&lt;SCTPSackChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);

                    <span class="comment">// destination is send buffer:</span>
                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html">sack_chunk</a> *sac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html">sack_chunk</a>*) (buf + writtenbytes); <span class="comment">// append data to buffer</span>
                    writtenbytes += (sackChunk-&gt;getBitLength() / 8);

                    <span class="comment">// fill buffer with data from SCTP init ack chunk structure</span>
                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html#a82a5148eb8f2d054a93bc15b01f90ed0">type</a> = sackChunk-&gt;getChunkType();
<span class="comment">//                  sac-&gt;flags = sackChunk-&gt;getFlags(); // no flags available in this type of SCTPChunk</span>
                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html#a00b437d0173221e4f0962cecaafbe7e9">length</a> = htons(sackChunk-&gt;getBitLength() / 8);
                    uint32 cumtsnack = sackChunk-&gt;getCumTsnAck();
                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html#a561d6bef13b80381e25a0712b3b283a0">cum_tsn_ack</a> = htonl(cumtsnack);
                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html#a9d989ff6f677f8d5afcbbe2d73ece439">a_rwnd</a> = htonl(sackChunk-&gt;getA_rwnd());
                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html#addf4a98ed2d76970afe2a63340a95f00">nr_of_gaps</a> = htons(sackChunk-&gt;getNumGaps());
                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__chunk.html#a36b9ecced9fc135bc8906b8d5a58c7ed">nr_of_dups</a> = htons(sackChunk-&gt;getNumDupTsns());

                    <span class="comment">// GAPs and Dup. TSNs:</span>
                    int32 numgaps = sackChunk-&gt;getNumGaps();
                    int32 numdups = sackChunk-&gt;getNumDupTsns();
                    <span class="keywordflow">for</span>(int32 i=0; i&lt;numgaps; i++)
                    {
                        <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html">sack_gap</a> *gap = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html">sack_gap</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)sac) + size_sack_chunk + i*<span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html">sack_gap</a>));
                        gap-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html#a06092a86c2ef2a22d5412e2d7096563f">start</a> = htons(sackChunk-&gt;getGapStart(i) - cumtsnack);
                        gap-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html#aff0a1d1c21dd6d36e7b0fff135c93e23">stop</a> = htons(sackChunk-&gt;getGapStop(i) - cumtsnack);
                    }
                    <span class="keywordflow">for</span>(int32 i=0; i&lt;numdups; i++)
                    {
                        <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__duptsn.html">sack_duptsn</a> *dup = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1sack__duptsn.html">sack_duptsn</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)sac) + size_sack_chunk + numgaps*<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="struct_i_n_e_t_fw_1_1sack__gap.html">sack_gap</a>) + i*<span class="keyword">sizeof</span>(<a class="code" href="struct_i_n_e_t_fw_1_1sack__duptsn.html">sack_duptsn</a>));
                        dup-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1sack__duptsn.html#a264c16210059305d5716d62f3f44366e">tsn</a> = htonl(sackChunk-&gt;getDupTsns(i));
                    }
                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a0f286b0bbc1ee4f20be5136a55cf8923">HEARTBEAT</a>:
                {
                    <span class="comment">//sctpEV3&lt;&lt;simulation.simTime()&lt;&lt;&quot;  SCTPAssociation:: Heartbeat sent \n&quot;;</span>
                    SCTPHeartbeatChunk *heartbeatChunk = check_and_cast&lt;SCTPHeartbeatChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);

                    <span class="comment">// destination is send buffer:</span>
                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__chunk.html">heartbeat_chunk</a> *hbc = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__chunk.html">heartbeat_chunk</a>*) (buf + writtenbytes); <span class="comment">// append data to buffer</span>
                    writtenbytes += (heartbeatChunk-&gt;getBitLength() / 8);

                    <span class="comment">// fill buffer with data from SCTP init ack chunk structure</span>
                    hbc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__chunk.html#a024a36abc0874b6ec935c82aa1c09e45">type</a> = heartbeatChunk-&gt;getChunkType();
<span class="comment">//                  hbc-&gt;flags = heartbeatChunk-&gt;getFlags(); // no flags available in this type of SCTPChunk</span>
                    hbc-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__chunk.html#a4417dfe66d15d64507e259dc533adead">length</a> = htons(heartbeatChunk-&gt;getBitLength() / 8);

                    <span class="comment">// deliver info:</span>
                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html">heartbeat_info</a> *hbi = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html">heartbeat_info</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)hbc) + size_heartbeat_chunk);
                    <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="code" href="structheartbeat__info.html#aa18d6fa900626bccabebca79a2fe2284">addr</a> = heartbeatChunk-&gt;getRemoteAddr();
                    simtime_t <a class="code" href="structheartbeat__info.html#a42185fa571bdbaf64e6f2697f9fb45a1">time</a> = heartbeatChunk-&gt;getTimeField();
                    int32 infolen = <span class="keyword">sizeof</span>(addr.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>().<a class="code" href="class_i_p_address.html#a807ca46964a8403cf0c70f0772179524">getInt</a>()) + <span class="keyword">sizeof</span>(uint32);
                    hbi-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html#a9c496e01fb626983dd7449c4d299c4dd">type</a> = htons(1);   <span class="comment">// mandatory</span>
                    hbi-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html#a165225a4bed745a098ebc07d514b0a62">length</a> = htons(infolen+4);
                    <a class="code" href="sctp_8h.html#aed9342dc5ddcea1e525b7b449fab35a3">HBI_ADDR</a>(hbi) = htonl(addr.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>().<a class="code" href="class_i_p_address.html#a807ca46964a8403cf0c70f0772179524">getInt</a>());
                    <a class="code" href="sctp_8h.html#a350cf5878ce2f8cb42cca735e0f99c1d">HBI_TIME</a>(hbi) = htonl((uint32)time.dbl());
                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a5621dd83f6f32ee90c0d505867c67b71">HEARTBEAT_ACK</a>:
                {
                    <span class="comment">//sctpEV3&lt;&lt;simulation.simTime()&lt;&lt;&quot; SCTPAssociation:: HeartbeatAck sent \n&quot;;</span>
                    SCTPHeartbeatAckChunk *heartbeatAckChunk = check_and_cast&lt;SCTPHeartbeatAckChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);

                    <span class="comment">// destination is send buffer:</span>
                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__ack__chunk.html">heartbeat_ack_chunk</a> *hbac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__ack__chunk.html">heartbeat_ack_chunk</a>*) (buf + writtenbytes); <span class="comment">// append data to buffer</span>
                    writtenbytes += (heartbeatAckChunk-&gt;getBitLength() / 8);

                    <span class="comment">// fill buffer with data from SCTP init ack chunk structure</span>
                    hbac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__ack__chunk.html#aaef8cb3cb98d2936416619092e1409de">type</a> = heartbeatAckChunk-&gt;getChunkType();
<span class="comment">//                  hbac-&gt;flags = heartbeatAckChunk-&gt;getFlags(); // no flags available in this type of SCTPChunk</span>
                    hbac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__ack__chunk.html#af05e4e0ce777bc2ce5272709d26bfb1e">length</a> = htons(heartbeatAckChunk-&gt;getBitLength() / 8);

                    <span class="comment">// deliver info:</span>
                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html">heartbeat_info</a> *hbi = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html">heartbeat_info</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)hbac) + size_heartbeat_ack_chunk);
                    int32 infolen = heartbeatAckChunk-&gt;getInfoArraySize();
                    hbi-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html#a9c496e01fb626983dd7449c4d299c4dd">type</a> = htons(1); <span class="comment">//mandatory</span>
                    <span class="keywordflow">if</span> (infolen &gt; 0)
                    {
                        hbi-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html#a165225a4bed745a098ebc07d514b0a62">length</a> = htons(infolen+4);
                        <span class="keywordflow">for</span>(int32 i=0; i&lt;infolen; i++)
                        {
                            <a class="code" href="sctp_8h.html#a35a07f4d1137779b208b608ac62f7561">HBI_INFO</a>(hbi)[i] = heartbeatAckChunk-&gt;getInfo(i);
                        }
                    }
                    <span class="keywordflow">else</span>
                    {
                        <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> addr = heartbeatAckChunk-&gt;getRemoteAddr();
                        infolen = <span class="keyword">sizeof</span>(addr.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>().<a class="code" href="class_i_p_address.html#a807ca46964a8403cf0c70f0772179524">getInt</a>()) + <span class="keyword">sizeof</span>(uint32);
                        hbi-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html#a9c496e01fb626983dd7449c4d299c4dd">type</a> = htons(1);   <span class="comment">// mandatory</span>
                        hbi-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1heartbeat__info.html#a165225a4bed745a098ebc07d514b0a62">length</a> = htons(infolen+4);

                        simtime_t time = heartbeatAckChunk-&gt;getTimeField();
                        <a class="code" href="sctp_8h.html#aed9342dc5ddcea1e525b7b449fab35a3">HBI_ADDR</a>(hbi) = htonl(addr.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>().<a class="code" href="class_i_p_address.html#a807ca46964a8403cf0c70f0772179524">getInt</a>());
                        <a class="code" href="sctp_8h.html#a350cf5878ce2f8cb42cca735e0f99c1d">HBI_TIME</a>(hbi) = htonl((uint32)time.dbl());
                    }
                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a781ad2788df9e25c59a70894c7832096">ABORT</a>:
                {
                    <span class="comment">//sctpEV3&lt;&lt;simulation.simTime()&lt;&lt;&quot; SCTPAssociation:: Abort sent \n&quot;;</span>
                    SCTPAbortChunk *abortChunk = check_and_cast&lt;SCTPAbortChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);

                    <span class="comment">// destination is send buffer:</span>
                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1abort__chunk.html">abort_chunk</a> *ac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1abort__chunk.html">abort_chunk</a>*) (buf + writtenbytes); <span class="comment">// append data to buffer</span>
                    writtenbytes += (abortChunk-&gt;getBitLength() / 8);

                    <span class="comment">// fill buffer with data from SCTP init ack chunk structure</span>
                    ac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1abort__chunk.html#afd7b4ac79c01f4f7daf23664cd483832">type</a> = abortChunk-&gt;getChunkType();
                    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> flags = 0;
                    <span class="keywordflow">if</span>(abortChunk-&gt;getT_Bit())
                        flags |= T_BIT;
                    ac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1abort__chunk.html#af7c6588f89c568b6ca8dcf40cb32daf7">flags</a> = <a class="code" href="structabort__chunk.html#a992b83b08e484d47b508e12fb6c38bc8">flags</a>;
                    ac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1abort__chunk.html#ac0550cef90bd35ba1bf8430ee783743d">length</a> = htons(abortChunk-&gt;getBitLength() / 8);
                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12ac6c3901afa866152be0e645c2c38f471">COOKIE_ECHO</a>:
                {
                    <span class="comment">//sctpEV3&lt;&lt;simulation.simTime()&lt;&lt;&quot; SCTPAssociation:: CookieEcho sent \n&quot;;</span>
                    SCTPCookieEchoChunk *cookieChunk = check_and_cast&lt;SCTPCookieEchoChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);

                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1cookie__echo__chunk.html">cookie_echo_chunk</a> *cec = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1cookie__echo__chunk.html">cookie_echo_chunk</a>*) (buf + writtenbytes);


                    cec-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__echo__chunk.html#aacca81a316c96b6a54ea6d7d6daedc97">type</a> = cookieChunk-&gt;getChunkType();
                    cec-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__echo__chunk.html#a952814830fb2a5568b7a0b540ae8841e">length</a> = htons(cookieChunk-&gt;getBitLength() / 8);
                    int32 cookielen = cookieChunk-&gt;getCookieArraySize();
                    <span class="keywordflow">if</span> (cookielen&gt;0)
                    {
                        <span class="keywordflow">for</span>(int32 i=0; i&lt;cookielen; i++)
                            cec-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__echo__chunk.html#aef00e45b7a6273712cb7c75b4b459c10">state_cookie</a>[i] = cookieChunk-&gt;getCookie(i);
                    }
                    <span class="keywordflow">else</span>
                    {
                        SCTPCookie* stateCookie = check_and_cast&lt;SCTPCookie*&gt;(cookieChunk-&gt;getStateCookie());
                        <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html">cookie_parameter</a> *cookie = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html">cookie_parameter</a>*) (buf + writtenbytes+4);
                        cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html#a96b0f36a38c9886943c75ba5b29c0ef0">creationTime</a> = htonl((uint32)stateCookie-&gt;getCreationTime().dbl());
                        cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html#a023a4299beb2cfb28dd2ef1dfd0478c7">localTag</a> = htonl(stateCookie-&gt;getLocalTag());
                        cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html#a648153b48ec8424e1f72ff921b8a644d">peerTag</a> = htonl(stateCookie-&gt;getPeerTag());
                        <span class="keywordflow">for</span>(int32 i=0; i&lt;32; i++)
                        {
                            cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html#ad99c0071b11d8dfd434ec386226611f7">localTieTag</a>[i] = stateCookie-&gt;getLocalTieTag(i);
                            cookie-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__parameter.html#a34286a6e985ef4527a947f4199333dc0">peerTieTag</a>[i] = stateCookie-&gt;getPeerTieTag(i);
                        }
                    }
                    writtenbytes += (<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(cookieChunk-&gt;getBitLength() / 8));
                    <span class="comment">//sctpEV3&lt;&lt;&quot;buflen cookie_echo=&quot;&lt;&lt;buflen&lt;&lt;&quot;\n&quot;;</span>
                    uint32 uLen = cookieChunk-&gt;getUnrecognizedParametersArraySize();
                    <span class="keywordflow">if</span> (uLen&gt;0)
                    {
                        <span class="comment">//sctpEV3&lt;&lt;&quot;uLen=&quot;&lt;&lt;uLen&lt;&lt;&quot;\n&quot;;</span>
                        <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html">error_chunk</a>* error = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html">error_chunk</a>*)(buf + writtenbytes);
                        error-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html#a3ba5d36bfe9d3c3b41b6fe6ebb94a87e">type</a> = <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a511842f389362e9f11f52a88556455f1">ERRORTYPE</a>;
                        error-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html#a8a289af1659045a9b902cf5c6334fc59">flags</a> = 0;
                        int32 k=0;
                        uint32 pLen=0;
                        uint32 ecLen = <a class="code" href="_s_c_t_p_association_8h.html#aabfb8449670ea3f037420cabb853b8fa">SCTP_ERROR_CHUNK_LENGTH</a>;
                        uint32 ecParPtr = 0;
                        <span class="keywordflow">while</span> (uLen&gt;0)
                        {
                            <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a>* unknown = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1tlv.html">tlv</a>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)error) + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html">error_chunk</a>) + ecParPtr);
                            unknown-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#a0376609c5b5aeb16ae4840581987d033">type</a> = htons(<a class="code" href="_s_c_t_p_association_8h.html#a8d59686e974f326f12076166b80dcad1a84eff3c1951655fd6a05c80649382f6b">UNRECOGNIZED_PARAMETER</a>);
                            pLen = cookieChunk-&gt;getUnrecognizedParameters(k+2)*16+cookieChunk-&gt;getUnrecognizedParameters(k+3);
                            unknown-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ad8504a2c0218d4213b377e2ddb240a9c">length</a> = htons(pLen+4);
                            ecLen += pLen+4;
                            <span class="comment">//sctpEV3&lt;&lt;&quot;plength=&quot;&lt;&lt;pLen&lt;&lt;&quot; ecLen=&quot;&lt;&lt;ecLen&lt;&lt;&quot;\n&quot;;</span>
                            <span class="keywordflow">for</span> (uint32 i=0; i&lt;<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(pLen); i++,k++)
                                unknown-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1tlv.html#ab0de063235e7569ee8c41a4d3f94312c">value</a>[i] = cookieChunk-&gt;getUnrecognizedParameters(k);
                            ecParPtr += <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(pLen+4);
                            <span class="comment">//sctpEV3&lt;&lt;&quot;ecParPtr=&quot;&lt;&lt;ecParPtr&lt;&lt;&quot;\n&quot;;</span>
                            uLen-=<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(pLen);
                        }
                        error-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html#ab5bfa384fe76de61e158ddde3d148fc4">length</a> = htons(ecLen);
                        writtenbytes += <a class="code" href="_s_c_t_p_association_8h.html#aabfb8449670ea3f037420cabb853b8fa">SCTP_ERROR_CHUNK_LENGTH</a>+ecParPtr;
                    }

                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a8cb5544ff09ee0b2ae1f1171de9597bd">COOKIE_ACK</a>:
                {
                    <span class="comment">//sctpEV3&lt;&lt;simulation.simTime()&lt;&lt;&quot; SCTPAssociation:: CookieAck sent \n&quot;;</span>
                    SCTPCookieAckChunk *cookieAckChunk = check_and_cast&lt;SCTPCookieAckChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);

                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1cookie__ack__chunk.html">cookie_ack_chunk</a> *cac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1cookie__ack__chunk.html">cookie_ack_chunk</a>*) (buf + writtenbytes);
                    writtenbytes += (cookieAckChunk-&gt;getBitLength() / 8);

                    cac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__ack__chunk.html#a908232d2d65b3f327c8a8e7712f0ed2c">type</a> = cookieAckChunk-&gt;getChunkType();
                    cac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1cookie__ack__chunk.html#a95acfc6cbf8dfc2f783f2523f071f7f7">length</a> = htons(cookieAckChunk-&gt;getBitLength() / 8);

                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a7690b021f467450541d8d89123429d40">SHUTDOWN</a>:
                {
                    <span class="comment">//sctpEV3&lt;&lt;simulation.simTime()&lt;&lt;&quot; SCTPAssociation:: ShutdownAck sent \n&quot;;</span>
                    SCTPShutdownChunk *shutdownChunk = check_and_cast&lt;SCTPShutdownChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);

                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1shutdown__chunk.html">shutdown_chunk</a> *sac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1shutdown__chunk.html">shutdown_chunk</a>*) (buf + writtenbytes);
                    writtenbytes += (shutdownChunk-&gt;getBitLength() / 8);

                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1shutdown__chunk.html#af51d4366e493acaeda6614987c7572ac">type</a> = shutdownChunk-&gt;getChunkType();
                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1shutdown__chunk.html#a294183dee80de069c3e9583ff376b791">cumulative_tsn_ack</a> = htonl(shutdownChunk-&gt;getCumTsnAck());
                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1shutdown__chunk.html#a3ec4f8285d54892e78ec52507e542f96">length</a> = htons(shutdownChunk-&gt;getBitLength() / 8);

                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a7f11b152058ba8f4656266d735a50c4b">SHUTDOWN_ACK</a>:
                {
                    <span class="comment">//sctpEV3&lt;&lt;simulation.simTime()&lt;&lt;&quot; SCTPAssociation:: ShutdownAck sent \n&quot;;</span>
                    SCTPShutdownAckChunk *shutdownAckChunk = check_and_cast&lt;SCTPShutdownAckChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);

                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1shutdown__ack__chunk.html">shutdown_ack_chunk</a> *sac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1shutdown__ack__chunk.html">shutdown_ack_chunk</a>*) (buf + writtenbytes);
                    writtenbytes += (shutdownAckChunk-&gt;getBitLength() / 8);

                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1shutdown__ack__chunk.html#ae746b496e56ae3c2b8855f7ef4f04975">type</a> = shutdownAckChunk-&gt;getChunkType();
                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1shutdown__ack__chunk.html#a5bb998c2808be3907aa9b5475b1c56ce">length</a> = htons(shutdownAckChunk-&gt;getBitLength() / 8);

                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a1ac9ae29771c5095efe16ce822d561d7">SHUTDOWN_COMPLETE</a>:
                {
                    <span class="comment">//sctpEV3&lt;&lt;simulation.simTime()&lt;&lt;&quot; SCTPAssociation:: ShutdownAck sent \n&quot;;</span>
                    SCTPShutdownCompleteChunk *shutdownCompleteChunk = check_and_cast&lt;SCTPShutdownCompleteChunk *&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);

                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1shutdown__complete__chunk.html">shutdown_complete_chunk</a> *sac = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1shutdown__complete__chunk.html">shutdown_complete_chunk</a>*) (buf + writtenbytes);
                    writtenbytes += (shutdownCompleteChunk-&gt;getBitLength() / 8);

                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1shutdown__complete__chunk.html#a8f6c99af679dd511647d2747bf0a630d">type</a> = shutdownCompleteChunk-&gt;getChunkType();
                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1shutdown__complete__chunk.html#a81f2f464f168ed2650f5cf162ba95072">length</a> = htons(shutdownCompleteChunk-&gt;getBitLength() / 8);
                    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> flags = 0;
                    <span class="keywordflow">if</span>(shutdownCompleteChunk-&gt;getTBit())
                        flags |= T_BIT;
                    sac-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1shutdown__complete__chunk.html#a234c2bbc04b3655058a07315144f5dc8">flags</a> = <a class="code" href="structshutdown__complete__chunk.html#a0469d3f4be480b7e55f37255b70b84be">flags</a>;
                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">case</span> <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a511842f389362e9f11f52a88556455f1">ERRORTYPE</a>:
                {
                    <a class="code" href="class_s_c_t_p_error_chunk.html">SCTPErrorChunk</a>* errorchunk = check_and_cast&lt;<a class="code" href="class_s_c_t_p_error_chunk.html">SCTPErrorChunk</a>*&gt;(<a class="code" href="struct_i_n_e_t_fw_1_1chunk.html">chunk</a>);
                    <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html">error_chunk</a>* error = (<span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html">error_chunk</a>*)(buf + writtenbytes);
                    error-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html#a3ba5d36bfe9d3c3b41b6fe6ebb94a87e">type</a> = errorchunk-&gt;getChunkType();
                    error-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html#a8a289af1659045a9b902cf5c6334fc59">flags</a> = 0;

                    <span class="keywordflow">if</span> (errorchunk-&gt;<a class="code" href="class_s_c_t_p_error_chunk.html#a7b3588b447bfe205e5ef507e509e5ff0">getParametersArraySize</a>()&gt;0)
                    {
                        writtenbytes += size_chunk;
                    }
                    <span class="keywordflow">else</span>
                        writtenbytes += <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(error-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1error__chunk.html#ab5bfa384fe76de61e158ddde3d148fc4">length</a>);
                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">default</span>:
                    printf(<span class="stringliteral">&quot;Serialize TODO: Implement for outgoing chunk type %d!\n&quot;</span>, chunkType);
                    <span class="keywordflow">throw</span> <span class="keyword">new</span> cRuntimeError(<span class="stringliteral">&quot;TODO: unknown chunktype in outgoing packet on external interface! Implement it!&quot;</span>);
                <span class="comment">// break;</span>

            }

            <span class="comment">/*drop(chunk);</span>
<span class="comment">            delete chunk;*/</span>

        }
    <span class="comment">// finally, set the CRC32 checksum field in the SCTP common header</span>

    <span class="comment">/*sctpEV3&lt;&lt;&quot;srcport=&quot;&lt;&lt;msg-&gt;getSrcPort() &lt;&lt;&quot;destport=&quot;&lt;&lt;msg-&gt;getDestPort() &lt;&lt;&quot;writtenbytes vor checksum=&quot;&lt;&lt;writtenbytes&lt;&lt;&quot;\n&quot;;*/</span>

    ch-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1common__header.html#ad9a0af9b8746c7819868702a962fabea">checksum</a> = checksum((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)ch, writtenbytes);
    <span class="keywordflow">return</span> writtenbytes;
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_u_d_p_serializer_8h.html">UDPSerializer.h</a></li>
<li><a class="el" href="_s_c_t_p_serializer_8cc.html">SCTPSerializer.cc</a></li>
<li><a class="el" href="_u_d_p_serializer_8cc.html">UDPSerializer.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_u_d_p_serializer.html">UDPSerializer</a>      </li>
      <li class="footer">Generated on Fri Nov 18 2011 12:47:17 for INET Framework for OMNeT++/OMNEST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>

</body>
</html>
