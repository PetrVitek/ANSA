<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>INET Framework for OMNeT++/OMNEST: SnrEval Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">INET Framework for OMNeT++/OMNEST</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_snr_eval.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-types">Protected Types</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">SnrEval Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="SnrEval" --><!-- doxytag: inherits="BasicSnrEval" -->
<p>Keeps track of the different snir levels when receiving a packet.  
 <a href="class_snr_eval.html#details">More...</a></p>

<p><code>#include &lt;SnrEval.h&gt;</code></p>
<div class="dynheader">
Inheritance diagram for SnrEval:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_snr_eval.png" usemap="#SnrEval_map" alt=""/>
  <map id="SnrEval_map" name="SnrEval_map">
<area href="class_basic_snr_eval.html" title="The basic class for all snrEval modules." alt="BasicSnrEval" shape="rect" coords="55,168,156,192"/>
<area href="class_channel_access.html" title="Basic class for all physical layers, please don&#39;t touch!!" alt="ChannelAccess" shape="rect" coords="55,112,156,136"/>
<area href="class_basic_module.html" title="Base class for all simple modules of a host that want to have access to the NotificationBoard module..." alt="BasicModule" shape="rect" coords="55,56,156,80"/>
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="55,0,156,24"/>
<area href="class_gilbert_elliot_snr.html" title="Keeps track of the different snir levels when receiving a packet and switches between states GOOD and..." alt="GilbertElliotSnr" shape="rect" coords="0,280,101,304"/>
<area href="class_snr_eval80211.html" title="A SnrEval for the 802.11b protocol." alt="SnrEval80211" shape="rect" coords="111,280,212,304"/>
</map>
 </div></div>

<p><a href="class_snr_eval-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_snr_eval_1_1_snr_struct.html">SnrStruct</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Struct to store a pointer to the message, rcvdPower AND a SnrList, needed in <a class="el" href="class_snr_eval.html#abcb6a07d2956a4505c36843af15ff8f1" title="updates the snr information of the relevant AirFrames">SnrEval::addNewSnr</a>.  <a href="struct_snr_eval_1_1_snr_struct.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#ab4e1a210952513a2fb919c938453c8b9">SnrEval</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#adb3de641480fd9d173ed354c1dfa6223">changeChannel</a> (int channel)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">change transmitter and receiver to a new channel. This method throws an error if the radio state is transmit. Messages that are already sent to the new channel and would reach us in the future - thus they are on the air - will be received correctly.  <a href="#adb3de641480fd9d173ed354c1dfa6223"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#ae590bfa74ed33f72d11857d584979727">setBitrate</a> (double <a class="el" href="class_basic_snr_eval.html#a515b273855ffc377f579922d5eb68dfb">bitrate</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">change the bitrate to the given value. This method throws an error if the radio state is transmit.  <a href="#ae590bfa74ed33f72d11857d584979727"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-types"></a>
Protected Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="class_snr_eval.html#a2ad9ae884cbace04cc0352681bcf0aa7a797073dbf98fa5a93132abb0138983f0">TRANSM_OVER</a>
 }</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Enum to store self message getKind()s.  <a href="class_snr_eval.html#a2ad9ae884cbace04cc0352681bcf0aa7">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::map&lt; AirFrame <br class="typebreak"/>
*, double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a4f5f9f9cb0bc9e9ac1517f000cd00a84">RecvBuff</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Typedef used to store received messages together with receive power.  <a href="#a4f5f9f9cb0bc9e9ac1517f000cd00a84"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a10f81696b873c5acf9b65f04592c9918">initialize</a> (int)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize variables and publish the radio status.  <a href="#a10f81696b873c5acf9b65f04592c9918"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#aa128e6274894db101292b4414454fc27">finish</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a06a6561a83bc25e52859666d4f732197">~SnrEval</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#adbb4ecfc99b5b37ce10ca8f4db1ca495">handleMessage</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Called every time a message arrives.  <a href="#adbb4ecfc99b5b37ce10ca8f4db1ca495"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#aa001956884b5729fd1d6fabb3013d8ec">handleUpperMsg</a> (AirFrame *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#ad2d58ffa8f07856cfb6b6a7afc788e51">handleSelfMsg</a> (cMessage *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#ad6f33c127ee1bf1731a2f2999df33969">handleCommand</a> (int msgkind, cPolymorphic *ctrl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#aa4128b029feeaa5427ad6522fabce2eb">handleLowerMsgStart</a> (AirFrame *)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer the frame and update noise levels and snr information.  <a href="#aa4128b029feeaa5427ad6522fabce2eb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#ae4c093f6dc4dc649070947da6051f3b2">handleLowerMsgEnd</a> (AirFrame *)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Unbuffer the frame and update noise levels and snr information.  <a href="#ae4c093f6dc4dc649070947da6051f3b2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#abe78b8bf8a3b41fd8019e2a70109c201">calcRcvdPower</a> (double pSend, double distance)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the power with which a packet is received.  <a href="#abe78b8bf8a3b41fd8019e2a70109c201"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a7e3112193898e920f38094a8782f1861">getChannelNumber</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#abcb6a07d2956a4505c36843af15ff8f1">addNewSnr</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">updates the snr information of the relevant AirFrames  <a href="#abcb6a07d2956a4505c36843af15ff8f1"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_snr_eval_1_1_snr_struct.html">SnrStruct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d">snrInfo</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">State: SnrInfo stores the snrList and the the recvdPower for the message currently being received, together with a pointer to the message.  <a href="#a73fab3747cf312107fed650c2dbd7f4d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_snr_eval.html#a4f5f9f9cb0bc9e9ac1517f000cd00a84">RecvBuff</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522">recvBuff</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">State: A buffer to store a pointer to a message and the related receive power.  <a href="#a4348a6ef7a0ca5ff22d56b16394b0522"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_radio_state.html">RadioState</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255">rs</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">State: the current <a class="el" href="class_radio_state.html">RadioState</a> of the NIC; includes channel number.  <a href="#a5cb463a0967ec147b4747f1ddf3c5255"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a8a1d49d7a8dea980bdc65931de889d54">newChannel</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">State: if not -1, we have to switch to that channel once we finished transmitting.  <a href="#a8a1d49d7a8dea980bdc65931de889d54"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a6969112c3972e3d4a752e7055d1f9264">newBitrate</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">State: if not -1, we have to switch to that bitrate once we finished transmitting.  <a href="#a6969112c3972e3d4a752e7055d1f9264"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938">noiseLevel</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">State: the current noise level of the channel.  <a href="#aa3d5506d0e48b864bbb1089d5ff0f938"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a8dd650bd6e39b5a7c61e2175317a62ae">carrierFrequency</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration: The carrier frequency used. It is read from the <a class="el" href="class_channel_control.html" title="Monitors which hosts are &quot;in range&quot;. Supports multiple channels.">ChannelControl</a> module.  <a href="#a8dd650bd6e39b5a7c61e2175317a62ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a728160764ec0ccea6d02a1420e0b6b72">thermalNoise</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration: Thermal noise on the channel. Can be specified in omnetpp.ini. Default: -100 dBm.  <a href="#a728160764ec0ccea6d02a1420e0b6b72"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d">sensitivity</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default:  <a href="#a5fa6897f988f66115b1217db51eb379d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a5db01f6393281560dfb3a75901626556">pathLossAlpha</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration: Path loss coefficient. Can be specified in omnetpp.ini. If not it is read from the <a class="el" href="class_channel_control.html" title="Monitors which hosts are &quot;in range&quot;. Supports multiple channels.">ChannelControl</a> module. This value CANNOT be smaller than the one specified in the <a class="el" href="class_channel_control.html" title="Monitors which hosts are &quot;in range&quot;. Supports multiple channels.">ChannelControl</a> module, or the simulation will exit with an error!  <a href="#a5db01f6393281560dfb3a75901626556"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Keeps track of the different snir levels when receiving a packet. </p>
<p>This module keeps track of the noise level of the channel.</p>
<p>When receiving a packet this module updates the noise level of the channel. Based on the receive power of the packet it is processed and handed to upper layers or just treated as noise.</p>
<p>After the packet is completely received the snir information is attached and it is handed to the decider module.</p>
<p>The snir information is a SnrList that lists all different snr levels together with the point of time (simTime()) when they started.</p>
<p>On top of that this module manages the <a class="el" href="class_radio_state.html">RadioState</a>, and posts notifications on <a class="el" href="class_notification_board.html">NotificationBoard</a> whenever it changes. The radio state gives information about whether this module is sending a packet, receiving a packet or idle. This information can be accessed via the <a class="el" href="class_notification_board.html">NotificationBoard</a> by other modules, e.g. a <a class="el" href="class_c_s_m_a_mac_layer.html" title="MAC module which provides non-persistent CSMA.">CSMAMacLayer</a>.</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Marc Loebbers </dd></dl>
</div><hr/><h2>Member Typedef Documentation</h2>
<a class="anchor" id="a4f5f9f9cb0bc9e9ac1517f000cd00a84"></a><!-- doxytag: member="SnrEval::RecvBuff" ref="a4f5f9f9cb0bc9e9ac1517f000cd00a84" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::map&lt;AirFrame*,double&gt; <a class="el" href="class_snr_eval.html#a4f5f9f9cb0bc9e9ac1517f000cd00a84">SnrEval::RecvBuff</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Typedef used to store received messages together with receive power. </p>

</div>
</div>
<hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="a2ad9ae884cbace04cc0352681bcf0aa7"></a><!-- doxytag: member="SnrEval::@1" ref="a2ad9ae884cbace04cc0352681bcf0aa7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum<code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Enum to store self message getKind()s. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a2ad9ae884cbace04cc0352681bcf0aa7a797073dbf98fa5a93132abb0138983f0"></a><!-- doxytag: member="TRANSM_OVER" ref="a2ad9ae884cbace04cc0352681bcf0aa7a797073dbf98fa5a93132abb0138983f0" args="" -->TRANSM_OVER</em>&nbsp;</td><td>
<p>timer to indicate that a message is completely sent now </p>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><pre class="fragment">      {
        <a class="code" href="class_snr_eval.html#a2ad9ae884cbace04cc0352681bcf0aa7a797073dbf98fa5a93132abb0138983f0" title="timer to indicate that a message is completely sent now">TRANSM_OVER</a>
      };
</pre></div>
</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ab4e1a210952513a2fb919c938453c8b9"></a><!-- doxytag: member="SnrEval::SnrEval" ref="ab4e1a210952513a2fb919c938453c8b9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SnrEval::SnrEval </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                 : <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>(this-&gt;getId())
{
}
</pre></div>
</div>
</div>
<a class="anchor" id="a06a6561a83bc25e52859666d4f732197"></a><!-- doxytag: member="SnrEval::~SnrEval" ref="a06a6561a83bc25e52859666d4f732197" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SnrEval::~SnrEval </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
    <span class="comment">// delete messages being received</span>
    <span class="keywordflow">for</span> (RecvBuff::iterator it = <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>.begin(); it!=<a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>.end(); ++it)
        <span class="keyword">delete</span> it-&gt;first;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="abcb6a07d2956a4505c36843af15ff8f1"></a><!-- doxytag: member="SnrEval::addNewSnr" ref="abcb6a07d2956a4505c36843af15ff8f1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SnrEval::addNewSnr </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>updates the snr information of the relevant AirFrames </p>
<p>The Snr information of the buffered message is updated. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#ae4c093f6dc4dc649070947da6051f3b2">handleLowerMsgEnd()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a8cce1850da492f871c08ddcb3647b2ed">GilbertElliotSnr::handleLowerMsgEnd()</a>, <a class="el" href="class_snr_eval.html#aa4128b029feeaa5427ad6522fabce2eb">handleLowerMsgStart()</a>, and <a class="el" href="class_gilbert_elliot_snr.html#a7e5d2fb286b5a2a78834a6d5a7ccd392">GilbertElliotSnr::handleLowerMsgStart()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct_snr_list_entry.html" title="struct for SNR information">SnrListEntry</a> listEntry;     <span class="comment">// create a new entry</span>
    listEntry.<a class="code" href="struct_snr_list_entry.html#a0a91ab67cfd340b315a7badf6da14ce8" title="timestamp for this SNR value">time</a> = simTime();
    listEntry.<a class="code" href="struct_snr_list_entry.html#a9126b6070ee24b0a586a267de6ebc94b" title="the SNR value">snr</a> = <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a4b048226b385794353721848560f1a29" title="Received power of the message.">rcvdPower</a> / <a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a>;
    <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#aabbbbeed5ce64d9ecf216db3f79ba206" title="Snr list to store the SNR values.">sList</a>.push_back(listEntry);
}
</pre></div>
</div>
</div>
<a class="anchor" id="abe78b8bf8a3b41fd8019e2a70109c201"></a><!-- doxytag: member="SnrEval::calcRcvdPower" ref="abe78b8bf8a3b41fd8019e2a70109c201" args="(double pSend, double distance)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double SnrEval::calcRcvdPower </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>pSend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>distance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Calculates the power with which a packet is received. </p>
<p>This function simply calculates with how much power the signal arrives "here". If a different way of computing the path loss is required this function can be redefined. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#aa4128b029feeaa5427ad6522fabce2eb">handleLowerMsgStart()</a>, and <a class="el" href="class_gilbert_elliot_snr.html#a7e5d2fb286b5a2a78834a6d5a7ccd392">GilbertElliotSnr::handleLowerMsgStart()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">double</span> speedOfLight = 300000000.0;
    <span class="keywordtype">double</span> waveLength = speedOfLight / <a class="code" href="class_snr_eval.html#a8dd650bd6e39b5a7c61e2175317a62ae" title="Configuration: The carrier frequency used. It is read from the ChannelControl module.">carrierFrequency</a>;
    <span class="keywordflow">return</span> (pSend * waveLength * waveLength / (16 * <a class="code" href="_f_w_math_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * <a class="code" href="_f_w_math_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * pow(distance, <a class="code" href="class_snr_eval.html#a5db01f6393281560dfb3a75901626556" title="Configuration: Path loss coefficient. Can be specified in omnetpp.ini. If not it is read from the Cha...">pathLossAlpha</a>)));
}
</pre></div>
</div>
</div>
<a class="anchor" id="adb3de641480fd9d173ed354c1dfa6223"></a><!-- doxytag: member="SnrEval::changeChannel" ref="adb3de641480fd9d173ed354c1dfa6223" args="(int channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SnrEval::changeChannel </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>channel</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>change transmitter and receiver to a new channel. This method throws an error if the radio state is transmit. Messages that are already sent to the new channel and would reach us in the future - thus they are on the air - will be received correctly. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#ad6f33c127ee1bf1731a2f2999df33969">handleCommand()</a>, and <a class="el" href="class_snr_eval.html#ad2d58ffa8f07856cfb6b6a7afc788e51">handleSelfMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (channel == <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#a0799344b13882d66af3376919bdf9c7d">getChannelNumber</a>())
        <span class="keywordflow">return</span>;
    <span class="keywordflow">if</span> (channel &lt; 0 || channel &gt;= <a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;<a class="code" href="class_channel_control.html#ac3a565b50d10c70e4fe2e7a0442aa086" title="Returns the number of radio channels (frequencies) simulated.">getNumChannels</a>())
        error(<span class="stringliteral">&quot;changeChannel(): channel number %d is out of range (hint: numChannels is a parameter of ChannelControl)&quot;</span>, channel);
    <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>)
        error(<span class="stringliteral">&quot;changing channel while transmitting is not allowed&quot;</span>);

    <span class="comment">// if we are currently receiving, must clean that up before moving to different channel</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>)
    {
        <span class="comment">// delete messages being received, and cancel associated self-messages</span>
        <span class="keywordflow">for</span> (RecvBuff::iterator it = <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>.begin(); it!=<a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>.end(); ++it)
        {
            AirFrame *frame = it-&gt;first;
            cMessage *endRxTimer = (cMessage *)frame-&gt;getContextPointer();
            <span class="keyword">delete</span> frame;
            <span class="keyword">delete</span> cancelEvent(endRxTimer);
        }
        <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>.clear();
    }

    <span class="comment">// clear snr info</span>
    <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> = NULL;
    <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#aabbbbeed5ce64d9ecf216db3f79ba206" title="Snr list to store the SNR values.">sList</a>.clear();

    <span class="comment">// do channel switch</span>
    <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Changing channel to &quot;</span> &lt;&lt; channel &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

    <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab4ce41a963cc11f5bbd10a5d9b894a71">setChannelNumber</a>(channel);
    <a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;<a class="code" href="class_channel_control.html#a04bbb08c92d001b804c06ba42d8e43ea" title="Called when host switches channel.">updateHostChannel</a>(<a class="code" href="class_channel_access.html#aff3d33ee8db5a945fff05fe4305ccf2e" title="Identifies this host in the ChannelControl module.">myHostRef</a>, channel);
    <a class="code" href="class_channel_control.html#a3d946c87c47729fdd4ad4ae9a17b406f">ChannelControl::TransmissionList</a> tl = <a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;<a class="code" href="class_channel_control.html#a29b60c6b3cdaa3c63a9c48e83beb9f9e" title="Provides a list of transmissions currently on the air.">getOngoingTransmissions</a>(channel);

    <span class="comment">// pick up ongoing transmissions on the new channel</span>
    <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Picking up ongoing transmissions on new channel:\n&quot;</span>;
    <span class="keywordflow">for</span> (ChannelControl::TransmissionList::const_iterator it = tl.begin(); it != tl.end(); ++it)
    {
        AirFrame *frame = *it;
        <span class="comment">// time for the message to reach us</span>
        <span class="keywordtype">double</span> distance = <a class="code" href="class_channel_access.html#aff3d33ee8db5a945fff05fe4305ccf2e" title="Identifies this host in the ChannelControl module.">myHostRef</a>-&gt;<a class="code" href="struct_channel_control_1_1_host_entry.html#a3e6df3511ce1af969e4dc2254f7f4c40">pos</a>.<a class="code" href="class_coord.html#ab6a7bfcc5c55e5d8edbc7c0cb5a11626">distance</a>(frame-&gt;getSenderPos());
        simtime_t propagationDelay = distance / <a class="code" href="_channel_control_8h.html#a2f3addaba3e40cfb6e78224398707712">LIGHT_SPEED</a>;

        <span class="comment">// if this transmission is on our new channel and it would reach us in the future, then schedule it</span>
        <span class="keywordflow">if</span> (channel == frame-&gt;getChannelNumber())
        {
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot; - (&quot;</span> &lt;&lt; frame-&gt;getClassName() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; frame-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;

            <span class="comment">// if there is a message on the air which will reach us in the future</span>
            <span class="keywordflow">if</span> (frame-&gt;getTimestamp() + propagationDelay &gt;= simTime())
            {
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;will arrive in the future, scheduling it\n&quot;</span>;

                <span class="comment">// we need to send to each radioIn[] gate</span>
                cGate *radioGate = gate(<span class="stringliteral">&quot;radioIn&quot;</span>);
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; radioGate-&gt;size(); i++)
                    sendDirect((cMessage*)frame-&gt;dup(), frame-&gt;getTimestamp() + propagationDelay - simTime(), frame-&gt;getDuration(), <span class="keyword">this</span>, radioGate-&gt;getId() + i);
            }
            <span class="comment">// if we hear some part of the message</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (frame-&gt;getTimestamp() + frame-&gt;getDuration() + propagationDelay &gt; simTime())
            {
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;missed beginning of frame, processing it as noise\n&quot;</span>;

                AirFrame *frameDup = (AirFrame*)frame-&gt;dup();
                frameDup-&gt;setArrivalTime(frame-&gt;getTimestamp() + propagationDelay);
                <a class="code" href="class_snr_eval.html#aa4128b029feeaa5427ad6522fabce2eb" title="Buffer the frame and update noise levels and snr information.">handleLowerMsgStart</a>(frameDup);
                <a class="code" href="class_basic_snr_eval.html#a2b3c76b94adf5ef26526d4ac0c8db686" title="Buffers message for &#39;transmission time&#39;.">bufferMsg</a>(frameDup);
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;in the past\n&quot;</span>;
            }
        }
    }

    <span class="comment">// notify other modules about the channel switch; and actually, radio state has changed too</span>
    <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf3cbaad9c60e34c5cd7ca3da116fa468">NF_RADIO_CHANNEL_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
    <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa128e6274894db101292b4414454fc27"></a><!-- doxytag: member="SnrEval::finish" ref="aa128e6274894db101292b4414454fc27" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SnrEval::finish </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_snr_eval.html#aa128e6274894db101292b4414454fc27">BasicSnrEval::finish</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7e3112193898e920f38094a8782f1861"></a><!-- doxytag: member="SnrEval::getChannelNumber" ref="a7e3112193898e920f38094a8782f1861" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual int SnrEval::getChannelNumber </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Redefined from <a class="el" href="class_basic_snr_eval.html" title="The basic class for all snrEval modules.">BasicSnrEval</a> </p>

<p>Reimplemented from <a class="el" href="class_basic_snr_eval.html#a1865474b5fc30b052459a3cb2b9d35fa">BasicSnrEval</a>.</p>
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#a0799344b13882d66af3376919bdf9c7d">getChannelNumber</a>();}
</pre></div>
</div>
</div>
<a class="anchor" id="ad6f33c127ee1bf1731a2f2999df33969"></a><!-- doxytag: member="SnrEval::handleCommand" ref="ad6f33c127ee1bf1731a2f2999df33969" args="(int msgkind, cPolymorphic *ctrl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SnrEval::handleCommand </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>msgkind</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_snr_eval.html#adbb4ecfc99b5b37ce10ca8f4db1ca495">handleMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msgkind==PHY_C_CONFIGURERADIO)
    {
        <span class="comment">// extract new channel number</span>
        PhyControlInfo *phyCtrl = check_and_cast&lt;PhyControlInfo *&gt;(ctrl);
        <span class="keywordtype">int</span> <a class="code" href="class_snr_eval.html#a8a1d49d7a8dea980bdc65931de889d54" title="State: if not -1, we have to switch to that channel once we finished transmitting.">newChannel</a> = phyCtrl-&gt;getChannelNumber();
        <span class="keywordtype">double</span> <a class="code" href="class_snr_eval.html#a6969112c3972e3d4a752e7055d1f9264" title="State: if not -1, we have to switch to that bitrate once we finished transmitting.">newBitrate</a> = phyCtrl-&gt;getBitrate();
        <span class="keyword">delete</span> ctrl;

        <span class="keywordflow">if</span> (newChannel!=-1)
        {
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Command received: change to channel &quot;</span> &lt;&lt; newChannel &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

            <span class="comment">// do it</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#a0799344b13882d66af3376919bdf9c7d">getChannelNumber</a>()==<a class="code" href="class_snr_eval.html#a8a1d49d7a8dea980bdc65931de889d54" title="State: if not -1, we have to switch to that channel once we finished transmitting.">newChannel</a>)
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Right on that channel, nothing to do\n&quot;</span>; <span class="comment">// fine, nothing to do</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>()==<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>) {
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;We&#39;re transmitting right now, remembering to change after it&#39;s completed\n&quot;</span>;
                this-&gt;newChannel = <a class="code" href="class_snr_eval.html#a8a1d49d7a8dea980bdc65931de889d54" title="State: if not -1, we have to switch to that channel once we finished transmitting.">newChannel</a>;
            } <span class="keywordflow">else</span>
                <a class="code" href="class_snr_eval.html#adb3de641480fd9d173ed354c1dfa6223" title="change transmitter and receiver to a new channel. This method throws an error if the radio state is t...">changeChannel</a>(newChannel); <span class="comment">// change channel right now</span>
        }
        <span class="keywordflow">if</span> (newBitrate!=-1)
        {
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Command received: change bitrate to &quot;</span> &lt;&lt; (newBitrate/1e6) &lt;&lt; <span class="stringliteral">&quot;Mbps\n&quot;</span>;

            <span class="comment">// do it</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#a2f127045c28c2a709aa1212ba098b9b4">getBitrate</a>()==<a class="code" href="class_snr_eval.html#a6969112c3972e3d4a752e7055d1f9264" title="State: if not -1, we have to switch to that bitrate once we finished transmitting.">newBitrate</a>)
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Right at that bitrate, nothing to do\n&quot;</span>; <span class="comment">// fine, nothing to do</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>()==<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>) {
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;We&#39;re transmitting right now, remembering to change after it&#39;s completed\n&quot;</span>;
                this-&gt;newBitrate = <a class="code" href="class_snr_eval.html#a6969112c3972e3d4a752e7055d1f9264" title="State: if not -1, we have to switch to that bitrate once we finished transmitting.">newBitrate</a>;
            } <span class="keywordflow">else</span>
                <a class="code" href="class_snr_eval.html#ae590bfa74ed33f72d11857d584979727" title="change the bitrate to the given value. This method throws an error if the radio state is transmit...">setBitrate</a>(newBitrate); <span class="comment">// change bitrate right now</span>
        }
    }
    <span class="keywordflow">else</span>
        error(<span class="stringliteral">&quot;unknown command (msgkind=%d)&quot;</span>, msgkind);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae4c093f6dc4dc649070947da6051f3b2"></a><!-- doxytag: member="SnrEval::handleLowerMsgEnd" ref="ae4c093f6dc4dc649070947da6051f3b2" args="(AirFrame *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SnrEval::handleLowerMsgEnd </td>
          <td>(</td>
          <td class="paramtype">AirFrame *&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unbuffer the frame and update noise levels and snr information. </p>
<p>This function is called right after the transmission is over, i.e. right after unbuffering. The noise level of the channel and the snr information of the buffered messages have to be updated.</p>
<p>Additionally the <a class="el" href="class_radio_state.html">RadioState</a> has to be updated.</p>
<p>If the corresponding AirFrame was not only noise the corresponding SnrList and the AirFrame are sent to the decider. </p>

<p>Reimplemented from <a class="el" href="class_basic_snr_eval.html#aacd0c25177016c20be7e0b6090a7f191">BasicSnrEval</a>.</p>

<p>Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#a8cce1850da492f871c08ddcb3647b2ed">GilbertElliotSnr</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// check if message has to be send to the decider</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> == frame)
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;reception of frame over, preparing to send packet to upper layer\n&quot;</span>;
        <span class="comment">// get Packet and list out of the receive buffer:</span>
        <a class="code" href="_snr_list_8h.html#a241b5e7c9575e932988a55f7a5012a61" title="List to store SNR information for a message.">SnrList</a> list;
        list = <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#aabbbbeed5ce64d9ecf216db3f79ba206" title="Snr list to store the SNR values.">sList</a>;

        <span class="comment">// delete the pointer to indicate that no message is currently</span>
        <span class="comment">// being received and clear the list</span>
        <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> = NULL;
        <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#aabbbbeed5ce64d9ecf216db3f79ba206" title="Snr list to store the SNR values.">sList</a>.clear();

        <span class="comment">// delete the frame from the recvBuff</span>
        <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>.erase(frame);

        <span class="comment">//Don&#39;t forget to send:</span>
        <a class="code" href="class_basic_snr_eval.html#a94a474e2deb6ce756900b1b64ba779df" title="Sends a message to the upper layer.">sendUp</a>(frame, list);
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;packet sent to the decider\n&quot;</span>;
    }
    <span class="comment">// all other messages are noise</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;reception of noise message over, removing recvdPower from noiseLevel....\n&quot;</span>;
        <span class="comment">// get the rcvdPower and subtract it from the noiseLevel</span>
        <a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> -= <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>[frame];

        <span class="comment">// delete message from the recvBuff</span>
        <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>.erase(frame);

        <span class="comment">// update snr info for message currently being received if any</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> != NULL)
        {
            <a class="code" href="class_snr_eval.html#abcb6a07d2956a4505c36843af15ff8f1" title="updates the snr information of the relevant AirFrames">addNewSnr</a>();
        }

        <span class="comment">// message should be deleted</span>
        <span class="keyword">delete</span> frame;
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;message deleted\n&quot;</span>;
    }

    <span class="comment">// check the RadioState and update if necessary</span>
    <span class="comment">// change to idle if noiseLevel smaller than threshold and state was</span>
    <span class="comment">// not idle before</span>
    <span class="comment">// do not change state if currently sending or receiving a message!!!</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> &lt; <a class="code" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d" title="Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default:">sensitivity</a> &amp;&amp; <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a> &amp;&amp; <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> == NULL)
    {
        <span class="comment">// publish the new RadioState:</span>
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;new RadioState is IDLE\n&quot;</span>;
        <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>);
        <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa4128b029feeaa5427ad6522fabce2eb"></a><!-- doxytag: member="SnrEval::handleLowerMsgStart" ref="aa4128b029feeaa5427ad6522fabce2eb" args="(AirFrame *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SnrEval::handleLowerMsgStart </td>
          <td>(</td>
          <td class="paramtype">AirFrame *&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Buffer the frame and update noise levels and snr information. </p>
<p>This function is called right after a packet arrived, i.e. right before it is buffered for 'transmission time'.</p>
<p>First the receive power of the packet has to be calculated and is stored in the recvBuff. Afterwards it has to be decided whether the packet is just noise or a "real" packet that needs to be received.</p>
<p>The message is not treated as noise if all of the following conditions apply:</p>
<ol type="1">
<li>the power of the received signal is higher than the sensitivity.</li>
<li>the host is currently not sending a message</li>
<li>no other packet is already being received</li>
</ol>
<p>If all conditions apply a new SnrList is created and the <a class="el" href="class_radio_state.html">RadioState</a> is changed to RECV.</p>
<p>If the packet is just noise the receive power is added to the noise Level of the channel. Additionally the snr information of the currently being received message (if any) has to be updated as well as the <a class="el" href="class_radio_state.html">RadioState</a>. </p>

<p>Reimplemented from <a class="el" href="class_basic_snr_eval.html#a58f6bd32dd024e3bf3bdeb84126f3bb9">BasicSnrEval</a>.</p>

<p>Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#a7e5d2fb286b5a2a78834a6d5a7ccd392">GilbertElliotSnr</a>.</p>

<p>Referenced by <a class="el" href="class_snr_eval.html#adb3de641480fd9d173ed354c1dfa6223">changeChannel()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Calculate the receive power of the message</span>

    <span class="comment">// calculate distance</span>
    <span class="keyword">const</span> <a class="code" href="class_coord.html" title="Class for storing host positions.">Coord</a>&amp; myPos = <a class="code" href="class_channel_access.html#a9e51969a624ff64101cf808514d50d4f" title="Returns the host&#39;s position.">getMyPosition</a>();
    <span class="keyword">const</span> <a class="code" href="class_coord.html" title="Class for storing host positions.">Coord</a>&amp; framePos = frame-&gt;getSenderPos();
    <span class="keywordtype">double</span> distance = myPos.<a class="code" href="class_coord.html#ab6a7bfcc5c55e5d8edbc7c0cb5a11626">distance</a>(framePos);

    <span class="comment">// calculate receive power</span>
    <span class="keywordtype">double</span> rcvdPower = <a class="code" href="class_snr_eval.html#abe78b8bf8a3b41fd8019e2a70109c201" title="Calculates the power with which a packet is received.">calcRcvdPower</a>(frame-&gt;getPSend(), distance);

    <span class="comment">// store the receive power in the recvBuff</span>
    <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>[frame] = rcvdPower;

    <span class="comment">// if receive power is bigger than sensitivity and if not sending</span>
    <span class="comment">// and currently not receiving another message and the message has</span>
    <span class="comment">// arrived in time</span>
    <span class="comment">// NOTE: a message may have arrival time in the past here when we are</span>
    <span class="comment">// processing ongoing transmissions during a channel change</span>
    <span class="keywordflow">if</span> (frame-&gt;getArrivalTime() == simTime() &amp;&amp; rcvdPower &gt;= <a class="code" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d" title="Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default:">sensitivity</a> &amp;&amp; <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() != <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a> &amp;&amp; <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> == NULL)
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;receiving frame &quot;</span> &lt;&lt; frame-&gt;getName() &lt;&lt; endl;

        <span class="comment">// Put frame and related SnrList in receive buffer</span>
        <a class="code" href="_snr_list_8h.html#a241b5e7c9575e932988a55f7a5012a61" title="List to store SNR information for a message.">SnrList</a> snrList;        <span class="comment">//defined in SnrList.h!!</span>
        <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> = frame;
        <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a4b048226b385794353721848560f1a29" title="Received power of the message.">rcvdPower</a> = rcvdPower;
        <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#aabbbbeed5ce64d9ecf216db3f79ba206" title="Snr list to store the SNR values.">sList</a> = snrList;

        <span class="comment">// add initial snr value</span>
        <a class="code" href="class_snr_eval.html#abcb6a07d2956a4505c36843af15ff8f1" title="updates the snr information of the relevant AirFrames">addNewSnr</a>();

        <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() != <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>)
        {
            <span class="comment">// publish new RadioState</span>
            <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>);
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;publish new RadioState:RECV\n&quot;</span>;
            <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
        }
    }
    <span class="comment">// receive power is too low or another message is being sent or received</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;frame &quot;</span> &lt;&lt; frame-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; is just noise\n&quot;</span>;
        <span class="comment">//add receive power to the noise level</span>
        <a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> += rcvdPower;

        <span class="comment">// if a message is being received add a new snr value</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> != NULL)
        {
            <span class="comment">// update snr info for currently being received message</span>
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;add new snr value to snr list of message being received\n&quot;</span>;
            <a class="code" href="class_snr_eval.html#abcb6a07d2956a4505c36843af15ff8f1" title="updates the snr information of the relevant AirFrames">addNewSnr</a>();
        }

        <span class="comment">// update the RadioState if the noiseLevel exceeded the threshold</span>
        <span class="comment">// and the radio is currently not in receive or in send mode</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> &gt;= <a class="code" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d" title="Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default:">sensitivity</a> &amp;&amp; <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>)
        {
            <span class="comment">// publish new RadioState</span>
            <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>);
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;publish new RadioState:RECV\n&quot;</span>;
            <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="adbb4ecfc99b5b37ce10ca8f4db1ca495"></a><!-- doxytag: member="SnrEval::handleMessage" ref="adbb4ecfc99b5b37ce10ca8f4db1ca495" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SnrEval::handleMessage </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Called every time a message arrives. </p>
<p>The basic handle message function.</p>
<p>Depending on the gate a message arrives handleMessage just calls different handle*Msg functions to further process the message.</p>
<p>Messages from the channel are also buffered here in order to simulate a transmission delay</p>
<p>You should not make any changes in this function but implement all your functionality into the handle*Msg functions called from here.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="class_snr_eval.html#aa001956884b5729fd1d6fabb3013d8ec">handleUpperMsg</a>, <a class="el" href="class_snr_eval.html#aa4128b029feeaa5427ad6522fabce2eb" title="Buffer the frame and update noise levels and snr information.">handleLowerMsgStart</a>, <a class="el" href="class_snr_eval.html#ae4c093f6dc4dc649070947da6051f3b2" title="Unbuffer the frame and update noise levels and snr information.">handleLowerMsgEnd</a>, <a class="el" href="class_snr_eval.html#ad2d58ffa8f07856cfb6b6a7afc788e51">handleSelfMsg</a> </dd></dl>

<p>Reimplemented from <a class="el" href="class_basic_snr_eval.html#a63f8fd5fab971fe18a609c1053624dc1">BasicSnrEval</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msg-&gt;getArrivalGateId()==<a class="code" href="class_basic_snr_eval.html#a973b2265e5854d65b9ed5e8631b16aa3">uppergateIn</a> &amp;&amp; !msg-&gt;isPacket())
    {
        cPolymorphic *ctrl = msg-&gt;removeControlInfo();
        <a class="code" href="class_snr_eval.html#ad6f33c127ee1bf1731a2f2999df33969">handleCommand</a>(msg-&gt;getKind(), ctrl);
        <span class="keyword">delete</span> msg;
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_snr_eval.html#adbb4ecfc99b5b37ce10ca8f4db1ca495" title="Called every time a message arrives.">BasicSnrEval::handleMessage</a>(msg); <span class="comment">// let base class do it</span>
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad2d58ffa8f07856cfb6b6a7afc788e51"></a><!-- doxytag: member="SnrEval::handleSelfMsg" ref="ad2d58ffa8f07856cfb6b6a7afc788e51" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SnrEval::handleSelfMsg </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The only self message that can arrive is a timer to indicate that sending of a message is completed.</p>
<p>The <a class="el" href="class_radio_state.html">RadioState</a> has to be changed based on the noise level on the channel. If the noise level is bigger than the sensitivity switch to receive mode odtherwise to idle mode. </p>

<p>Reimplemented from <a class="el" href="class_basic_snr_eval.html#a6056d3736b5f4440aa95067f1e03386c">BasicSnrEval</a>.</p>

<p>Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#a16deedca42913461c667c319487eb4a4">GilbertElliotSnr</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msg-&gt;getKind() == <a class="code" href="class_snr_eval.html#a2ad9ae884cbace04cc0352681bcf0aa7a797073dbf98fa5a93132abb0138983f0" title="timer to indicate that a message is completely sent now">TRANSM_OVER</a>)
    {
        <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> &lt; <a class="code" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d" title="Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default:">sensitivity</a>)
        {
            <span class="comment">// set the RadioState to IDLE</span>
            <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>);
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;transmission over, switch to idle mode (state:IDLE)\n&quot;</span>;
            <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// set the RadioState to RECV</span>
            <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>);
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;transmission over but noise level too high, switch to recv mode (state:RECV)\n&quot;</span>;
            <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
        }

        <span class="comment">// delete the timer</span>
        <span class="keyword">delete</span> msg;

        <span class="comment">// switch channel if it needs be</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a8a1d49d7a8dea980bdc65931de889d54" title="State: if not -1, we have to switch to that channel once we finished transmitting.">newChannel</a>!=-1)
        {
            <a class="code" href="class_snr_eval.html#adb3de641480fd9d173ed354c1dfa6223" title="change transmitter and receiver to a new channel. This method throws an error if the radio state is t...">changeChannel</a>(<a class="code" href="class_snr_eval.html#a8a1d49d7a8dea980bdc65931de889d54" title="State: if not -1, we have to switch to that channel once we finished transmitting.">newChannel</a>);
            <a class="code" href="class_snr_eval.html#a8a1d49d7a8dea980bdc65931de889d54" title="State: if not -1, we have to switch to that channel once we finished transmitting.">newChannel</a> = -1;
        }
    }
    <span class="keywordflow">else</span>
        error(<span class="stringliteral">&quot;Internal error: unknown self-message `%s&#39;&quot;</span>, msg-&gt;getName());
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa001956884b5729fd1d6fabb3013d8ec"></a><!-- doxytag: member="SnrEval::handleUpperMsg" ref="aa001956884b5729fd1d6fabb3013d8ec" args="(AirFrame *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SnrEval::handleUpperMsg </td>
          <td>(</td>
          <td class="paramtype">AirFrame *&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If a message is already being transmitted, an error is raised.</p>
<p>Otherwise the <a class="el" href="class_radio_state.html">RadioState</a> is set to TRANSMIT and a timer is started. When this timer expires the <a class="el" href="class_radio_state.html">RadioState</a> will be set back to RECV (or IDLE respectively) again.</p>
<p>If the host is receiving a packet this packet is from now on only considered as noise. </p>

<p>Reimplemented from <a class="el" href="class_basic_snr_eval.html#a2eec34538f64365af3d19825140dacb8">BasicSnrEval</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>)
        error(<span class="stringliteral">&quot;Trying to send a message while already transmitting -- MAC should &quot;</span>
              <span class="stringliteral">&quot;take care this does not happen&quot;</span>);

    <span class="keywordflow">if</span> (frame-&gt;getControlInfo()!=NULL)
        error(<span class="stringliteral">&quot;Setting control info (here: %s) on frames is not supported&quot;</span>, frame-&gt;getControlInfo()-&gt;getClassName());

    <span class="comment">// if a packet was being received, it is corrupted now as should be treated as noise</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> != NULL)
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Sending a message while receiving another. The received one is now corrupted.\n&quot;</span>;

        <span class="comment">// remove the snr information stored for the message currently being</span>
        <span class="comment">// received. This message is treated as noise now and the</span>
        <span class="comment">// receive power has to be added to the noiseLevel</span>

        <span class="comment">// delete the pointer to indicate that no message is being received</span>
        <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> = NULL;
        <span class="comment">// clear the snr list</span>
        <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#aabbbbeed5ce64d9ecf216db3f79ba206" title="Snr list to store the SNR values.">sList</a>.clear();
        <span class="comment">// add the receive power to the noise level</span>
        <a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> += <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a4b048226b385794353721848560f1a29" title="Received power of the message.">rcvdPower</a>;
    }

    <span class="comment">// now we are done with all the exception handling and can take care</span>
    <span class="comment">// about the &quot;real&quot; stuff</span>

    <span class="comment">// change radio status</span>
    <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>);
    <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;sending, changing RadioState to TRANSMIT\n&quot;</span>;
    <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);

    cMessage *timer = <span class="keyword">new</span> cMessage(NULL, <a class="code" href="class_snr_eval.html#a2ad9ae884cbace04cc0352681bcf0aa7a797073dbf98fa5a93132abb0138983f0" title="timer to indicate that a message is completely sent now">TRANSM_OVER</a>);
    scheduleAt(simTime() + frame-&gt;getDuration(), timer);
    <a class="code" href="class_basic_snr_eval.html#ab24fce7973732d213aa991c89de1cf97" title="Sends a message to the channel.">sendDown</a>(frame);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a10f81696b873c5acf9b65f04592c9918"></a><!-- doxytag: member="SnrEval::initialize" ref="a10f81696b873c5acf9b65f04592c9918" args="(int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SnrEval::initialize </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize variables and publish the radio status. </p>

<p>Reimplemented from <a class="el" href="class_basic_snr_eval.html#a89445ede6f19960b30f74d17335ee30f">BasicSnrEval</a>.</p>

<p>Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#a0886205c3ab74194fb14ccd7495498df">GilbertElliotSnr</a>, and <a class="el" href="class_snr_eval80211.html#a0ebbde9edf4489102ea539ba04c13a3e">SnrEval80211</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_snr_eval.html#a10f81696b873c5acf9b65f04592c9918" title="Initialize variables and publish the radio status.">BasicSnrEval::initialize</a>(stage);

    <span class="keywordflow">if</span> (stage == 0)
    {
        gate(<span class="stringliteral">&quot;radioIn&quot;</span>)-&gt;setDeliverOnReceptionStart(<span class="keyword">true</span>);

        <span class="comment">// read parameters</span>
        <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab4ce41a963cc11f5bbd10a5d9b894a71">setChannelNumber</a>(par(<span class="stringliteral">&quot;channelNumber&quot;</span>));
        <a class="code" href="class_snr_eval.html#a728160764ec0ccea6d02a1420e0b6b72" title="Configuration: Thermal noise on the channel. Can be specified in omnetpp.ini. Default: -100 dBm...">thermalNoise</a> = <a class="code" href="class_f_w_math.html#af308407856d9835b103f2421e373ee28">FWMath::dBm2mW</a>(par(<span class="stringliteral">&quot;thermalNoise&quot;</span>));
        <a class="code" href="class_snr_eval.html#a8dd650bd6e39b5a7c61e2175317a62ae" title="Configuration: The carrier frequency used. It is read from the ChannelControl module.">carrierFrequency</a> = <a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;par(<span class="stringliteral">&quot;carrierFrequency&quot;</span>);  <span class="comment">// taken from ChannelControl</span>
        <a class="code" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d" title="Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default:">sensitivity</a> = <a class="code" href="class_f_w_math.html#af308407856d9835b103f2421e373ee28">FWMath::dBm2mW</a>(par(<span class="stringliteral">&quot;sensitivity&quot;</span>));
        <a class="code" href="class_snr_eval.html#a5db01f6393281560dfb3a75901626556" title="Configuration: Path loss coefficient. Can be specified in omnetpp.ini. If not it is read from the Cha...">pathLossAlpha</a> = par(<span class="stringliteral">&quot;pathLossAlpha&quot;</span>);
        <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a5db01f6393281560dfb3a75901626556" title="Configuration: Path loss coefficient. Can be specified in omnetpp.ini. If not it is read from the Cha...">pathLossAlpha</a> &lt; (<span class="keywordtype">double</span>) (<a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;par(<span class="stringliteral">&quot;alpha&quot;</span>)))
            error(<span class="stringliteral">&quot;SnrEval::initialize(): pathLossAlpha can&#39;t be smaller than in &quot;</span>
                  <span class="stringliteral">&quot;ChannelControl. Please adjust your omnetpp.ini file accordingly&quot;</span>);

        <span class="comment">// initialize noiseLevel</span>
        <a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> = <a class="code" href="class_snr_eval.html#a728160764ec0ccea6d02a1420e0b6b72" title="Configuration: Thermal noise on the channel. Can be specified in omnetpp.ini. Default: -100 dBm...">thermalNoise</a>;

        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Initialized channel with noise: &quot;</span> &lt;&lt; <a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> &lt;&lt; <span class="stringliteral">&quot; sensitivity: &quot;</span> &lt;&lt; <a class="code" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d" title="Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default:">sensitivity</a> &lt;&lt;
            endl;

        <span class="comment">// initialize the pointer of the snrInfo with NULL to indicate</span>
        <span class="comment">// that currently no message is received</span>
        <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently being received...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> = NULL;

        <span class="comment">// no channel switch pending</span>
        <a class="code" href="class_snr_eval.html#a8a1d49d7a8dea980bdc65931de889d54" title="State: if not -1, we have to switch to that channel once we finished transmitting.">newChannel</a> = -1;

        <span class="comment">// Initialize radio state. If thermal noise is already to high, radio</span>
        <span class="comment">// state has to be initialized as RECV</span>
        <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>);
        <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> &gt;= <a class="code" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d" title="Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default:">sensitivity</a>)
            <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>);

        WATCH(<a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a>);
        WATCH(<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stage == 1)
    {
        <span class="comment">// tell initial value to MAC; must be done in stage 1, because they</span>
        <span class="comment">// subscribe in stage 0</span>
        <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
        <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf3cbaad9c60e34c5cd7ca3da116fa468">NF_RADIO_CHANNEL_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stage == 2)
    {
        <span class="comment">// tell initial channel number to ChannelControl; should be done in</span>
        <span class="comment">// stage==2 or later, because base class initializes myHostRef in that stage</span>
        <a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;<a class="code" href="class_channel_control.html#a04bbb08c92d001b804c06ba42d8e43ea" title="Called when host switches channel.">updateHostChannel</a>(<a class="code" href="class_channel_access.html#aff3d33ee8db5a945fff05fe4305ccf2e" title="Identifies this host in the ChannelControl module.">myHostRef</a>, <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#a0799344b13882d66af3376919bdf9c7d">getChannelNumber</a>());
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae590bfa74ed33f72d11857d584979727"></a><!-- doxytag: member="SnrEval::setBitrate" ref="ae590bfa74ed33f72d11857d584979727" args="(double bitrate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SnrEval::setBitrate </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>bitrate</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>change the bitrate to the given value. This method throws an error if the radio state is transmit. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#ad6f33c127ee1bf1731a2f2999df33969">handleCommand()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_basic_snr_eval.html#a515b273855ffc377f579922d5eb68dfb" title="a parameter that has to be read in from omnetpp.ini">bitrate</a> == <a class="code" href="class_basic_snr_eval.html#a515b273855ffc377f579922d5eb68dfb" title="a parameter that has to be read in from omnetpp.ini">bitrate</a>)
        <span class="keywordflow">return</span>;
    <span class="keywordflow">if</span> (<a class="code" href="class_basic_snr_eval.html#a515b273855ffc377f579922d5eb68dfb" title="a parameter that has to be read in from omnetpp.ini">bitrate</a> &lt; 0)
        error(<span class="stringliteral">&quot;setBitrate(): bitrate cannot be negative (%g)&quot;</span>, <a class="code" href="class_basic_snr_eval.html#a515b273855ffc377f579922d5eb68dfb" title="a parameter that has to be read in from omnetpp.ini">bitrate</a>);
    <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>)
        error(<span class="stringliteral">&quot;changing the bitrate while transmitting is not allowed&quot;</span>);

    <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Setting bitrate to &quot;</span> &lt;&lt; (<a class="code" href="class_basic_snr_eval.html#a515b273855ffc377f579922d5eb68dfb" title="a parameter that has to be read in from omnetpp.ini">bitrate</a>/1e6) &lt;&lt; <span class="stringliteral">&quot;Mbps\n&quot;</span>;
    this-&gt;<a class="code" href="class_basic_snr_eval.html#a515b273855ffc377f579922d5eb68dfb" title="a parameter that has to be read in from omnetpp.ini">bitrate</a> = <a class="code" href="class_basic_snr_eval.html#a515b273855ffc377f579922d5eb68dfb" title="a parameter that has to be read in from omnetpp.ini">bitrate</a>;

    <span class="comment">//XXX fire some notification?</span>
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a8dd650bd6e39b5a7c61e2175317a62ae"></a><!-- doxytag: member="SnrEval::carrierFrequency" ref="a8dd650bd6e39b5a7c61e2175317a62ae" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_snr_eval.html#a8dd650bd6e39b5a7c61e2175317a62ae">SnrEval::carrierFrequency</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Configuration: The carrier frequency used. It is read from the <a class="el" href="class_channel_control.html" title="Monitors which hosts are &quot;in range&quot;. Supports multiple channels.">ChannelControl</a> module. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#abe78b8bf8a3b41fd8019e2a70109c201">calcRcvdPower()</a>, and <a class="el" href="class_snr_eval.html#a10f81696b873c5acf9b65f04592c9918">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a6969112c3972e3d4a752e7055d1f9264"></a><!-- doxytag: member="SnrEval::newBitrate" ref="a6969112c3972e3d4a752e7055d1f9264" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_snr_eval.html#a6969112c3972e3d4a752e7055d1f9264">SnrEval::newBitrate</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State: if not -1, we have to switch to that bitrate once we finished transmitting. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#ad6f33c127ee1bf1731a2f2999df33969">handleCommand()</a>.</p>

</div>
</div>
<a class="anchor" id="a8a1d49d7a8dea980bdc65931de889d54"></a><!-- doxytag: member="SnrEval::newChannel" ref="a8a1d49d7a8dea980bdc65931de889d54" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_snr_eval.html#a8a1d49d7a8dea980bdc65931de889d54">SnrEval::newChannel</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State: if not -1, we have to switch to that channel once we finished transmitting. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#ad6f33c127ee1bf1731a2f2999df33969">handleCommand()</a>, <a class="el" href="class_snr_eval.html#ad2d58ffa8f07856cfb6b6a7afc788e51">handleSelfMsg()</a>, and <a class="el" href="class_snr_eval.html#a10f81696b873c5acf9b65f04592c9918">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="aa3d5506d0e48b864bbb1089d5ff0f938"></a><!-- doxytag: member="SnrEval::noiseLevel" ref="aa3d5506d0e48b864bbb1089d5ff0f938" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938">SnrEval::noiseLevel</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State: the current noise level of the channel. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#abcb6a07d2956a4505c36843af15ff8f1">addNewSnr()</a>, <a class="el" href="class_snr_eval.html#ae4c093f6dc4dc649070947da6051f3b2">handleLowerMsgEnd()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a8cce1850da492f871c08ddcb3647b2ed">GilbertElliotSnr::handleLowerMsgEnd()</a>, <a class="el" href="class_snr_eval.html#aa4128b029feeaa5427ad6522fabce2eb">handleLowerMsgStart()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a7e5d2fb286b5a2a78834a6d5a7ccd392">GilbertElliotSnr::handleLowerMsgStart()</a>, <a class="el" href="class_snr_eval.html#ad2d58ffa8f07856cfb6b6a7afc788e51">handleSelfMsg()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a16deedca42913461c667c319487eb4a4">GilbertElliotSnr::handleSelfMsg()</a>, <a class="el" href="class_snr_eval.html#aa001956884b5729fd1d6fabb3013d8ec">handleUpperMsg()</a>, and <a class="el" href="class_snr_eval.html#a10f81696b873c5acf9b65f04592c9918">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a5db01f6393281560dfb3a75901626556"></a><!-- doxytag: member="SnrEval::pathLossAlpha" ref="a5db01f6393281560dfb3a75901626556" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_snr_eval.html#a5db01f6393281560dfb3a75901626556">SnrEval::pathLossAlpha</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Configuration: Path loss coefficient. Can be specified in omnetpp.ini. If not it is read from the <a class="el" href="class_channel_control.html" title="Monitors which hosts are &quot;in range&quot;. Supports multiple channels.">ChannelControl</a> module. This value CANNOT be smaller than the one specified in the <a class="el" href="class_channel_control.html" title="Monitors which hosts are &quot;in range&quot;. Supports multiple channels.">ChannelControl</a> module, or the simulation will exit with an error! </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#abe78b8bf8a3b41fd8019e2a70109c201">calcRcvdPower()</a>, and <a class="el" href="class_snr_eval.html#a10f81696b873c5acf9b65f04592c9918">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a4348a6ef7a0ca5ff22d56b16394b0522"></a><!-- doxytag: member="SnrEval::recvBuff" ref="a4348a6ef7a0ca5ff22d56b16394b0522" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_snr_eval.html#a4f5f9f9cb0bc9e9ac1517f000cd00a84">RecvBuff</a> <a class="el" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522">SnrEval::recvBuff</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State: A buffer to store a pointer to a message and the related receive power. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#adb3de641480fd9d173ed354c1dfa6223">changeChannel()</a>, <a class="el" href="class_snr_eval.html#ae4c093f6dc4dc649070947da6051f3b2">handleLowerMsgEnd()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a8cce1850da492f871c08ddcb3647b2ed">GilbertElliotSnr::handleLowerMsgEnd()</a>, <a class="el" href="class_snr_eval.html#aa4128b029feeaa5427ad6522fabce2eb">handleLowerMsgStart()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a7e5d2fb286b5a2a78834a6d5a7ccd392">GilbertElliotSnr::handleLowerMsgStart()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a16deedca42913461c667c319487eb4a4">GilbertElliotSnr::handleSelfMsg()</a>, and <a class="el" href="class_snr_eval.html#a06a6561a83bc25e52859666d4f732197">~SnrEval()</a>.</p>

</div>
</div>
<a class="anchor" id="a5cb463a0967ec147b4747f1ddf3c5255"></a><!-- doxytag: member="SnrEval::rs" ref="a5cb463a0967ec147b4747f1ddf3c5255" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_radio_state.html">RadioState</a> <a class="el" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255">SnrEval::rs</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State: the current <a class="el" href="class_radio_state.html">RadioState</a> of the NIC; includes channel number. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#adb3de641480fd9d173ed354c1dfa6223">changeChannel()</a>, <a class="el" href="class_snr_eval.html#ad6f33c127ee1bf1731a2f2999df33969">handleCommand()</a>, <a class="el" href="class_snr_eval.html#ae4c093f6dc4dc649070947da6051f3b2">handleLowerMsgEnd()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a8cce1850da492f871c08ddcb3647b2ed">GilbertElliotSnr::handleLowerMsgEnd()</a>, <a class="el" href="class_snr_eval.html#aa4128b029feeaa5427ad6522fabce2eb">handleLowerMsgStart()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a7e5d2fb286b5a2a78834a6d5a7ccd392">GilbertElliotSnr::handleLowerMsgStart()</a>, <a class="el" href="class_snr_eval.html#ad2d58ffa8f07856cfb6b6a7afc788e51">handleSelfMsg()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a16deedca42913461c667c319487eb4a4">GilbertElliotSnr::handleSelfMsg()</a>, <a class="el" href="class_snr_eval.html#aa001956884b5729fd1d6fabb3013d8ec">handleUpperMsg()</a>, <a class="el" href="class_snr_eval.html#a10f81696b873c5acf9b65f04592c9918">initialize()</a>, and <a class="el" href="class_snr_eval.html#ae590bfa74ed33f72d11857d584979727">setBitrate()</a>.</p>

</div>
</div>
<a class="anchor" id="a5fa6897f988f66115b1217db51eb379d"></a><!-- doxytag: member="SnrEval::sensitivity" ref="a5fa6897f988f66115b1217db51eb379d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d">SnrEval::sensitivity</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default: </p>
<p>-85 dBm </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#ae4c093f6dc4dc649070947da6051f3b2">handleLowerMsgEnd()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a8cce1850da492f871c08ddcb3647b2ed">GilbertElliotSnr::handleLowerMsgEnd()</a>, <a class="el" href="class_snr_eval.html#aa4128b029feeaa5427ad6522fabce2eb">handleLowerMsgStart()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a7e5d2fb286b5a2a78834a6d5a7ccd392">GilbertElliotSnr::handleLowerMsgStart()</a>, <a class="el" href="class_snr_eval.html#ad2d58ffa8f07856cfb6b6a7afc788e51">handleSelfMsg()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a16deedca42913461c667c319487eb4a4">GilbertElliotSnr::handleSelfMsg()</a>, and <a class="el" href="class_snr_eval.html#a10f81696b873c5acf9b65f04592c9918">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a73fab3747cf312107fed650c2dbd7f4d"></a><!-- doxytag: member="SnrEval::snrInfo" ref="a73fab3747cf312107fed650c2dbd7f4d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_snr_eval_1_1_snr_struct.html">SnrStruct</a> <a class="el" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d">SnrEval::snrInfo</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State: SnrInfo stores the snrList and the the recvdPower for the message currently being received, together with a pointer to the message. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#abcb6a07d2956a4505c36843af15ff8f1">addNewSnr()</a>, <a class="el" href="class_snr_eval.html#adb3de641480fd9d173ed354c1dfa6223">changeChannel()</a>, <a class="el" href="class_snr_eval.html#ae4c093f6dc4dc649070947da6051f3b2">handleLowerMsgEnd()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a8cce1850da492f871c08ddcb3647b2ed">GilbertElliotSnr::handleLowerMsgEnd()</a>, <a class="el" href="class_snr_eval.html#aa4128b029feeaa5427ad6522fabce2eb">handleLowerMsgStart()</a>, <a class="el" href="class_gilbert_elliot_snr.html#a7e5d2fb286b5a2a78834a6d5a7ccd392">GilbertElliotSnr::handleLowerMsgStart()</a>, <a class="el" href="class_snr_eval.html#aa001956884b5729fd1d6fabb3013d8ec">handleUpperMsg()</a>, and <a class="el" href="class_snr_eval.html#a10f81696b873c5acf9b65f04592c9918">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a728160764ec0ccea6d02a1420e0b6b72"></a><!-- doxytag: member="SnrEval::thermalNoise" ref="a728160764ec0ccea6d02a1420e0b6b72" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_snr_eval.html#a728160764ec0ccea6d02a1420e0b6b72">SnrEval::thermalNoise</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Configuration: Thermal noise on the channel. Can be specified in omnetpp.ini. Default: -100 dBm. </p>

<p>Referenced by <a class="el" href="class_snr_eval.html#a10f81696b873c5acf9b65f04592c9918">initialize()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_snr_eval_8h.html">SnrEval.h</a></li>
<li><a class="el" href="_snr_eval_8cc.html">SnrEval.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_snr_eval.html">SnrEval</a>      </li>
      <li class="footer">Generated on Fri Nov 18 2011 12:47:16 for INET Framework for OMNeT++/OMNEST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>

</body>
</html>
