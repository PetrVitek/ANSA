<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>INET Framework for OMNeT++/OMNEST: AbstractRadio Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">INET Framework for OMNeT++/OMNEST
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_abstract_radio.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-types">Protected Types</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">AbstractRadio Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="AbstractRadio" --><!-- doxytag: inherits="ChannelAccess" -->
<p><code>#include &lt;<a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for AbstractRadio:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_abstract_radio.png" usemap="#AbstractRadio_map" alt=""/>
  <map id="AbstractRadio_map" name="AbstractRadio_map">
<area href="class_channel_access.html" title="Basic class for all physical layers, please don&#39;t touch!!" alt="ChannelAccess" shape="rect" coords="56,112,159,136"/>
<area href="class_basic_module.html" title="Base class for all simple modules of a host that want to have access to the NotificationBoard module..." alt="BasicModule" shape="rect" coords="56,56,159,80"/>
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="56,0,159,24"/>
<area href="class_generic_radio.html" alt="GenericRadio" shape="rect" coords="0,224,103,248"/>
<area href="class_ieee80211_radio.html" alt="Ieee80211Radio" shape="rect" coords="113,224,216,248"/>
</map>
 </div></div>

<p><a href="class_abstract_radio-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_abstract_radio_1_1_snr_struct.html">SnrStruct</a></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a7438e8075f8a43bed2d5f2495993905c">AbstractRadio</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a2ae96666e302359b8441895f3dc8d716">~AbstractRadio</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-types"></a>
Protected Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::map&lt; <a class="el" href="class_air_frame.html">AirFrame</a> <br class="typebreak"/>
*, double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#ab742103aa6adec5989a47fca51059026">RecvBuff</a></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#ad646c42cb1ee4b8fa5d0bf555a6ef0fe">initialize</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Register with <a class="el" href="class_channel_control.html" title="Monitors which hosts are &quot;in range&quot;. Supports multiple channels.">ChannelControl</a> and subscribe to hostPos.  <a href="#ad646c42cb1ee4b8fa5d0bf555a6ef0fe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a618ff4c01fa836ccf906d7dee514c214">finish</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#aa7800db11fac1c18457a7d5c57d81c3d">handleMessage</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#aee4b43805a3b94cbb1b65b698a80f3bf">handleUpperMsg</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a3035e4a5d365d6a5a9267329199fa3a6">handleSelfMsg</a> (cMessage *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a364d17ee4e46c541896622141607c0c0">handleCommand</a> (int msgkind, cPolymorphic *ctrl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#ab99c16474f3d123d1597f5b67c985e7e">handleLowerMsgStart</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *airframe)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer the frame and update noise levels and snr information.  <a href="#ab99c16474f3d123d1597f5b67c985e7e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a1f8cd41c9dc2c34f51e1c68b561c27cf">handleLowerMsgEnd</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *airframe)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Unbuffer the frame and update noise levels and snr information.  <a href="#a1f8cd41c9dc2c34f51e1c68b561c27cf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a9a0a19c2ffd8a9f1a516c368a6e4b7b0">bufferMsg</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *airframe)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffers message for 'transmission time'.  <a href="#a9a0a19c2ffd8a9f1a516c368a6e4b7b0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_air_frame.html">AirFrame</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a64e2958a548e3cf480f1afe215e1dea9">unbufferMsg</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Unbuffers a message after 'transmission time'.  <a href="#a64e2958a548e3cf480f1afe215e1dea9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a31ac7ea59c04d9614d6f61e72ab2e3b4">sendUp</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *airframe)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a871595ad4b30a0dc843899edce0c6897">sendDown</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *airframe)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_air_frame.html">AirFrame</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#aca7489dae305d0afeaa9d2beda764dc2">encapsulatePacket</a> (cPacket *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a0d0a613aba5a78acd1b4eb8fdb31f112">setRadioState</a> (<a class="el" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449">RadioState::State</a> newState)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a5d08dc0ef0b75513e2a2c1a7ea8397fb">getChannelNumber</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a98b9b9d5f0124b4c292b372aae123913">addNewSnr</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_air_frame.html">AirFrame</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a2d6020e8f7601cc7dbbe71500cab6c26">createAirFrame</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#adf9361bf91285886c54fbc917c8e3e89">changeChannel</a> (int channel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a2d2c984f3ad5621135b287615b2e4147">setBitrate</a> (double bitrate)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_i_reception_model.html">IReceptionModel</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a6cf413915eeb3105a89acaf1d6e4e894">createReceptionModel</a> ()=0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_i_radio_model.html">IRadioModel</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a59a22e03b4bd27c61e3f966e4185cd02">createRadioModel</a> ()=0</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_i_radio_model.html">IRadioModel</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a7e6436fc8bb1931f46c47ae7a7446d01">radioModel</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_i_reception_model.html">IReceptionModel</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a2d472dafa39234e2d2ceb3c77ca20c4f">receptionModel</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a3b2cd111e9febcbced779a755c4a960a">transmitterPower</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_abstract_radio_1_1_snr_struct.html">SnrStruct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_abstract_radio.html#ab742103aa6adec5989a47fca51059026">RecvBuff</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a4555680a6bf06aebbbed01a67c03b638">recvBuff</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_radio_state.html">RadioState</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a198f3ac6a1ab6a0f7252bebb4048ca47">newChannel</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#a7e23b50ae626be43197b6950a772537d">newBitrate</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#afd694d58688e028489f993597a9f44af">carrierFrequency</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#aeff3be287270fa5332e3bb4db3955cee">thermalNoise</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#aff52d795ae9cc6d12075ad120848da44">sensitivity</a></td></tr>
<tr><td colspan="2"><div class="groupHeader">Gate Ids</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#ab4183b07dda8b3909b5e098990f1f420">uppergateOut</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_abstract_radio.html#ae9254113d76c6aeecfaf2483105ae824">uppergateIn</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Abstract base class for radio modules. Radio modules deal with the transmission of frames over a wireless medium (the radio channel). See the Radio module's NED documentation for an overview of radio modules.</p>
<p>This class implements common functionality of the radio, and abstracts out specific parts into two interfaces, <a class="el" href="class_i_reception_model.html">IReceptionModel</a> and <a class="el" href="class_i_radio_model.html">IRadioModel</a>. The reception model is responsible for modelling path loss, interference and antenna gain. The radio model is responsible for calculating frame duration, and modelling modulation scheme and possible forward error correction. Subclasses have to redefine the <code><a class="el" href="class_abstract_radio.html#a6cf413915eeb3105a89acaf1d6e4e894">createReceptionModel()</a></code> and <code><a class="el" href="class_abstract_radio.html#a59a22e03b4bd27c61e3f966e4185cd02">createRadioModel()</a></code> methods to create and return appropriate reception model and radio model objects.</p>
<p><b>History</b></p>
<p>The implementation is largely based on the Mobility Framework's <a class="el" href="class_snr_eval.html" title="Keeps track of the different snir levels when receiving a packet.">SnrEval</a> and Decider modules. They have been merged into a single module, multi-channel support, runtime channel and bitrate switching capability added, and all code specific to the physical channel and radio characteristics have been factored out into the <a class="el" href="class_i_reception_model.html">IReceptionModel</a> and <a class="el" href="class_i_radio_model.html">IRadioModel</a> classes.</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Andras Varga, Levente Meszaros </dd></dl>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00056">56</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>
</div><hr/><h2>Member Typedef Documentation</h2>
<a class="anchor" id="ab742103aa6adec5989a47fca51059026"></a><!-- doxytag: member="AbstractRadio::RecvBuff" ref="ab742103aa6adec5989a47fca51059026" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::map&lt;<a class="el" href="class_air_frame.html">AirFrame</a>*,double&gt; <a class="el" href="class_abstract_radio.html#ab742103aa6adec5989a47fca51059026">AbstractRadio::RecvBuff</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Typedef used to store received messages together with receive power. </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00171">171</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a7438e8075f8a43bed2d5f2495993905c"></a><!-- doxytag: member="AbstractRadio::AbstractRadio" ref="a7438e8075f8a43bed2d5f2495993905c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_abstract_radio.html#a7438e8075f8a43bed2d5f2495993905c">AbstractRadio::AbstractRadio</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00030">30</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>
<div class="fragment"><pre class="fragment">                             : <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>(this-&gt;getId())
{
    <a class="code" href="class_abstract_radio.html#a7e6436fc8bb1931f46c47ae7a7446d01">radioModel</a> = NULL;
    <a class="code" href="class_abstract_radio.html#a2d472dafa39234e2d2ceb3c77ca20c4f">receptionModel</a> = NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2ae96666e302359b8441895f3dc8d716"></a><!-- doxytag: member="AbstractRadio::~AbstractRadio" ref="a2ae96666e302359b8441895f3dc8d716" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_abstract_radio.html#a2ae96666e302359b8441895f3dc8d716">AbstractRadio::~AbstractRadio</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00106">106</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">delete</span> <a class="code" href="class_abstract_radio.html#a7e6436fc8bb1931f46c47ae7a7446d01">radioModel</a>;
    <span class="keyword">delete</span> <a class="code" href="class_abstract_radio.html#a2d472dafa39234e2d2ceb3c77ca20c4f">receptionModel</a>;

    <span class="comment">// delete messages being received</span>
    <span class="keywordflow">for</span> (RecvBuff::iterator it = <a class="code" href="class_abstract_radio.html#a4555680a6bf06aebbbed01a67c03b638">recvBuff</a>.begin(); it!=<a class="code" href="class_abstract_radio.html#a4555680a6bf06aebbbed01a67c03b638">recvBuff</a>.end(); ++it)
        <span class="keyword">delete</span> it-&gt;first;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a98b9b9d5f0124b4c292b372aae123913"></a><!-- doxytag: member="AbstractRadio::addNewSnr" ref="a98b9b9d5f0124b4c292b372aae123913" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#a98b9b9d5f0124b4c292b372aae123913">AbstractRadio::addNewSnr</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Updates the SNR information of the relevant <a class="el" href="class_air_frame.html">AirFrame</a> </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00530">530</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00467">handleLowerMsgEnd()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00391">handleLowerMsgStart()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct_snr_list_entry.html" title="struct for SNR information">SnrListEntry</a> listEntry;     <span class="comment">// create a new entry</span>
    listEntry.<a class="code" href="struct_snr_list_entry.html#a0a91ab67cfd340b315a7badf6da14ce8" title="timestamp for this SNR value">time</a> = simTime();
    listEntry.<a class="code" href="struct_snr_list_entry.html#a9126b6070ee24b0a586a267de6ebc94b" title="the SNR value">snr</a> = <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a4d916ac27467f3f7dd5ebec0689b4887" title="received power of the message">rcvdPower</a> / <a class="code" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a>;
    <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a69a0eeb12fe8bf0c96afb82c2a720077" title="stores SNR over time">sList</a>.push_back(listEntry);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9a0a19c2ffd8a9f1a516c368a6e4b7b0"></a><!-- doxytag: member="AbstractRadio::bufferMsg" ref="a9a0a19c2ffd8a9f1a516c368a6e4b7b0" args="(AirFrame *airframe)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#a9a0a19c2ffd8a9f1a516c368a6e4b7b0">AbstractRadio::bufferMsg</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_air_frame.html">AirFrame</a> *&#160;</td>
          <td class="paramname"><em>airframe</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Buffers message for 'transmission time'. </p>
<p>The packet is put in a buffer for the time the transmission would last in reality. A timer indicates when the transmission is complete. So, look at unbufferMsg to see what happens when the transmission is complete.. </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00173">173</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00538">changeChannel()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00131">handleMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// set timer to indicate transmission is complete</span>
    cMessage *endRxTimer = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;endRx&quot;</span>, <a class="code" href="_abstract_radio_8cc.html#aebda9a0d17a20bb583e3a05765538194">MK_RECEPTION_COMPLETE</a>);
    endRxTimer-&gt;setContextPointer(airframe);
    airframe-&gt;setContextPointer(endRxTimer);

    <span class="comment">// NOTE: use arrivalTime instead of simTime, because we might be calling this</span>
    <span class="comment">// function during a channel change, when we&#39;re picking up ongoing transmissions</span>
    <span class="comment">// on the channel -- and then the message&#39;s arrival time is in the past!</span>
    scheduleAt(airframe-&gt;getArrivalTime() + airframe-&gt;<a class="code" href="class_air_frame.html#a564aa81be93f77dfd92846f53d6c9f40">getDuration</a>(), endRxTimer);
}
</pre></div>
</div>
</div>
<a class="anchor" id="adf9361bf91285886c54fbc917c8e3e89"></a><!-- doxytag: member="AbstractRadio::changeChannel" ref="adf9361bf91285886c54fbc917c8e3e89" args="(int channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#adf9361bf91285886c54fbc917c8e3e89">AbstractRadio::changeChannel</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>channel</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Change transmitter and receiver to a new channel. This method throws an error if the radio state is transmit. Messages that are already sent to the new channel and would reach us in the future - thus they are on the air - will be received correctly. </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00538">538</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00278">handleCommand()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00321">handleSelfMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (channel == <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#a0799344b13882d66af3376919bdf9c7d">getChannelNumber</a>())
        <span class="keywordflow">return</span>;
    <span class="keywordflow">if</span> (channel &lt; 0 || channel &gt;= <a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;<a class="code" href="class_channel_control.html#ac3a565b50d10c70e4fe2e7a0442aa086" title="Returns the number of radio channels (frequencies) simulated.">getNumChannels</a>())
        error(<span class="stringliteral">&quot;changeChannel(): channel number %d is out of range (hint: numChannels is a parameter of ChannelControl)&quot;</span>, channel);
    <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>)
        error(<span class="stringliteral">&quot;changing channel while transmitting is not allowed&quot;</span>);

    <span class="comment">// if we are currently receiving, must clean that up before moving to different channel</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>)
    {
        <span class="comment">// delete messages being received, and cancel associated self-messages</span>
        <span class="keywordflow">for</span> (RecvBuff::iterator it = <a class="code" href="class_abstract_radio.html#a4555680a6bf06aebbbed01a67c03b638">recvBuff</a>.begin(); it!=<a class="code" href="class_abstract_radio.html#a4555680a6bf06aebbbed01a67c03b638">recvBuff</a>.end(); ++it)
        {
            <a class="code" href="class_air_frame.html">AirFrame</a> *airframe = it-&gt;first;
            cMessage *endRxTimer = (cMessage *)airframe-&gt;getContextPointer();
            <span class="keyword">delete</span> airframe;
            <span class="keyword">delete</span> cancelEvent(endRxTimer);
        }
        <a class="code" href="class_abstract_radio.html#a4555680a6bf06aebbbed01a67c03b638">recvBuff</a>.clear();
    }

    <span class="comment">// clear snr info</span>
    <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a50829d26259d1bb7cbbff74179e8a800" title="pointer to the message this information belongs to">ptr</a> = NULL;
    <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a69a0eeb12fe8bf0c96afb82c2a720077" title="stores SNR over time">sList</a>.clear();

    <span class="comment">// do channel switch</span>
    <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Changing to channel #&quot;</span> &lt;&lt; channel &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

    <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab4ce41a963cc11f5bbd10a5d9b894a71">setChannelNumber</a>(channel);
    <a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;<a class="code" href="class_channel_control.html#a04bbb08c92d001b804c06ba42d8e43ea" title="Called when host switches channel.">updateHostChannel</a>(<a class="code" href="class_channel_access.html#aff3d33ee8db5a945fff05fe4305ccf2e" title="Identifies this host in the ChannelControl module.">myHostRef</a>, channel);
    <a class="code" href="class_channel_control.html#a3d946c87c47729fdd4ad4ae9a17b406f">ChannelControl::TransmissionList</a> tl = <a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;<a class="code" href="class_channel_control.html#a29b60c6b3cdaa3c63a9c48e83beb9f9e" title="Provides a list of transmissions currently on the air.">getOngoingTransmissions</a>(channel);

    cModule *myHost = <a class="code" href="class_basic_module.html#a8188a32c320b4632bdd2c0e7241d06f8" title="Function to get a pointer to the host module.">findHost</a>();
    cGate *radioGate = myHost-&gt;gate(<span class="stringliteral">&quot;radioIn&quot;</span>);

    <span class="comment">// pick up ongoing transmissions on the new channel</span>
    <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Picking up ongoing transmissions on new channel:\n&quot;</span>;
    <span class="keywordflow">for</span> (ChannelControl::TransmissionList::const_iterator it = tl.begin(); it != tl.end(); ++it)
    {
        <a class="code" href="class_air_frame.html">AirFrame</a> *airframe = *it;
        <span class="comment">// time for the message to reach us</span>
        <span class="keywordtype">double</span> distance = <a class="code" href="class_channel_access.html#aff3d33ee8db5a945fff05fe4305ccf2e" title="Identifies this host in the ChannelControl module.">myHostRef</a>-&gt;<a class="code" href="struct_channel_control_1_1_host_entry.html#a3e6df3511ce1af969e4dc2254f7f4c40">pos</a>.<a class="code" href="class_coord.html#ab6a7bfcc5c55e5d8edbc7c0cb5a11626">distance</a>(airframe-&gt;<a class="code" href="class_air_frame.html#a6330e718269d5471a1beaeba7b505a60">getSenderPos</a>());
        simtime_t propagationDelay = distance / <a class="code" href="_channel_control_8h.html#a2f3addaba3e40cfb6e78224398707712">LIGHT_SPEED</a>;

        <span class="comment">// if this transmission is on our new channel and it would reach us in the future, then schedule it</span>
        <span class="keywordflow">if</span> (channel == airframe-&gt;<a class="code" href="class_air_frame.html#a8cabf7478ff3a18c0c535eee85afdd01">getChannelNumber</a>())
        {
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot; - (&quot;</span> &lt;&lt; airframe-&gt;getClassName() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; airframe-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;

            <span class="comment">// if there is a message on the air which will reach us in the future</span>
            <span class="keywordflow">if</span> (airframe-&gt;getTimestamp() + propagationDelay &gt;= simTime())
            {
                 <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;will arrive in the future, scheduling it\n&quot;</span>;

                 <span class="comment">// we need to send to each radioIn[] gate of this host</span>
                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacecesnet.html#a2d959620f0e772e579c21833995d082e">i</a> = 0; <a class="code" href="namespacecesnet.html#a2d959620f0e772e579c21833995d082e">i</a> &lt; radioGate-&gt;size(); <a class="code" href="namespacecesnet.html#a2d959620f0e772e579c21833995d082e">i</a>++)
                     sendDirect(airframe-&gt;<a class="code" href="class_air_frame.html#aee29f72e2445142e19cfb652f6d2f0ff">dup</a>(), airframe-&gt;getTimestamp() + propagationDelay - simTime(), airframe-&gt;<a class="code" href="class_air_frame.html#a564aa81be93f77dfd92846f53d6c9f40">getDuration</a>(), myHost, radioGate-&gt;getId() + <a class="code" href="namespacecesnet.html#a2d959620f0e772e579c21833995d082e">i</a>);
            }
            <span class="comment">// if we hear some part of the message</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (airframe-&gt;getTimestamp() + airframe-&gt;<a class="code" href="class_air_frame.html#a564aa81be93f77dfd92846f53d6c9f40">getDuration</a>() + propagationDelay &gt; simTime())
            {
                 <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;missed beginning of frame, processing it as noise\n&quot;</span>;

                 <a class="code" href="class_air_frame.html">AirFrame</a> *frameDup = airframe-&gt;<a class="code" href="class_air_frame.html#aee29f72e2445142e19cfb652f6d2f0ff">dup</a>();
                 frameDup-&gt;setArrivalTime(airframe-&gt;getTimestamp() + propagationDelay);
                 <a class="code" href="class_abstract_radio.html#ab99c16474f3d123d1597f5b67c985e7e" title="Buffer the frame and update noise levels and snr information.">handleLowerMsgStart</a>(frameDup);
                 <a class="code" href="class_abstract_radio.html#a9a0a19c2ffd8a9f1a516c368a6e4b7b0" title="Buffers message for &#39;transmission time&#39;.">bufferMsg</a>(frameDup);
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;in the past\n&quot;</span>;
            }
        }
    }

    <span class="comment">// notify other modules about the channel switch; and actually, radio state has changed too</span>
    <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf3cbaad9c60e34c5cd7ca3da116fa468">NF_RADIO_CHANNEL_CHANGED</a>, &amp;<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>);
    <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2d6020e8f7601cc7dbbe71500cab6c26"></a><!-- doxytag: member="AbstractRadio::createAirFrame" ref="a2d6020e8f7601cc7dbbe71500cab6c26" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="class_air_frame.html">AirFrame</a>* <a class="el" href="class_abstract_radio.html#a2d6020e8f7601cc7dbbe71500cab6c26">AbstractRadio::createAirFrame</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Create a new <a class="el" href="class_air_frame.html">AirFrame</a> </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00105">105</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00186">encapsulatePacket()</a>.</p>
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_air_frame.html">AirFrame</a>();}
</pre></div>
</div>
</div>
<a class="anchor" id="a59a22e03b4bd27c61e3f966e4185cd02"></a><!-- doxytag: member="AbstractRadio::createRadioModel" ref="a59a22e03b4bd27c61e3f966e4185cd02" args="()=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="class_i_radio_model.html">IRadioModel</a>* <a class="el" href="class_abstract_radio.html#a59a22e03b4bd27c61e3f966e4185cd02">AbstractRadio::createRadioModel</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>To be defined to provide a radio model. The radio model is responsible for calculating frame duration, and modelling modulation scheme and possible forward error correction. </p>

<p>Implemented in <a class="el" href="class_ieee80211_radio.html#a10bdd18bd10609839e32cdea7c41a94f">Ieee80211Radio</a>, and <a class="el" href="class_generic_radio.html#a147fee60c155fca1b49d708f9d63b934">GenericRadio</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a6cf413915eeb3105a89acaf1d6e4e894"></a><!-- doxytag: member="AbstractRadio::createReceptionModel" ref="a6cf413915eeb3105a89acaf1d6e4e894" args="()=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="class_i_reception_model.html">IReceptionModel</a>* <a class="el" href="class_abstract_radio.html#a6cf413915eeb3105a89acaf1d6e4e894">AbstractRadio::createReceptionModel</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>To be defined to provide a reception model. The reception model is responsible for modelling path loss, interference and antenna gain. </p>

<p>Implemented in <a class="el" href="class_ieee80211_radio.html#ac7bbaea9583465433f8c1dc17c2cf757">Ieee80211Radio</a>, and <a class="el" href="class_generic_radio.html#a61aa21621eeb1ee1afd0a404dbe9197e">GenericRadio</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="aca7489dae305d0afeaa9d2beda764dc2"></a><!-- doxytag: member="AbstractRadio::encapsulatePacket" ref="aca7489dae305d0afeaa9d2beda764dc2" args="(cPacket *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_air_frame.html">AirFrame</a> * <a class="el" href="class_abstract_radio.html#aca7489dae305d0afeaa9d2beda764dc2">AbstractRadio::encapsulatePacket</a> </td>
          <td>(</td>
          <td class="paramtype">cPacket *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Encapsulates a MAC frame into an Air Frame </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00186">186</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00131">handleMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_phy_control_info.html">PhyControlInfo</a> *ctrl = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_phy_control_info.html">PhyControlInfo</a> *<span class="keyword">&gt;</span>(frame-&gt;removeControlInfo());
    ASSERT(!ctrl || ctrl-&gt;<a class="code" href="class_phy_control_info.html#adf34f991f466b2ed39bcc3d484612167">getChannelNumber</a>()==-1); <span class="comment">// per-packet channel switching not supported</span>

    <span class="comment">// Note: we don&#39;t set length() of the AirFrame, because duration will be used everywhere instead</span>
    <a class="code" href="class_air_frame.html">AirFrame</a> *airframe = <a class="code" href="class_abstract_radio.html#a2d6020e8f7601cc7dbbe71500cab6c26">createAirFrame</a>();
    airframe-&gt;setName(frame-&gt;getName());
    airframe-&gt;setPSend(<a class="code" href="class_abstract_radio.html#a3b2cd111e9febcbced779a755c4a960a">transmitterPower</a>);
    airframe-&gt;setChannelNumber(<a class="code" href="class_abstract_radio.html#a5d08dc0ef0b75513e2a2c1a7ea8397fb">getChannelNumber</a>());
    airframe-&gt;encapsulate(frame);
    airframe-&gt;setBitrate(ctrl ? ctrl-&gt;<a class="code" href="class_phy_control_info.html#a75467afe8d5de4d4aa72e8f773117736">getBitrate</a>() : <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#a2f127045c28c2a709aa1212ba098b9b4">getBitrate</a>());
    airframe-&gt;setDuration(<a class="code" href="class_abstract_radio.html#a7e6436fc8bb1931f46c47ae7a7446d01">radioModel</a>-&gt;<a class="code" href="class_i_radio_model.html#af8aff6a5a5c7b81321818141c7d97b95">calculateDuration</a>(airframe));
    airframe-&gt;setSenderPos(<a class="code" href="class_channel_access.html#a9e51969a624ff64101cf808514d50d4f" title="Returns the host&#39;s position.">getMyPosition</a>());
    <span class="keyword">delete</span> ctrl;

    <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Frame (&quot;</span> &lt;&lt; frame-&gt;getClassName() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; frame-&gt;getName()
       &lt;&lt; <span class="stringliteral">&quot; will be transmitted at &quot;</span> &lt;&lt; (airframe-&gt;getBitrate()/1e6) &lt;&lt; <span class="stringliteral">&quot;Mbps\n&quot;</span>;
    <span class="keywordflow">return</span> airframe;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a618ff4c01fa836ccf906d7dee514c214"></a><!-- doxytag: member="AbstractRadio::finish" ref="a618ff4c01fa836ccf906d7dee514c214" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#a618ff4c01fa836ccf906d7dee514c214">AbstractRadio::finish</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00102">102</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5d08dc0ef0b75513e2a2c1a7ea8397fb"></a><!-- doxytag: member="AbstractRadio::getChannelNumber" ref="a5d08dc0ef0b75513e2a2c1a7ea8397fb" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual int <a class="el" href="class_abstract_radio.html#a5d08dc0ef0b75513e2a2c1a7ea8397fb">AbstractRadio::getChannelNumber</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Returns the current channel the radio is tuned to </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00099">99</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00186">encapsulatePacket()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00131">handleMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#a0799344b13882d66af3376919bdf9c7d">getChannelNumber</a>();}
</pre></div>
</div>
</div>
<a class="anchor" id="a364d17ee4e46c541896622141607c0c0"></a><!-- doxytag: member="AbstractRadio::handleCommand" ref="a364d17ee4e46c541896622141607c0c0" args="(int msgkind, cPolymorphic *ctrl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#a364d17ee4e46c541896622141607c0c0">AbstractRadio::handleCommand</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>msgkind</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00278">278</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00131">handleMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msgkind==<a class="code" href="_phy_control_info__m_8h.html#a827a8f9f0f91bb52136f8f155337862fa5eb8d08b5c380e0589a4622fa0ca5ee9">PHY_C_CONFIGURERADIO</a>)
    {
        <span class="comment">// extract new channel number</span>
        <a class="code" href="class_phy_control_info.html">PhyControlInfo</a> *phyCtrl = check_and_cast&lt;<a class="code" href="class_phy_control_info.html">PhyControlInfo</a> *&gt;(ctrl);
        <span class="keywordtype">int</span> <a class="code" href="class_abstract_radio.html#a198f3ac6a1ab6a0f7252bebb4048ca47">newChannel</a> = phyCtrl-&gt;<a class="code" href="class_phy_control_info.html#adf34f991f466b2ed39bcc3d484612167">getChannelNumber</a>();
        <span class="keywordtype">double</span> <a class="code" href="class_abstract_radio.html#a7e23b50ae626be43197b6950a772537d">newBitrate</a> = phyCtrl-&gt;<a class="code" href="class_phy_control_info.html#a75467afe8d5de4d4aa72e8f773117736">getBitrate</a>();
        <span class="keyword">delete</span> ctrl;

        <span class="keywordflow">if</span> (newChannel!=-1)
        {
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Command received: change to channel #&quot;</span> &lt;&lt; newChannel &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

            <span class="comment">// do it</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#a0799344b13882d66af3376919bdf9c7d">getChannelNumber</a>()==<a class="code" href="class_abstract_radio.html#a198f3ac6a1ab6a0f7252bebb4048ca47">newChannel</a>)
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Right on that channel, nothing to do\n&quot;</span>; <span class="comment">// fine, nothing to do</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>()==<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>) {
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;We&#39;re transmitting right now, remembering to change after it&#39;s completed\n&quot;</span>;
                this-&gt;newChannel = <a class="code" href="class_abstract_radio.html#a198f3ac6a1ab6a0f7252bebb4048ca47">newChannel</a>;
            } <span class="keywordflow">else</span>
                <a class="code" href="class_abstract_radio.html#adf9361bf91285886c54fbc917c8e3e89">changeChannel</a>(newChannel); <span class="comment">// change channel right now</span>
        }
        <span class="keywordflow">if</span> (newBitrate!=-1)
        {
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Command received: change bitrate to &quot;</span> &lt;&lt; (newBitrate/1e6) &lt;&lt; <span class="stringliteral">&quot;Mbps\n&quot;</span>;

            <span class="comment">// do it</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#a2f127045c28c2a709aa1212ba098b9b4">getBitrate</a>()==<a class="code" href="class_abstract_radio.html#a7e23b50ae626be43197b6950a772537d">newBitrate</a>)
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Right at that bitrate, nothing to do\n&quot;</span>; <span class="comment">// fine, nothing to do</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>()==<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>) {
                <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;We&#39;re transmitting right now, remembering to change after it&#39;s completed\n&quot;</span>;
                this-&gt;newBitrate = <a class="code" href="class_abstract_radio.html#a7e23b50ae626be43197b6950a772537d">newBitrate</a>;
            } <span class="keywordflow">else</span>
                <a class="code" href="class_abstract_radio.html#a2d2c984f3ad5621135b287615b2e4147">setBitrate</a>(newBitrate); <span class="comment">// change bitrate right now</span>
        }
    }
    <span class="keywordflow">else</span>
    {
        error(<span class="stringliteral">&quot;unknown command (msgkind=%d)&quot;</span>, msgkind);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1f8cd41c9dc2c34f51e1c68b561c27cf"></a><!-- doxytag: member="AbstractRadio::handleLowerMsgEnd" ref="a1f8cd41c9dc2c34f51e1c68b561c27cf" args="(AirFrame *airframe)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#a1f8cd41c9dc2c34f51e1c68b561c27cf">AbstractRadio::handleLowerMsgEnd</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_air_frame.html">AirFrame</a> *&#160;</td>
          <td class="paramname"><em>airframe</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unbuffer the frame and update noise levels and snr information. </p>
<p>This function is called right after the transmission is over, i.e. right after unbuffering. The noise level of the channel and the snr information of the buffered messages have to be updated.</p>
<p>Additionally the <a class="el" href="class_radio_state.html">RadioState</a> has to be updated.</p>
<p>If the corresponding <a class="el" href="class_air_frame.html">AirFrame</a> was not only noise the corresponding SnrList and the <a class="el" href="class_air_frame.html">AirFrame</a> are sent to the decider. </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00467">467</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00321">handleSelfMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// check if message has to be send to the decider</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a50829d26259d1bb7cbbff74179e8a800" title="pointer to the message this information belongs to">ptr</a> == airframe)
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;reception of frame over, preparing to send packet to upper layer\n&quot;</span>;
        <span class="comment">// get Packet and list out of the receive buffer:</span>
        <a class="code" href="_snr_list_8h.html#a241b5e7c9575e932988a55f7a5012a61" title="List to store SNR information for a message.">SnrList</a> list;
        list = <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a69a0eeb12fe8bf0c96afb82c2a720077" title="stores SNR over time">sList</a>;

        <span class="comment">// delete the pointer to indicate that no message is currently</span>
        <span class="comment">// being received and clear the list</span>
        <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a50829d26259d1bb7cbbff74179e8a800" title="pointer to the message this information belongs to">ptr</a> = NULL;
        <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a69a0eeb12fe8bf0c96afb82c2a720077" title="stores SNR over time">sList</a>.clear();

        <span class="comment">// delete the frame from the recvBuff</span>
        <a class="code" href="class_abstract_radio.html#a4555680a6bf06aebbbed01a67c03b638">recvBuff</a>.erase(airframe);

        <span class="comment">//XXX send up the frame:</span>
        <span class="comment">//if (radioModel-&gt;isReceivedCorrectly(airframe, list))</span>
        <span class="comment">//    sendUp(airframe);</span>
        <span class="comment">//else</span>
        <span class="comment">//    delete airframe;</span>
        <span class="keywordflow">if</span> (!<a class="code" href="class_abstract_radio.html#a7e6436fc8bb1931f46c47ae7a7446d01">radioModel</a>-&gt;<a class="code" href="class_i_radio_model.html#a107eaa67a662f3dce05eb691dae90f84">isReceivedCorrectly</a>(airframe, list))
        {
            airframe-&gt;getEncapsulatedPacket()-&gt;setKind(list.size()&gt;1 ? <a class="code" href="_consts80211_8h.html#ad70ed57eb996b190fc586f309107250ead5384d1822c72da119100438c5051831">COLLISION</a> : <a class="code" href="_consts80211_8h.html#ad70ed57eb996b190fc586f309107250ea46f67b4287ec5f32a482fe2245acb694">BITERROR</a>);
            airframe-&gt;setName(list.size()&gt;1 ? <span class="stringliteral">&quot;COLLISION&quot;</span> : <span class="stringliteral">&quot;BITERROR&quot;</span>);
        }
        <a class="code" href="class_abstract_radio.html#a31ac7ea59c04d9614d6f61e72ab2e3b4">sendUp</a>(airframe);
    }
    <span class="comment">// all other messages are noise</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;reception of noise message over, removing recvdPower from noiseLevel....\n&quot;</span>;
        <span class="comment">// get the rcvdPower and subtract it from the noiseLevel</span>
        <a class="code" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a> -= <a class="code" href="class_abstract_radio.html#a4555680a6bf06aebbbed01a67c03b638">recvBuff</a>[airframe];

        <span class="comment">// delete message from the recvBuff</span>
        <a class="code" href="class_abstract_radio.html#a4555680a6bf06aebbbed01a67c03b638">recvBuff</a>.erase(airframe);

        <span class="comment">// update snr info for message currently being received if any</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a50829d26259d1bb7cbbff74179e8a800" title="pointer to the message this information belongs to">ptr</a> != NULL)
        {
            <a class="code" href="class_abstract_radio.html#a98b9b9d5f0124b4c292b372aae123913">addNewSnr</a>();
        }

        <span class="comment">// message should be deleted</span>
        <span class="keyword">delete</span> airframe;
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;message deleted\n&quot;</span>;
    }

    <span class="comment">// check the RadioState and update if necessary</span>
    <span class="comment">// change to idle if noiseLevel smaller than threshold and state was</span>
    <span class="comment">// not idle before</span>
    <span class="comment">// do not change state if currently sending or receiving a message!!!</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a> &lt; <a class="code" href="class_abstract_radio.html#aff52d795ae9cc6d12075ad120848da44">sensitivity</a> &amp;&amp; <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a> &amp;&amp; <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a50829d26259d1bb7cbbff74179e8a800" title="pointer to the message this information belongs to">ptr</a> == NULL)
    {
        <span class="comment">// publish the new RadioState:</span>
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;new RadioState is IDLE\n&quot;</span>;
        <a class="code" href="class_abstract_radio.html#a0d0a613aba5a78acd1b4eb8fdb31f112">setRadioState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab99c16474f3d123d1597f5b67c985e7e"></a><!-- doxytag: member="AbstractRadio::handleLowerMsgStart" ref="ab99c16474f3d123d1597f5b67c985e7e" args="(AirFrame *airframe)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#ab99c16474f3d123d1597f5b67c985e7e">AbstractRadio::handleLowerMsgStart</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_air_frame.html">AirFrame</a> *&#160;</td>
          <td class="paramname"><em>airframe</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Buffer the frame and update noise levels and snr information. </p>
<p>This function is called right after a packet arrived, i.e. right before it is buffered for 'transmission time'.</p>
<p>First the receive power of the packet has to be calculated and is stored in the recvBuff. Afterwards it has to be decided whether the packet is just noise or a "real" packet that needs to be received.</p>
<p>The message is not treated as noise if all of the following conditions apply:</p>
<ol type="1">
<li>the power of the received signal is higher than the sensitivity.</li>
<li>the host is currently not sending a message</li>
<li>no other packet is already being received</li>
</ol>
<p>If all conditions apply a new SnrList is created and the <a class="el" href="class_radio_state.html">RadioState</a> is changed to RECV.</p>
<p>If the packet is just noise the receive power is added to the noise Level of the channel. Additionally the snr information of the currently being received message (if any) has to be updated as well as the <a class="el" href="class_radio_state.html">RadioState</a>. </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00391">391</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00538">changeChannel()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00131">handleMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Calculate the receive power of the message</span>

    <span class="comment">// calculate distance</span>
    <span class="keyword">const</span> <a class="code" href="class_coord.html" title="Class for storing host positions.">Coord</a>&amp; myPos = <a class="code" href="class_channel_access.html#a9e51969a624ff64101cf808514d50d4f" title="Returns the host&#39;s position.">getMyPosition</a>();
    <span class="keyword">const</span> <a class="code" href="class_coord.html" title="Class for storing host positions.">Coord</a>&amp; framePos = airframe-&gt;<a class="code" href="class_air_frame.html#a6330e718269d5471a1beaeba7b505a60">getSenderPos</a>();
    <span class="keywordtype">double</span> distance = myPos.<a class="code" href="class_coord.html#ab6a7bfcc5c55e5d8edbc7c0cb5a11626">distance</a>(framePos);

    <span class="comment">// calculate receive power</span>
    <span class="keywordtype">double</span> rcvdPower = <a class="code" href="class_abstract_radio.html#a2d472dafa39234e2d2ceb3c77ca20c4f">receptionModel</a>-&gt;<a class="code" href="class_i_reception_model.html#a4c62c5996f5afac48e0f0a88bdeed308">calculateReceivedPower</a>(airframe-&gt;<a class="code" href="class_air_frame.html#a8b0e2eb1d14e0a5d9cab5c5a6f66c044">getPSend</a>(), <a class="code" href="class_abstract_radio.html#afd694d58688e028489f993597a9f44af">carrierFrequency</a>, distance);

    <span class="comment">// store the receive power in the recvBuff</span>
    <a class="code" href="class_abstract_radio.html#a4555680a6bf06aebbbed01a67c03b638">recvBuff</a>[airframe] = rcvdPower;

    <span class="comment">// if receive power is bigger than sensitivity and if not sending</span>
    <span class="comment">// and currently not receiving another message and the message has</span>
    <span class="comment">// arrived in time</span>
    <span class="comment">// NOTE: a message may have arrival time in the past here when we are</span>
    <span class="comment">// processing ongoing transmissions during a channel change</span>
    <span class="keywordflow">if</span> (airframe-&gt;getArrivalTime() == simTime() &amp;&amp; rcvdPower &gt;= <a class="code" href="class_abstract_radio.html#aff52d795ae9cc6d12075ad120848da44">sensitivity</a> &amp;&amp; <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() != <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a> &amp;&amp; <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a50829d26259d1bb7cbbff74179e8a800" title="pointer to the message this information belongs to">ptr</a> == NULL)
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;receiving frame &quot;</span> &lt;&lt; airframe-&gt;getName() &lt;&lt; endl;

        <span class="comment">// Put frame and related SnrList in receive buffer</span>
        <a class="code" href="_snr_list_8h.html#a241b5e7c9575e932988a55f7a5012a61" title="List to store SNR information for a message.">SnrList</a> snrList;
        <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a50829d26259d1bb7cbbff74179e8a800" title="pointer to the message this information belongs to">ptr</a> = airframe;
        <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a4d916ac27467f3f7dd5ebec0689b4887" title="received power of the message">rcvdPower</a> = rcvdPower;
        <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a69a0eeb12fe8bf0c96afb82c2a720077" title="stores SNR over time">sList</a> = snrList;

        <span class="comment">// add initial snr value</span>
        <a class="code" href="class_abstract_radio.html#a98b9b9d5f0124b4c292b372aae123913">addNewSnr</a>();

        <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() != <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>)
        {
            <span class="comment">// publish new RadioState</span>
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;publish new RadioState:RECV\n&quot;</span>;
            <a class="code" href="class_abstract_radio.html#a0d0a613aba5a78acd1b4eb8fdb31f112">setRadioState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>);
        }
    }
    <span class="comment">// receive power is too low or another message is being sent or received</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;frame &quot;</span> &lt;&lt; airframe-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; is just noise\n&quot;</span>;
        <span class="comment">//add receive power to the noise level</span>
        <a class="code" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a> += rcvdPower;

        <span class="comment">// if a message is being received add a new snr value</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a50829d26259d1bb7cbbff74179e8a800" title="pointer to the message this information belongs to">ptr</a> != NULL)
        {
            <span class="comment">// update snr info for currently being received message</span>
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;adding new snr value to snr list of message being received\n&quot;</span>;
            <a class="code" href="class_abstract_radio.html#a98b9b9d5f0124b4c292b372aae123913">addNewSnr</a>();
        }

        <span class="comment">// update the RadioState if the noiseLevel exceeded the threshold</span>
        <span class="comment">// and the radio is currently not in receive or in send mode</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a> &gt;= <a class="code" href="class_abstract_radio.html#aff52d795ae9cc6d12075ad120848da44">sensitivity</a> &amp;&amp; <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>)
        {
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;setting radio state to RECV\n&quot;</span>;
            <a class="code" href="class_abstract_radio.html#a0d0a613aba5a78acd1b4eb8fdb31f112">setRadioState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa7800db11fac1c18457a7d5c57d81c3d"></a><!-- doxytag: member="AbstractRadio::handleMessage" ref="aa7800db11fac1c18457a7d5c57d81c3d" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#aa7800db11fac1c18457a7d5c57d81c3d">AbstractRadio::handleMessage</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The basic handle message function.</p>
<p>Depending on the gate a message arrives handleMessage just calls different handle*Msg functions to further process the message.</p>
<p>Messages from the channel are also buffered here in order to simulate a transmission delay</p>
<p>You should not make any changes in this function but implement all your functionality into the handle*Msg functions called from here.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="class_abstract_radio.html#aee4b43805a3b94cbb1b65b698a80f3bf">handleUpperMsg</a>, <a class="el" href="class_abstract_radio.html#ab99c16474f3d123d1597f5b67c985e7e" title="Buffer the frame and update noise levels and snr information.">handleLowerMsgStart</a>, <a class="el" href="class_abstract_radio.html#a1f8cd41c9dc2c34f51e1c68b561c27cf" title="Unbuffer the frame and update noise levels and snr information.">handleLowerMsgEnd</a>, <a class="el" href="class_abstract_radio.html#a3035e4a5d365d6a5a9267329199fa3a6">handleSelfMsg</a> </dd></dl>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00131">131</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// handle commands</span>
    <span class="keywordflow">if</span> (msg-&gt;getArrivalGateId()==<a class="code" href="class_abstract_radio.html#ae9254113d76c6aeecfaf2483105ae824">uppergateIn</a> &amp;&amp; !msg-&gt;isPacket() <span class="comment">/*FIXME XXX ENSURE REALLY PLAIN cMessage ARE SENT AS COMMANDS!!! &amp;&amp; msg-&gt;getBitLength()==0*/</span>)
    {
        cPolymorphic *ctrl = msg-&gt;removeControlInfo();
        <span class="keywordflow">if</span> (msg-&gt;getKind()==0)
            error(<span class="stringliteral">&quot;Message &#39;%s&#39; with length==0 is supposed to be a command, but msg kind is also zero&quot;</span>, msg-&gt;getName());
        <a class="code" href="class_abstract_radio.html#a364d17ee4e46c541896622141607c0c0">handleCommand</a>(msg-&gt;getKind(), ctrl);
        <span class="keyword">delete</span> msg;
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (msg-&gt;getArrivalGateId() == <a class="code" href="class_abstract_radio.html#ae9254113d76c6aeecfaf2483105ae824">uppergateIn</a>)
    {
        <a class="code" href="class_air_frame.html">AirFrame</a> *airframe = <a class="code" href="class_abstract_radio.html#aca7489dae305d0afeaa9d2beda764dc2">encapsulatePacket</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg));
        <a class="code" href="class_abstract_radio.html#aee4b43805a3b94cbb1b65b698a80f3bf">handleUpperMsg</a>(airframe);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;isSelfMessage())
    {
        <a class="code" href="class_abstract_radio.html#a3035e4a5d365d6a5a9267329199fa3a6">handleSelfMsg</a>(msg);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (check_and_cast&lt;AirFrame *&gt;(msg)-&gt;<a class="code" href="class_abstract_radio.html#a5d08dc0ef0b75513e2a2c1a7ea8397fb">getChannelNumber</a>() == <a class="code" href="class_abstract_radio.html#a5d08dc0ef0b75513e2a2c1a7ea8397fb">getChannelNumber</a>())
    {
        <span class="comment">// must be an AirFrame</span>
        <a class="code" href="class_air_frame.html">AirFrame</a> *airframe = (<a class="code" href="class_air_frame.html">AirFrame</a> *) msg;
        <a class="code" href="class_abstract_radio.html#ab99c16474f3d123d1597f5b67c985e7e" title="Buffer the frame and update noise levels and snr information.">handleLowerMsgStart</a>(airframe);
        <a class="code" href="class_abstract_radio.html#a9a0a19c2ffd8a9f1a516c368a6e4b7b0" title="Buffers message for &#39;transmission time&#39;.">bufferMsg</a>(airframe);
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;listening to different channel when receiving message -- dropping it\n&quot;</span>;
        <span class="keyword">delete</span> msg;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3035e4a5d365d6a5a9267329199fa3a6"></a><!-- doxytag: member="AbstractRadio::handleSelfMsg" ref="a3035e4a5d365d6a5a9267329199fa3a6" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#a3035e4a5d365d6a5a9267329199fa3a6">AbstractRadio::handleSelfMsg</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00321">321</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00131">handleMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msg-&gt;getKind()==<a class="code" href="_abstract_radio_8cc.html#aebda9a0d17a20bb583e3a05765538194">MK_RECEPTION_COMPLETE</a>)
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;frame is completely received now\n&quot;</span>;

        <span class="comment">// unbuffer the message</span>
        <a class="code" href="class_air_frame.html">AirFrame</a> *airframe = <a class="code" href="class_abstract_radio.html#a64e2958a548e3cf480f1afe215e1dea9" title="Unbuffers a message after &#39;transmission time&#39;.">unbufferMsg</a>(msg);

        <a class="code" href="class_abstract_radio.html#a1f8cd41c9dc2c34f51e1c68b561c27cf" title="Unbuffer the frame and update noise levels and snr information.">handleLowerMsgEnd</a>(airframe);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;getKind() == <a class="code" href="_abstract_radio_8cc.html#a2a9cfeaaf7c63479165e7050a39b24ee">MK_TRANSMISSION_OVER</a>)
    {
        <span class="comment">// Transmission has completed. The RadioState has to be changed</span>
        <span class="comment">// to IDLE or RECV, based on the noise level on the channel.</span>
        <span class="comment">// If the noise level is bigger than the sensitivity switch to receive mode,</span>
        <span class="comment">// otherwise to idle mode.</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a> &lt; <a class="code" href="class_abstract_radio.html#aff52d795ae9cc6d12075ad120848da44">sensitivity</a>)
        {
            <span class="comment">// set the RadioState to IDLE</span>
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;transmission over, switch to idle mode (state:IDLE)\n&quot;</span>;
            <a class="code" href="class_abstract_radio.html#a0d0a613aba5a78acd1b4eb8fdb31f112">setRadioState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>);
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// set the RadioState to RECV</span>
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;transmission over but noise level too high, switch to recv mode (state:RECV)\n&quot;</span>;
            <a class="code" href="class_abstract_radio.html#a0d0a613aba5a78acd1b4eb8fdb31f112">setRadioState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>);
        }

        <span class="comment">// delete the timer</span>
        <span class="keyword">delete</span> msg;

        <span class="comment">// switch channel if it needs be</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a198f3ac6a1ab6a0f7252bebb4048ca47">newChannel</a>!=-1)
        {
            <a class="code" href="class_abstract_radio.html#adf9361bf91285886c54fbc917c8e3e89">changeChannel</a>(<a class="code" href="class_abstract_radio.html#a198f3ac6a1ab6a0f7252bebb4048ca47">newChannel</a>);
            <a class="code" href="class_abstract_radio.html#a198f3ac6a1ab6a0f7252bebb4048ca47">newChannel</a> = -1;
        }
    }
    <span class="keywordflow">else</span>
    {
        error(<span class="stringliteral">&quot;Internal error: unknown self-message `%s&#39;&quot;</span>, msg-&gt;getName());
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aee4b43805a3b94cbb1b65b698a80f3bf"></a><!-- doxytag: member="AbstractRadio::handleUpperMsg" ref="aee4b43805a3b94cbb1b65b698a80f3bf" args="(AirFrame *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#aee4b43805a3b94cbb1b65b698a80f3bf">AbstractRadio::handleUpperMsg</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_air_frame.html">AirFrame</a> *&#160;</td>
          <td class="paramname"><em>airframe</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If a message is already being transmitted, an error is raised.</p>
<p>Otherwise the <a class="el" href="class_radio_state.html">RadioState</a> is set to TRANSMIT and a timer is started. When this timer expires the <a class="el" href="class_radio_state.html">RadioState</a> will be set back to RECV (or IDLE respectively) again.</p>
<p>If the host is receiving a packet this packet is from now on only considered as noise. </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00243">243</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00131">handleMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>)
        error(<span class="stringliteral">&quot;Trying to send a message while already transmitting -- MAC should &quot;</span>
              <span class="stringliteral">&quot;take care this does not happen&quot;</span>);

    <span class="comment">// if a packet was being received, it is corrupted now as should be treated as noise</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a50829d26259d1bb7cbbff74179e8a800" title="pointer to the message this information belongs to">ptr</a> != NULL)
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Sending a message while receiving another. The received one is now corrupted.\n&quot;</span>;

        <span class="comment">// remove the snr information stored for the message currently being</span>
        <span class="comment">// received. This message is treated as noise now and the</span>
        <span class="comment">// receive power has to be added to the noiseLevel</span>

        <span class="comment">// delete the pointer to indicate that no message is being received</span>
        <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a50829d26259d1bb7cbbff74179e8a800" title="pointer to the message this information belongs to">ptr</a> = NULL;
        <span class="comment">// clear the snr list</span>
        <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a69a0eeb12fe8bf0c96afb82c2a720077" title="stores SNR over time">sList</a>.clear();
        <span class="comment">// add the receive power to the noise level</span>
        <a class="code" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a> += <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a4d916ac27467f3f7dd5ebec0689b4887" title="received power of the message">rcvdPower</a>;
    }

    <span class="comment">// now we are done with all the exception handling and can take care</span>
    <span class="comment">// about the &quot;real&quot; stuff</span>

    <span class="comment">// change radio status</span>
    <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;sending, changing RadioState to TRANSMIT\n&quot;</span>;
    <a class="code" href="class_abstract_radio.html#a0d0a613aba5a78acd1b4eb8fdb31f112">setRadioState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>);

    cMessage *timer = <span class="keyword">new</span> cMessage(NULL, <a class="code" href="_abstract_radio_8cc.html#a2a9cfeaaf7c63479165e7050a39b24ee">MK_TRANSMISSION_OVER</a>);
    scheduleAt(simTime() + airframe-&gt;<a class="code" href="class_air_frame.html#a564aa81be93f77dfd92846f53d6c9f40">getDuration</a>(), timer);
    <a class="code" href="class_abstract_radio.html#a871595ad4b30a0dc843899edce0c6897">sendDown</a>(airframe);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad646c42cb1ee4b8fa5d0bf555a6ef0fe"></a><!-- doxytag: member="AbstractRadio::initialize" ref="ad646c42cb1ee4b8fa5d0bf555a6ef0fe" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#ad646c42cb1ee4b8fa5d0bf555a6ef0fe">AbstractRadio::initialize</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register with <a class="el" href="class_channel_control.html" title="Monitors which hosts are &quot;in range&quot;. Supports multiple channels.">ChannelControl</a> and subscribe to hostPos. </p>
<p>Upon initialization <a class="el" href="class_channel_access.html" title="Basic class for all physical layers, please don&#39;t touch!!">ChannelAccess</a> registers the nic parent module to have all its connections handled by <a class="el" href="class_channel_control.html" title="Monitors which hosts are &quot;in range&quot;. Supports multiple channels.">ChannelControl</a> </p>

<p>Reimplemented from <a class="el" href="class_channel_access.html#af4c4d6652f6e3d4846cb3d2e826f4bed">ChannelAccess</a>.</p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00036">36</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_abstract_radio.html#ad646c42cb1ee4b8fa5d0bf555a6ef0fe" title="Register with ChannelControl and subscribe to hostPos.">ChannelAccess::initialize</a>(stage);

    <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Initializing AbstractRadio, stage=&quot;</span> &lt;&lt; stage &lt;&lt; endl;

    <span class="keywordflow">if</span> (stage == 0)
    {
        gate(<span class="stringliteral">&quot;radioIn&quot;</span>)-&gt;setDeliverOnReceptionStart(<span class="keyword">true</span>);

        <a class="code" href="class_abstract_radio.html#ae9254113d76c6aeecfaf2483105ae824">uppergateIn</a> = findGate(<span class="stringliteral">&quot;uppergateIn&quot;</span>);
        <a class="code" href="class_abstract_radio.html#ab4183b07dda8b3909b5e098990f1f420">uppergateOut</a> = findGate(<span class="stringliteral">&quot;uppergateOut&quot;</span>);

        <span class="comment">// read parameters</span>
        <a class="code" href="class_abstract_radio.html#a3b2cd111e9febcbced779a755c4a960a">transmitterPower</a> = par(<span class="stringliteral">&quot;transmitterPower&quot;</span>);
        <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a3b2cd111e9febcbced779a755c4a960a">transmitterPower</a> &gt; (<span class="keywordtype">double</span>) (<a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;par(<span class="stringliteral">&quot;pMax&quot;</span>)))
            error(<span class="stringliteral">&quot;transmitterPower cannot be bigger than pMax in ChannelControl!&quot;</span>);
        <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#a789f5ce6d79f31a60e9473cbc07a5d49">setBitrate</a>(par(<span class="stringliteral">&quot;bitrate&quot;</span>));
        <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab4ce41a963cc11f5bbd10a5d9b894a71">setChannelNumber</a>(par(<span class="stringliteral">&quot;channelNumber&quot;</span>));
        <a class="code" href="class_abstract_radio.html#aeff3be287270fa5332e3bb4db3955cee">thermalNoise</a> = <a class="code" href="class_f_w_math.html#af308407856d9835b103f2421e373ee28">FWMath::dBm2mW</a>(par(<span class="stringliteral">&quot;thermalNoise&quot;</span>));
        <a class="code" href="class_abstract_radio.html#afd694d58688e028489f993597a9f44af">carrierFrequency</a> = <a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;par(<span class="stringliteral">&quot;carrierFrequency&quot;</span>);  <span class="comment">// taken from ChannelControl</span>
        <a class="code" href="class_abstract_radio.html#aff52d795ae9cc6d12075ad120848da44">sensitivity</a> = <a class="code" href="class_f_w_math.html#af308407856d9835b103f2421e373ee28">FWMath::dBm2mW</a>(par(<span class="stringliteral">&quot;sensitivity&quot;</span>));

        <span class="comment">// initialize noiseLevel</span>
        <a class="code" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a> = <a class="code" href="class_abstract_radio.html#aeff3be287270fa5332e3bb4db3955cee">thermalNoise</a>;

        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Initialized channel with noise: &quot;</span> &lt;&lt; <a class="code" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a> &lt;&lt; <span class="stringliteral">&quot; sensitivity: &quot;</span> &lt;&lt; <a class="code" href="class_abstract_radio.html#aff52d795ae9cc6d12075ad120848da44">sensitivity</a> &lt;&lt;
            endl;

        <span class="comment">// initialize the pointer of the snrInfo with NULL to indicate</span>
        <span class="comment">// that currently no message is received</span>
        <a class="code" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">snrInfo</a>.<a class="code" href="struct_abstract_radio_1_1_snr_struct.html#a50829d26259d1bb7cbbff74179e8a800" title="pointer to the message this information belongs to">ptr</a> = NULL;

        <span class="comment">// no channel switch pending</span>
        <a class="code" href="class_abstract_radio.html#a198f3ac6a1ab6a0f7252bebb4048ca47">newChannel</a> = -1;

        <span class="comment">// Initialize radio state. If thermal noise is already to high, radio</span>
        <span class="comment">// state has to be initialized as RECV</span>
        <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>);
        <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a> &gt;= <a class="code" href="class_abstract_radio.html#aff52d795ae9cc6d12075ad120848da44">sensitivity</a>)
            <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>);

        WATCH(<a class="code" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">noiseLevel</a>);
        WATCH(<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>);

        <a class="code" href="class_abstract_radio.html#a2d472dafa39234e2d2ceb3c77ca20c4f">receptionModel</a> = <a class="code" href="class_abstract_radio.html#a6cf413915eeb3105a89acaf1d6e4e894">createReceptionModel</a>();
        <a class="code" href="class_abstract_radio.html#a2d472dafa39234e2d2ceb3c77ca20c4f">receptionModel</a>-&gt;<a class="code" href="class_i_reception_model.html#a054edd0e5822f95dff9501b96802d2ab">initializeFrom</a>(<span class="keyword">this</span>);

        <a class="code" href="class_abstract_radio.html#a7e6436fc8bb1931f46c47ae7a7446d01">radioModel</a> = <a class="code" href="class_abstract_radio.html#a59a22e03b4bd27c61e3f966e4185cd02">createRadioModel</a>();
        <a class="code" href="class_abstract_radio.html#a7e6436fc8bb1931f46c47ae7a7446d01">radioModel</a>-&gt;<a class="code" href="class_i_radio_model.html#a77a41286d82a93c67d1b834e4236f0d3">initializeFrom</a>(<span class="keyword">this</span>);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stage == 1)
    {
        <span class="comment">// tell initial values to MAC; must be done in stage 1, because they</span>
        <span class="comment">// subscribe in stage 0</span>
        <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>);
        <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf3cbaad9c60e34c5cd7ca3da116fa468">NF_RADIO_CHANNEL_CHANGED</a>, &amp;<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stage == 2)
    {
        <span class="comment">// tell initial channel number to ChannelControl; should be done in</span>
        <span class="comment">// stage==2 or later, because base class initializes myHostRef in that stage</span>
        <a class="code" href="class_channel_access.html#a0f42b731ff69be4b1193929356e75aff" title="Pointer to the ChannelControl module.">cc</a>-&gt;<a class="code" href="class_channel_control.html#a04bbb08c92d001b804c06ba42d8e43ea" title="Called when host switches channel.">updateHostChannel</a>(<a class="code" href="class_channel_access.html#aff3d33ee8db5a945fff05fe4305ccf2e" title="Identifies this host in the ChannelControl module.">myHostRef</a>, <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#a0799344b13882d66af3376919bdf9c7d">getChannelNumber</a>());
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a871595ad4b30a0dc843899edce0c6897"></a><!-- doxytag: member="AbstractRadio::sendDown" ref="a871595ad4b30a0dc843899edce0c6897" args="(AirFrame *airframe)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#a871595ad4b30a0dc843899edce0c6897">AbstractRadio::sendDown</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_air_frame.html">AirFrame</a> *&#160;</td>
          <td class="paramname"><em>airframe</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sends a message to the channel </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00215">215</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00243">handleUpperMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_channel_access.html#a562995b3d9c5b279ed8a55c5221dd7b7" title="Sends a message to all hosts in range.">sendToChannel</a>(airframe);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a31ac7ea59c04d9614d6f61e72ab2e3b4"></a><!-- doxytag: member="AbstractRadio::sendUp" ref="a31ac7ea59c04d9614d6f61e72ab2e3b4" args="(AirFrame *airframe)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#a31ac7ea59c04d9614d6f61e72ab2e3b4">AbstractRadio::sendUp</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_air_frame.html">AirFrame</a> *&#160;</td>
          <td class="paramname"><em>airframe</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sends a message to the upper layer </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00207">207</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00467">handleLowerMsgEnd()</a>.</p>
<div class="fragment"><pre class="fragment">{
    cPacket *frame = airframe-&gt;decapsulate();
    <span class="keyword">delete</span> airframe;
    <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;sending up frame &quot;</span> &lt;&lt; frame-&gt;getName() &lt;&lt; endl;
    send(frame, <a class="code" href="class_abstract_radio.html#ab4183b07dda8b3909b5e098990f1f420">uppergateOut</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2d2c984f3ad5621135b287615b2e4147"></a><!-- doxytag: member="AbstractRadio::setBitrate" ref="a2d2c984f3ad5621135b287615b2e4147" args="(double bitrate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#a2d2c984f3ad5621135b287615b2e4147">AbstractRadio::setBitrate</a> </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>bitrate</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Change the bitrate to the given value. This method throws an error if the radio state is transmit. </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00620">620</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00278">handleCommand()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#a2f127045c28c2a709aa1212ba098b9b4">getBitrate</a>() == bitrate)
        <span class="keywordflow">return</span>;
    <span class="keywordflow">if</span> (bitrate &lt; 0)
        error(<span class="stringliteral">&quot;setBitrate(): bitrate cannot be negative (%g)&quot;</span>, bitrate);
    <span class="keywordflow">if</span> (<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a>)
        error(<span class="stringliteral">&quot;changing the bitrate while transmitting is not allowed&quot;</span>);

    <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Setting bitrate to &quot;</span> &lt;&lt; (bitrate/1e6) &lt;&lt; <span class="stringliteral">&quot;Mbps\n&quot;</span>;
    <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#a789f5ce6d79f31a60e9473cbc07a5d49">setBitrate</a>(bitrate);

    <span class="comment">//XXX fire some notification?</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0d0a613aba5a78acd1b4eb8fdb31f112"></a><!-- doxytag: member="AbstractRadio::setRadioState" ref="a0d0a613aba5a78acd1b4eb8fdb31f112" args="(RadioState::State newState)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_abstract_radio.html#a0d0a613aba5a78acd1b4eb8fdb31f112">AbstractRadio::setRadioState</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449">RadioState::State</a>&#160;</td>
          <td class="paramname"><em>newState</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets the radio state, and also fires change notification </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00635">635</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00467">handleLowerMsgEnd()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00391">handleLowerMsgStart()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00321">handleSelfMsg()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00243">handleUpperMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(newState);
    <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">rs</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a64e2958a548e3cf480f1afe215e1dea9"></a><!-- doxytag: member="AbstractRadio::unbufferMsg" ref="a64e2958a548e3cf480f1afe215e1dea9" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_air_frame.html">AirFrame</a> * <a class="el" href="class_abstract_radio.html#a64e2958a548e3cf480f1afe215e1dea9">AbstractRadio::unbufferMsg</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unbuffers a message after 'transmission time'. </p>
<p>Get the context pointer to the now completely received <a class="el" href="class_air_frame.html">AirFrame</a> and delete the self message </p>

<p>Definition at line <a class="el" href="_abstract_radio_8cc_source.html#l00224">224</a> of file <a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00321">handleSelfMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_air_frame.html">AirFrame</a> *airframe = (<a class="code" href="class_air_frame.html">AirFrame</a> *) msg-&gt;getContextPointer();
    <span class="comment">//delete the self message</span>
    <span class="keyword">delete</span> msg;

    <span class="keywordflow">return</span> airframe;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="afd694d58688e028489f993597a9f44af"></a><!-- doxytag: member="AbstractRadio::carrierFrequency" ref="afd694d58688e028489f993597a9f44af" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_abstract_radio.html#afd694d58688e028489f993597a9f44af">AbstractRadio::carrierFrequency</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Configuration: The carrier frequency used. It is read from the <a class="el" href="class_channel_control.html" title="Monitors which hosts are &quot;in range&quot;. Supports multiple channels.">ChannelControl</a> module. </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00194">194</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00391">handleLowerMsgStart()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a7e23b50ae626be43197b6950a772537d"></a><!-- doxytag: member="AbstractRadio::newBitrate" ref="a7e23b50ae626be43197b6950a772537d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_abstract_radio.html#a7e23b50ae626be43197b6950a772537d">AbstractRadio::newBitrate</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>State: if not -1, we have to switch to that bitrate once we finished transmitting </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00186">186</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00278">handleCommand()</a>.</p>

</div>
</div>
<a class="anchor" id="a198f3ac6a1ab6a0f7252bebb4048ca47"></a><!-- doxytag: member="AbstractRadio::newChannel" ref="a198f3ac6a1ab6a0f7252bebb4048ca47" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_abstract_radio.html#a198f3ac6a1ab6a0f7252bebb4048ca47">AbstractRadio::newChannel</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>State: if not -1, we have to switch to that channel once we finished transmitting </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00183">183</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00278">handleCommand()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00321">handleSelfMsg()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="aeea450d539294f8e54917dd5bc279ff6"></a><!-- doxytag: member="AbstractRadio::noiseLevel" ref="aeea450d539294f8e54917dd5bc279ff6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_abstract_radio.html#aeea450d539294f8e54917dd5bc279ff6">AbstractRadio::noiseLevel</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>State: the current noise level of the channel. </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00189">189</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00530">addNewSnr()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00467">handleLowerMsgEnd()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00391">handleLowerMsgStart()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00321">handleSelfMsg()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00243">handleUpperMsg()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a7e6436fc8bb1931f46c47ae7a7446d01"></a><!-- doxytag: member="AbstractRadio::radioModel" ref="a7e6436fc8bb1931f46c47ae7a7446d01" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_i_radio_model.html">IRadioModel</a>* <a class="el" href="class_abstract_radio.html#a7e6436fc8bb1931f46c47ae7a7446d01">AbstractRadio::radioModel</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00137">137</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00030">AbstractRadio()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00186">encapsulatePacket()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00467">handleLowerMsgEnd()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00106">~AbstractRadio()</a>.</p>

</div>
</div>
<a class="anchor" id="a2d472dafa39234e2d2ceb3c77ca20c4f"></a><!-- doxytag: member="AbstractRadio::receptionModel" ref="a2d472dafa39234e2d2ceb3c77ca20c4f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_i_reception_model.html">IReceptionModel</a>* <a class="el" href="class_abstract_radio.html#a2d472dafa39234e2d2ceb3c77ca20c4f">AbstractRadio::receptionModel</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00138">138</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00030">AbstractRadio()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00391">handleLowerMsgStart()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00106">~AbstractRadio()</a>.</p>

</div>
</div>
<a class="anchor" id="a4555680a6bf06aebbbed01a67c03b638"></a><!-- doxytag: member="AbstractRadio::recvBuff" ref="a4555680a6bf06aebbbed01a67c03b638" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_abstract_radio.html#ab742103aa6adec5989a47fca51059026">RecvBuff</a> <a class="el" href="class_abstract_radio.html#a4555680a6bf06aebbbed01a67c03b638">AbstractRadio::recvBuff</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>State: A buffer to store a pointer to a message and the related receive power. </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00177">177</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00538">changeChannel()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00467">handleLowerMsgEnd()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00391">handleLowerMsgStart()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00106">~AbstractRadio()</a>.</p>

</div>
</div>
<a class="anchor" id="a12a4fe65c7da402fde1d86d87e685d58"></a><!-- doxytag: member="AbstractRadio::rs" ref="a12a4fe65c7da402fde1d86d87e685d58" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_radio_state.html">RadioState</a> <a class="el" href="class_abstract_radio.html#a12a4fe65c7da402fde1d86d87e685d58">AbstractRadio::rs</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>State: the current <a class="el" href="class_radio_state.html">RadioState</a> of the NIC; includes channel number </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00180">180</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00538">changeChannel()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00186">encapsulatePacket()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00278">handleCommand()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00467">handleLowerMsgEnd()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00391">handleLowerMsgStart()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00243">handleUpperMsg()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00620">setBitrate()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00635">setRadioState()</a>.</p>

</div>
</div>
<a class="anchor" id="aff52d795ae9cc6d12075ad120848da44"></a><!-- doxytag: member="AbstractRadio::sensitivity" ref="aff52d795ae9cc6d12075ad120848da44" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_abstract_radio.html#aff52d795ae9cc6d12075ad120848da44">AbstractRadio::sensitivity</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default: -85 dBm </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00208">208</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00467">handleLowerMsgEnd()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00391">handleLowerMsgStart()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00321">handleSelfMsg()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="ac43bfe80e1284106a494732f79de8cb8"></a><!-- doxytag: member="AbstractRadio::snrInfo" ref="ac43bfe80e1284106a494732f79de8cb8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_abstract_radio_1_1_snr_struct.html">SnrStruct</a> <a class="el" href="class_abstract_radio.html#ac43bfe80e1284106a494732f79de8cb8">AbstractRadio::snrInfo</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>State: SnrInfo stores the snrList and the the recvdPower for the message currently being received, together with a pointer to the message. </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00165">165</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00530">addNewSnr()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00538">changeChannel()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00467">handleLowerMsgEnd()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00391">handleLowerMsgStart()</a>, <a class="el" href="_abstract_radio_8cc_source.html#l00243">handleUpperMsg()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="aeff3be287270fa5332e3bb4db3955cee"></a><!-- doxytag: member="AbstractRadio::thermalNoise" ref="aeff3be287270fa5332e3bb4db3955cee" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_abstract_radio.html#aeff3be287270fa5332e3bb4db3955cee">AbstractRadio::thermalNoise</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Configuration: Thermal noise on the channel. Can be specified in omnetpp.ini. Default: -100 dBm </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00200">200</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a3b2cd111e9febcbced779a755c4a960a"></a><!-- doxytag: member="AbstractRadio::transmitterPower" ref="a3b2cd111e9febcbced779a755c4a960a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_abstract_radio.html#a3b2cd111e9febcbced779a755c4a960a">AbstractRadio::transmitterPower</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Power used to transmit messages </p>

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00141">141</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00186">encapsulatePacket()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="ae9254113d76c6aeecfaf2483105ae824"></a><!-- doxytag: member="AbstractRadio::uppergateIn" ref="ae9254113d76c6aeecfaf2483105ae824" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_abstract_radio.html#ae9254113d76c6aeecfaf2483105ae824">AbstractRadio::uppergateIn</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00146">146</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00131">handleMessage()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="ab4183b07dda8b3909b5e098990f1f420"></a><!-- doxytag: member="AbstractRadio::uppergateOut" ref="ab4183b07dda8b3909b5e098990f1f420" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_abstract_radio.html#ab4183b07dda8b3909b5e098990f1f420">AbstractRadio::uppergateOut</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_abstract_radio_8h_source.html#l00145">145</a> of file <a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a>.</p>

<p>Referenced by <a class="el" href="_abstract_radio_8cc_source.html#l00036">initialize()</a>, and <a class="el" href="_abstract_radio_8cc_source.html#l00207">sendUp()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_abstract_radio_8h_source.html">AbstractRadio.h</a></li>
<li><a class="el" href="_abstract_radio_8cc_source.html">AbstractRadio.cc</a></li>
</ul>
</div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_abstract_radio.html">AbstractRadio</a>      </li>

    <li class="footer">Generated on Wed Aug 29 2012 21:13:02 for INET Framework for OMNeT++/OMNEST by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
