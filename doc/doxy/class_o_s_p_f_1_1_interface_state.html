<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>INET Framework for OMNeT++/OMNEST: OSPF::InterfaceState Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">INET Framework for OMNeT++/OMNEST
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_o_s_p_f_1_1_interface_state.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">OSPF::InterfaceState Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OSPF::InterfaceState" -->
<p><code>#include &lt;<a class="el" href="_o_s_p_f_interface_state_8h_source.html">OSPFInterfaceState.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for OSPF::InterfaceState:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_o_s_p_f_1_1_interface_state.png" usemap="#OSPF::InterfaceState_map" alt=""/>
  <map id="OSPF::InterfaceState_map" name="OSPF::InterfaceState_map">
<area href="class_o_s_p_f_1_1_interface_state_backup.html" alt="OSPF::InterfaceStateBackup" shape="rect" coords="0,56,249,80"/>
<area href="class_o_s_p_f_1_1_interface_state_designated_router.html" alt="OSPF::InterfaceStateDesignatedRouter" shape="rect" coords="259,56,508,80"/>
<area href="class_o_s_p_f_1_1_interface_state_down.html" alt="OSPF::InterfaceStateDown" shape="rect" coords="518,56,767,80"/>
<area href="class_o_s_p_f_1_1_interface_state_loopback.html" alt="OSPF::InterfaceStateLoopback" shape="rect" coords="777,56,1026,80"/>
<area href="class_o_s_p_f_1_1_interface_state_not_designated_router.html" alt="OSPF::InterfaceStateNotDesignatedRouter" shape="rect" coords="1036,56,1285,80"/>
<area href="class_o_s_p_f_1_1_interface_state_point_to_point.html" alt="OSPF::InterfaceStatePointToPoint" shape="rect" coords="1295,56,1544,80"/>
<area href="class_o_s_p_f_1_1_interface_state_waiting.html" alt="OSPF::InterfaceStateWaiting" shape="rect" coords="1554,56,1803,80"/>
</map>
 </div></div>

<p><a href="class_o_s_p_f_1_1_interface_state-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_interface_state.html#a4ea64d4cf5a613899ca35a61760e4d78">~InterfaceState</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_interface_state.html#a2a41c0f4f5decb321c67e0fcceac9bca">ProcessEvent</a> (<a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *intf, <a class="el" href="class_o_s_p_f_1_1_interface.html#ae0aca9ab8ca338c25d9afa6e65fc8824">Interface::InterfaceEventType</a> event)=0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <br class="typebreak"/>
<a class="el" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249">Interface::InterfaceStateType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_interface_state.html#a67e02942e33a243dd57f1130015f41b6">GetState</a> (void) const =0</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_interface_state.html#a10805e77b3f9a99f2e678f8e29f3b7bc">ChangeState</a> (<a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *intf, <a class="el" href="class_o_s_p_f_1_1_interface_state.html">InterfaceState</a> *newState, <a class="el" href="class_o_s_p_f_1_1_interface_state.html">InterfaceState</a> *currentState)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_interface_state.html#a4a784ea0a363117c123cdac528001767">CalculateDesignatedRouter</a> (<a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *intf)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_o_s_p_f_interface_state_8h_source.html#l00025">25</a> of file <a class="el" href="_o_s_p_f_interface_state_8h_source.html">OSPFInterfaceState.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a4ea64d4cf5a613899ca35a61760e4d78"></a><!-- doxytag: member="OSPF::InterfaceState::~InterfaceState" ref="a4ea64d4cf5a613899ca35a61760e4d78" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="class_o_s_p_f_1_1_interface_state.html#a4ea64d4cf5a613899ca35a61760e4d78">OSPF::InterfaceState::~InterfaceState</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_s_p_f_interface_state_8h_source.html#l00031">31</a> of file <a class="el" href="_o_s_p_f_interface_state_8h_source.html">OSPFInterfaceState.h</a>.</p>
<div class="fragment"><pre class="fragment">{}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a4a784ea0a363117c123cdac528001767"></a><!-- doxytag: member="OSPF::InterfaceState::CalculateDesignatedRouter" ref="a4a784ea0a363117c123cdac528001767" args="(Interface *intf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_s_p_f_1_1_interface_state.html#a4a784ea0a363117c123cdac528001767">OSPF::InterfaceState::CalculateDesignatedRouter</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_s_p_f_1_1_interface.html">OSPF::Interface</a> *&#160;</td>
          <td class="paramname"><em>intf</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_s_p_f_interface_state_8cc_source.html#l00114">114</a> of file <a class="el" href="_o_s_p_f_interface_state_8cc_source.html">OSPFInterfaceState.cc</a>.</p>

<p>Referenced by <a class="el" href="_o_s_p_f_interface_state_backup_8cc_source.html#l00025">OSPF::InterfaceStateBackup::ProcessEvent()</a>, <a class="el" href="_o_s_p_f_interface_state_waiting_8cc_source.html#l00025">OSPF::InterfaceStateWaiting::ProcessEvent()</a>, <a class="el" href="_o_s_p_f_interface_state_not_designated_router_8cc_source.html#l00025">OSPF::InterfaceStateNotDesignatedRouter::ProcessEvent()</a>, and <a class="el" href="_o_s_p_f_interface_state_designated_router_8cc_source.html#l00025">OSPF::InterfaceStateDesignatedRouter::ProcessEvent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="namespace_o_s_p_f.html#ad64f22839cca7ec05fee5b7596411197">OSPF::RouterID</a>           routerID                = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#a12b09f4263d005f7b0cd808502c1de48">GetRouterID</a>();
    <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> currentDesignatedRouter = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a2aa7970a1a4f77bbe3718c1669e0f9a9">designatedRouter</a>;
    <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> currentBackupRouter     = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a1c438d26ca9d60a131c2040f20376334">backupDesignatedRouter</a>;

    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>             neighborCount           = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>.size();
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>            repeatCount             = 0;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>             <a class="code" href="namespacecesnet.html#a2d959620f0e772e579c21833995d082e">i</a>;

    <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> declaredBackup;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>            declaredBackupPriority;
    <a class="code" href="namespace_o_s_p_f.html#ad64f22839cca7ec05fee5b7596411197">OSPF::RouterID</a>           declaredBackupID;
    <span class="keywordtype">bool</span>                     backupDeclared;

    <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> declaredDesignatedRouter;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>            declaredDesignatedRouterPriority;
    <a class="code" href="namespace_o_s_p_f.html#ad64f22839cca7ec05fee5b7596411197">OSPF::RouterID</a>           declaredDesignatedRouterID;
    <span class="keywordtype">bool</span>                     designatedRouterDeclared;

    <span class="keywordflow">do</span> {
        <span class="comment">// calculating backup designated router</span>
        declaredBackup = <a class="code" href="namespace_o_s_p_f.html#a1025f956e059380bda5d71fc1e3324f6">OSPF::NullDesignatedRouterID</a>;
        declaredBackupPriority = 0;
        declaredBackupID = <a class="code" href="namespace_o_s_p_f.html#aa0223d58cbf9a99558b9460b23186730">OSPF::NullRouterID</a>;
        backupDeclared = <span class="keyword">false</span>;

        <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> highestRouter                 = <a class="code" href="namespace_o_s_p_f.html#a1025f956e059380bda5d71fc1e3324f6">OSPF::NullDesignatedRouterID</a>;
        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>            highestPriority               = 0;
        <a class="code" href="namespace_o_s_p_f.html#ad64f22839cca7ec05fee5b7596411197">OSPF::RouterID</a>           highestID                     = <a class="code" href="namespace_o_s_p_f.html#aa0223d58cbf9a99558b9460b23186730">OSPF::NullRouterID</a>;

        <span class="keywordflow">for</span> (i = 0; i &lt; neighborCount; i++) {
            <a class="code" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a>* neighbor         = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[<a class="code" href="namespacecesnet.html#a2d959620f0e772e579c21833995d082e">i</a>];
            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   neighborPriority = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a81e7ec86bff4a427f34bd091e3fb6698">GetPriority</a>();

            <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a934bedd2e5f14281416666a48f357bc9">GetState</a>() &lt; <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0aaa2bc2a9a78de6ca762416b243c632e46">OSPF::Neighbor::TwoWayState</a>) {
                <span class="keywordflow">continue</span>;
            }
            <span class="keywordflow">if</span> (neighborPriority == 0) {
                <span class="keywordflow">continue</span>;
            }

            <a class="code" href="namespace_o_s_p_f.html#ad64f22839cca7ec05fee5b7596411197">OSPF::RouterID</a>           neighborID                      = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#ad80d61e8d0737c7e0a12f1837ac99ffb">GetNeighborID</a>();
            <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> neighborsDesignatedRouter       = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a9720f23a8ca94abd5027932d93684ea2">GetDesignatedRouter</a>();
            <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> neighborsBackupDesignatedRouter = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a460e1cfd8816b958fef01acce13ce82b">GetBackupDesignatedRouter</a>();

            <span class="keywordflow">if</span> (neighborsDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> != neighborID) {
                <span class="keywordflow">if</span> (neighborsBackupDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> == neighborID) {
                    <span class="keywordflow">if</span> ((neighborPriority &gt; declaredBackupPriority) ||
                        ((neighborPriority == declaredBackupPriority) &amp;&amp;
                         (neighborID &gt; declaredBackupID)))
                    {
                        declaredBackup = neighborsBackupDesignatedRouter;
                        declaredBackupPriority = neighborPriority;
                        declaredBackupID = neighborID;
                        backupDeclared = <span class="keyword">true</span>;
                    }
                }
                <span class="keywordflow">if</span> (!backupDeclared) {
                    <span class="keywordflow">if</span> ((neighborPriority &gt; highestPriority) ||
                        ((neighborPriority == highestPriority) &amp;&amp;
                         (neighborID &gt; highestID)))
                    {
                        highestRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> = neighborID;
                        highestRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a3e44bfb89c52a2179bfe69cbd73fc30e">ipInterfaceAddress</a> = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#afb8fc0467b13a32ccd3b088528bb9266">GetAddress</a>();
                        highestPriority = neighborPriority;
                        highestID = neighborID;
                    }
                }
            }
        }
        <span class="comment">// also include the router itself in the calculations</span>
        <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a> &gt; 0) {
            <span class="keywordflow">if</span> (currentDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> != routerID) {
                <span class="keywordflow">if</span> (currentBackupRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> == routerID) {
                    <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a> &gt; declaredBackupPriority) ||
                        ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a> == declaredBackupPriority) &amp;&amp;
                         (routerID &gt; declaredBackupID)))
                    {
                        declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> = routerID;
                        declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a3e44bfb89c52a2179bfe69cbd73fc30e">ipInterfaceAddress</a> = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a834f58c4cc265ce24378a70ea4d6964b">interfaceAddressRange</a>.<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address_range.html#a74993d6571119644535ac918c4240722">address</a>;
                        declaredBackupPriority = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a>;
                        declaredBackupID = routerID;
                        backupDeclared = <span class="keyword">true</span>;
                    }

                }
                <span class="keywordflow">if</span> (!backupDeclared) {
                    <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a> &gt; highestPriority) ||
                        ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a> == highestPriority) &amp;&amp;
                         (routerID &gt; highestID)))
                    {
                        declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> = routerID;
                        declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a3e44bfb89c52a2179bfe69cbd73fc30e">ipInterfaceAddress</a> = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a834f58c4cc265ce24378a70ea4d6964b">interfaceAddressRange</a>.<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address_range.html#a74993d6571119644535ac918c4240722">address</a>;
                        declaredBackupPriority = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a>;
                        declaredBackupID = routerID;
                        backupDeclared = <span class="keyword">true</span>;
                    } <span class="keywordflow">else</span> {
                        declaredBackup = highestRouter;
                        declaredBackupPriority = highestPriority;
                        declaredBackupID = highestID;
                        backupDeclared = <span class="keyword">true</span>;
                    }
                }
            }
        }

        <span class="comment">// calculating backup designated router</span>
        declaredDesignatedRouter = <a class="code" href="namespace_o_s_p_f.html#a1025f956e059380bda5d71fc1e3324f6">OSPF::NullDesignatedRouterID</a>;
        declaredDesignatedRouterPriority = 0;
        declaredDesignatedRouterID = <a class="code" href="namespace_o_s_p_f.html#aa0223d58cbf9a99558b9460b23186730">OSPF::NullRouterID</a>;
        designatedRouterDeclared = <span class="keyword">false</span>;

        <span class="keywordflow">for</span> (i = 0; i &lt; neighborCount; i++) {
            <a class="code" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a>* neighbor         = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[<a class="code" href="namespacecesnet.html#a2d959620f0e772e579c21833995d082e">i</a>];
            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   neighborPriority = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a81e7ec86bff4a427f34bd091e3fb6698">GetPriority</a>();

            <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a934bedd2e5f14281416666a48f357bc9">GetState</a>() &lt; <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0aaa2bc2a9a78de6ca762416b243c632e46">OSPF::Neighbor::TwoWayState</a>) {
                <span class="keywordflow">continue</span>;
            }
            <span class="keywordflow">if</span> (neighborPriority == 0) {
                <span class="keywordflow">continue</span>;
            }

            <a class="code" href="namespace_o_s_p_f.html#ad64f22839cca7ec05fee5b7596411197">OSPF::RouterID</a>           neighborID                      = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#ad80d61e8d0737c7e0a12f1837ac99ffb">GetNeighborID</a>();
            <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> neighborsDesignatedRouter       = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a9720f23a8ca94abd5027932d93684ea2">GetDesignatedRouter</a>();
            <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> neighborsBackupDesignatedRouter = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a460e1cfd8816b958fef01acce13ce82b">GetBackupDesignatedRouter</a>();

            <span class="keywordflow">if</span> (neighborsDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> == neighborID) {
                <span class="keywordflow">if</span> ((neighborPriority &gt; declaredDesignatedRouterPriority) ||
                    ((neighborPriority == declaredDesignatedRouterPriority) &amp;&amp;
                     (neighborID &gt; declaredDesignatedRouterID)))
                {
                    declaredDesignatedRouter = neighborsDesignatedRouter;
                    declaredDesignatedRouterPriority = neighborPriority;
                    declaredDesignatedRouterID = neighborID;
                    designatedRouterDeclared = <span class="keyword">true</span>;
                }
            }
        }
        <span class="comment">// also include the router itself in the calculations</span>
        <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a> &gt; 0) {
            <span class="keywordflow">if</span> (currentDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> == routerID) {
                <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a> &gt; declaredDesignatedRouterPriority) ||
                    ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a> == declaredDesignatedRouterPriority) &amp;&amp;
                     (routerID &gt; declaredDesignatedRouterID)))
                {
                    declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> = routerID;
                    declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a3e44bfb89c52a2179bfe69cbd73fc30e">ipInterfaceAddress</a> = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a834f58c4cc265ce24378a70ea4d6964b">interfaceAddressRange</a>.<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address_range.html#a74993d6571119644535ac918c4240722">address</a>;
                    declaredDesignatedRouterPriority = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a>;
                    declaredDesignatedRouterID = routerID;
                    designatedRouterDeclared = <span class="keyword">true</span>;
                }

            }
        }
        <span class="keywordflow">if</span> (!designatedRouterDeclared) {
            declaredDesignatedRouter = declaredBackup;
            declaredDesignatedRouterPriority = declaredBackupPriority;
            declaredDesignatedRouterID = declaredBackupID;
            designatedRouterDeclared = <span class="keyword">true</span>;
        }

        <span class="comment">// if the router is any kind of DR or is no longer one of them, then repeat</span>
        <span class="comment">//FIXME  suggest parentheses around &amp;&amp; within ||</span>
        <span class="keywordflow">if</span> (
            (
                (declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> != <a class="code" href="namespace_o_s_p_f.html#aa0223d58cbf9a99558b9460b23186730">OSPF::NullRouterID</a>) &amp;&amp;
                (
                    (currentDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> == routerID) &amp;&amp;
                    (declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> != routerID)
                ) ||
                (
                    (currentDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> != routerID) &amp;&amp;
                    (declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> == routerID)
                )
            ) ||
            (
                (declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> != <a class="code" href="namespace_o_s_p_f.html#aa0223d58cbf9a99558b9460b23186730">OSPF::NullRouterID</a>) &amp;&amp;
                (
                    (currentBackupRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> == routerID) &amp;&amp;
                    (declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> != routerID)
                ) ||
                (
                    (currentBackupRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> != routerID) &amp;&amp;
                    (declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> == routerID)
                )
            )
        )
        {
            currentDesignatedRouter = declaredDesignatedRouter;
            currentBackupRouter = declaredBackup;
            repeatCount++;
        } <span class="keywordflow">else</span> {
            repeatCount += 2;
        }

    } <span class="keywordflow">while</span> (repeatCount &lt; 2);

    <a class="code" href="namespace_o_s_p_f.html#ad64f22839cca7ec05fee5b7596411197">OSPF::RouterID</a> routersOldDesignatedRouterID = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a2aa7970a1a4f77bbe3718c1669e0f9a9">designatedRouter</a>.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a>;
    <a class="code" href="namespace_o_s_p_f.html#ad64f22839cca7ec05fee5b7596411197">OSPF::RouterID</a> routersOldBackupID           = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a1c438d26ca9d60a131c2040f20376334">backupDesignatedRouter</a>.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a>;

    intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a2aa7970a1a4f77bbe3718c1669e0f9a9">designatedRouter</a> = declaredDesignatedRouter;
    intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a1c438d26ca9d60a131c2040f20376334">backupDesignatedRouter</a> = declaredBackup;

    <span class="keywordtype">bool</span> wasBackupDesignatedRouter = (routersOldBackupID == routerID);
    <span class="keywordtype">bool</span> wasDesignatedRouter       = (routersOldDesignatedRouterID == routerID);
    <span class="keywordtype">bool</span> wasOther                  = (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a39ffb348308b078fa08b177dbaa77fa1">OSPF::Interface::NotDesignatedRouterState</a>);
    <span class="keywordtype">bool</span> wasWaiting                = (!wasBackupDesignatedRouter &amp;&amp; !wasDesignatedRouter &amp;&amp; !wasOther);
    <span class="keywordtype">bool</span> isBackupDesignatedRouter  = (declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> == routerID);
    <span class="keywordtype">bool</span> isDesignatedRouter        = (declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> == routerID);
    <span class="keywordtype">bool</span> isOther                   = (!isBackupDesignatedRouter &amp;&amp; !isDesignatedRouter);

    <span class="keywordflow">if</span> (wasBackupDesignatedRouter) {
        <span class="keywordflow">if</span> (isDesignatedRouter) {
            <a class="code" href="class_o_s_p_f_1_1_interface_state.html#a10805e77b3f9a99f2e678f8e29f3b7bc">ChangeState</a>(intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_designated_router.html">OSPF::InterfaceStateDesignatedRouter</a>, <span class="keyword">this</span>);
        }
        <span class="keywordflow">if</span> (isOther) {
            <a class="code" href="class_o_s_p_f_1_1_interface_state.html#a10805e77b3f9a99f2e678f8e29f3b7bc">ChangeState</a>(intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_not_designated_router.html">OSPF::InterfaceStateNotDesignatedRouter</a>, <span class="keyword">this</span>);
        }
    }
    <span class="keywordflow">if</span> (wasDesignatedRouter) {
        <span class="keywordflow">if</span> (isBackupDesignatedRouter) {
            <a class="code" href="class_o_s_p_f_1_1_interface_state.html#a10805e77b3f9a99f2e678f8e29f3b7bc">ChangeState</a>(intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_backup.html">OSPF::InterfaceStateBackup</a>, <span class="keyword">this</span>);
        }
        <span class="keywordflow">if</span> (isOther) {
            <a class="code" href="class_o_s_p_f_1_1_interface_state.html#a10805e77b3f9a99f2e678f8e29f3b7bc">ChangeState</a>(intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_not_designated_router.html">OSPF::InterfaceStateNotDesignatedRouter</a>, <span class="keyword">this</span>);
        }
    }
    <span class="keywordflow">if</span> (wasOther) {
        <span class="keywordflow">if</span> (isDesignatedRouter) {
            <a class="code" href="class_o_s_p_f_1_1_interface_state.html#a10805e77b3f9a99f2e678f8e29f3b7bc">ChangeState</a>(intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_designated_router.html">OSPF::InterfaceStateDesignatedRouter</a>, <span class="keyword">this</span>);
        }
        <span class="keywordflow">if</span> (isBackupDesignatedRouter) {
            <a class="code" href="class_o_s_p_f_1_1_interface_state.html#a10805e77b3f9a99f2e678f8e29f3b7bc">ChangeState</a>(intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_backup.html">OSPF::InterfaceStateBackup</a>, <span class="keyword">this</span>);
        }
    }
    <span class="keywordflow">if</span> (wasWaiting) {
        <span class="keywordflow">if</span> (isDesignatedRouter) {
            <a class="code" href="class_o_s_p_f_1_1_interface_state.html#a10805e77b3f9a99f2e678f8e29f3b7bc">ChangeState</a>(intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_designated_router.html">OSPF::InterfaceStateDesignatedRouter</a>, <span class="keyword">this</span>);
        }
        <span class="keywordflow">if</span> (isBackupDesignatedRouter) {
            <a class="code" href="class_o_s_p_f_1_1_interface_state.html#a10805e77b3f9a99f2e678f8e29f3b7bc">ChangeState</a>(intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_backup.html">OSPF::InterfaceStateBackup</a>, <span class="keyword">this</span>);
        }
        <span class="keywordflow">if</span> (isOther) {
            <a class="code" href="class_o_s_p_f_1_1_interface_state.html#a10805e77b3f9a99f2e678f8e29f3b7bc">ChangeState</a>(intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_not_designated_router.html">OSPF::InterfaceStateNotDesignatedRouter</a>, <span class="keyword">this</span>);
        }
    }

    <span class="keywordflow">for</span> (i = 0; i &lt; neighborCount; i++) {
        <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4acae26d6f3ee5ee0f7c1ed2f2196c1dfe07">OSPF::Interface::NBMA</a>) &amp;&amp;
            ((!wasBackupDesignatedRouter &amp;&amp; isBackupDesignatedRouter) ||
             (!wasDesignatedRouter &amp;&amp; isDesignatedRouter)))
        {
            <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;GetPriority() == 0) {
                intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[<a class="code" href="namespacecesnet.html#a2d959620f0e772e579c21833995d082e">i</a>]-&gt;ProcessEvent(<a class="code" href="class_o_s_p_f_1_1_neighbor.html#aa11c941b2bc4a36c36fba1cb453a4172a8b790198cfe23bbe30ae8dbb6153548a">OSPF::Neighbor::Start</a>);
            }
        }
        <span class="keywordflow">if</span> ((declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> != routersOldDesignatedRouterID) ||
            (declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a> != routersOldBackupID))
        {
            <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;GetState() &gt;= <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0aaa2bc2a9a78de6ca762416b243c632e46">OSPF::Neighbor::TwoWayState</a>) {
                intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[<a class="code" href="namespacecesnet.html#a2d959620f0e772e579c21833995d082e">i</a>]-&gt;ProcessEvent(<a class="code" href="class_o_s_p_f_1_1_neighbor.html#aa11c941b2bc4a36c36fba1cb453a4172afcad1cc85205f2b8c8fc2da780b8c3cb">OSPF::Neighbor::IsAdjacencyOK</a>);
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a10805e77b3f9a99f2e678f8e29f3b7bc"></a><!-- doxytag: member="OSPF::InterfaceState::ChangeState" ref="a10805e77b3f9a99f2e678f8e29f3b7bc" args="(Interface *intf, InterfaceState *newState, InterfaceState *currentState)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_s_p_f_1_1_interface_state.html#a10805e77b3f9a99f2e678f8e29f3b7bc">OSPF::InterfaceState::ChangeState</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_s_p_f_1_1_interface.html">OSPF::Interface</a> *&#160;</td>
          <td class="paramname"><em>intf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_s_p_f_1_1_interface_state.html">OSPF::InterfaceState</a> *&#160;</td>
          <td class="paramname"><em>newState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_s_p_f_1_1_interface_state.html">OSPF::InterfaceState</a> *&#160;</td>
          <td class="paramname"><em>currentState</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_s_p_f_interface_state_8cc_source.html#l00027">27</a> of file <a class="el" href="_o_s_p_f_interface_state_8cc_source.html">OSPFInterfaceState.cc</a>.</p>

<p>Referenced by <a class="el" href="_o_s_p_f_interface_state_backup_8cc_source.html#l00025">OSPF::InterfaceStateBackup::ProcessEvent()</a>, <a class="el" href="_o_s_p_f_interface_state_waiting_8cc_source.html#l00025">OSPF::InterfaceStateWaiting::ProcessEvent()</a>, <a class="el" href="_o_s_p_f_interface_state_point_to_point_8cc_source.html#l00025">OSPF::InterfaceStatePointToPoint::ProcessEvent()</a>, <a class="el" href="_o_s_p_f_interface_state_not_designated_router_8cc_source.html#l00025">OSPF::InterfaceStateNotDesignatedRouter::ProcessEvent()</a>, <a class="el" href="_o_s_p_f_interface_state_loopback_8cc_source.html#l00021">OSPF::InterfaceStateLoopback::ProcessEvent()</a>, <a class="el" href="_o_s_p_f_interface_state_down_8cc_source.html#l00027">OSPF::InterfaceStateDown::ProcessEvent()</a>, and <a class="el" href="_o_s_p_f_interface_state_designated_router_8cc_source.html#l00025">OSPF::InterfaceStateDesignatedRouter::ProcessEvent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249">OSPF::Interface::InterfaceStateType</a> oldState            = currentState-&gt;<a class="code" href="class_o_s_p_f_1_1_interface_state.html#a67e02942e33a243dd57f1130015f41b6">GetState</a>();
    <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249">OSPF::Interface::InterfaceStateType</a> nextState           = newState-&gt;<a class="code" href="class_o_s_p_f_1_1_interface_state.html#a67e02942e33a243dd57f1130015f41b6">GetState</a>();
    <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4ac">OSPF::Interface::OSPFInterfaceType</a>  intfType            = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#afc695bd11de24180427aef1161c772a9">GetType</a>();
    <span class="keywordtype">bool</span>                                rebuildRoutingTable = <span class="keyword">false</span>;

    intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#ab7b6f16457d743ff9e525beb5f0647de">ChangeState</a>(newState, currentState);

    <span class="keywordflow">if</span> ((oldState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249ab3a6716ba0f851245d5e2e50bf425035">OSPF::Interface::DownState</a>) ||
        (nextState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249ab3a6716ba0f851245d5e2e50bf425035">OSPF::Interface::DownState</a>) ||
        (oldState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249acff1fbaa2721aa7da821f6d067d918a3">OSPF::Interface::LoopbackState</a>) ||
        (nextState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249acff1fbaa2721aa7da821f6d067d918a3">OSPF::Interface::LoopbackState</a>) ||
        (oldState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a39fb4e003926b18827b15d54a71a3ce2">OSPF::Interface::DesignatedRouterState</a>) ||
        (nextState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a39fb4e003926b18827b15d54a71a3ce2">OSPF::Interface::DesignatedRouterState</a>) ||
        ((intfType == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4aca4dac0c4eca27454daabf38ea32f47775">OSPF::Interface::PointToPoint</a>) &amp;&amp;
         ((oldState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a4afd8475ebf100839309f695531289d4">OSPF::Interface::PointToPointState</a>) ||
          (nextState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a4afd8475ebf100839309f695531289d4">OSPF::Interface::PointToPointState</a>))) ||
        (((intfType == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4aca15decf080ad941585245418cfb9458c9">OSPF::Interface::Broadcast</a>) ||
          (intfType == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4acae26d6f3ee5ee0f7c1ed2f2196c1dfe07">OSPF::Interface::NBMA</a>)) &amp;&amp;
         ((oldState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a4b12c46ab26b94b0f002e9a8f54ae385">OSPF::Interface::WaitingState</a>) ||
          (nextState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a4b12c46ab26b94b0f002e9a8f54ae385">OSPF::Interface::WaitingState</a>))))
    {
        <a class="code" href="class_o_s_p_f_1_1_router_l_s_a.html">OSPF::RouterLSA</a>* routerLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#af1e1cc1b23a4bef7324631f7b6806dba">FindRouterLSA</a>(intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#a12b09f4263d005f7b0cd808502c1de48">GetRouterID</a>());

        <span class="keywordflow">if</span> (routerLSA != NULL) {
            <span class="keywordtype">long</span> sequenceNumber = routerLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#aa1fa1df57d84e20fef93e765a587ff1c">getLsSequenceNumber</a>();
            <span class="keywordflow">if</span> (sequenceNumber == <a class="code" href="_ansa_o_s_p_fcommon_8h.html#a35f49b34e56993fe20d3a21d144c16d3">MAX_SEQUENCE_NUMBER</a>) {
                routerLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a9851dc72d585835bfcffa08412c33f99">setLsAge</a>(<a class="code" href="_ansa_o_s_p_fcommon_8h.html#a22c87c874ff5382c5d082b860110e363">MAX_AGE</a>);
                intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a9a8c725b4e795a67374c2b358ba4f00b">FloodLSA</a>(routerLSA);
                routerLSA-&gt;<a class="code" href="class_o_s_p_f_1_1_l_s_a_tracking_info.html#abf7755405bc9db270e9d3db6beb9f13d">IncrementInstallTime</a>();
            } <span class="keywordflow">else</span> {
                <a class="code" href="class_o_s_p_f_1_1_router_l_s_a.html">OSPF::RouterLSA</a>* newLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#ae5c00fa88fd4354c68b53c332520b794">OriginateRouterLSA</a>();

                newLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#ad1dd1ce9ff9b1c59f8638cdbb26b2d57">setLsSequenceNumber</a>(sequenceNumber + 1);
                newLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a199109163f5a237396afca707b9bf6b7">setLsChecksum</a>(0);    <span class="comment">// TODO: calculate correct LS checksum</span>
                rebuildRoutingTable |= routerLSA-&gt;<a class="code" href="class_o_s_p_f_1_1_router_l_s_a.html#ab15ecd9bdfdb616aeacf47a4e8a7c313">Update</a>(newLSA);
                <span class="keyword">delete</span> newLSA;

                intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a9a8c725b4e795a67374c2b358ba4f00b">FloodLSA</a>(routerLSA);
            }
        } <span class="keywordflow">else</span> {  <span class="comment">// (lsa == NULL) -&gt; This must be the first time any interface is up...</span>
            <a class="code" href="class_o_s_p_f_1_1_router_l_s_a.html">OSPF::RouterLSA</a>* newLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#ae5c00fa88fd4354c68b53c332520b794">OriginateRouterLSA</a>();

            rebuildRoutingTable |= intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a2bf1e74a4aff5191ee798ec0de232010">InstallRouterLSA</a>(newLSA);

            routerLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#af1e1cc1b23a4bef7324631f7b6806dba">FindRouterLSA</a>(intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#a12b09f4263d005f7b0cd808502c1de48">GetRouterID</a>());

            intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#afe6b63fafb7cbb25cff46f585aca0536">SetSPFTreeRoot</a>(routerLSA);
            intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a9a8c725b4e795a67374c2b358ba4f00b">FloodLSA</a>(newLSA);
            <span class="keyword">delete</span> newLSA;
        }
    }

    <span class="keywordflow">if</span> (nextState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a39fb4e003926b18827b15d54a71a3ce2">OSPF::Interface::DesignatedRouterState</a>) {
        <a class="code" href="class_o_s_p_f_1_1_network_l_s_a.html">OSPF::NetworkLSA</a>* newLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6618d36cce9a113c6de92c593128cc24">OriginateNetworkLSA</a>(intf);
        <span class="keywordflow">if</span> (newLSA != NULL) {
            rebuildRoutingTable |= intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a1c7d08c397f076fd2ac40a63ef9f51a3">InstallNetworkLSA</a>(newLSA);

            intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a9a8c725b4e795a67374c2b358ba4f00b">FloodLSA</a>(newLSA);
            <span class="keyword">delete</span> newLSA;
        } <span class="keywordflow">else</span> {    <span class="comment">// no neighbors on the network -&gt; old NetworkLSA must be flushed</span>
            <a class="code" href="class_o_s_p_f_1_1_network_l_s_a.html">OSPF::NetworkLSA</a>* oldLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a39ce9a6b66354f420682a42ae0c9038b">FindNetworkLSA</a>(<a class="code" href="_ansa_o_s_p_fcommon_8h.html#a44aadec2c89ea0ba372ac4ea3025ab52">ULongFromIPv4Address</a>(intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a13403146ed20a460dc19fc9089e55c90">GetAddressRange</a>().<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address_range.html#a74993d6571119644535ac918c4240722">address</a>));

            <span class="keywordflow">if</span> (oldLSA != NULL) {
                oldLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a9851dc72d585835bfcffa08412c33f99">setLsAge</a>(<a class="code" href="_ansa_o_s_p_fcommon_8h.html#a22c87c874ff5382c5d082b860110e363">MAX_AGE</a>);
                intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a9a8c725b4e795a67374c2b358ba4f00b">FloodLSA</a>(oldLSA);
                oldLSA-&gt;<a class="code" href="class_o_s_p_f_1_1_l_s_a_tracking_info.html#abf7755405bc9db270e9d3db6beb9f13d">IncrementInstallTime</a>();
            }
        }
    }

    <span class="keywordflow">if</span> (oldState == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a39fb4e003926b18827b15d54a71a3ce2">OSPF::Interface::DesignatedRouterState</a>) {
        <a class="code" href="class_o_s_p_f_1_1_network_l_s_a.html">OSPF::NetworkLSA</a>* networkLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a39ce9a6b66354f420682a42ae0c9038b">FindNetworkLSA</a>(<a class="code" href="_ansa_o_s_p_fcommon_8h.html#a44aadec2c89ea0ba372ac4ea3025ab52">ULongFromIPv4Address</a>(intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a13403146ed20a460dc19fc9089e55c90">GetAddressRange</a>().<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address_range.html#a74993d6571119644535ac918c4240722">address</a>));

        <span class="keywordflow">if</span> (networkLSA != NULL) {
            networkLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a9851dc72d585835bfcffa08412c33f99">setLsAge</a>(<a class="code" href="_ansa_o_s_p_fcommon_8h.html#a22c87c874ff5382c5d082b860110e363">MAX_AGE</a>);
            intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a9a8c725b4e795a67374c2b358ba4f00b">FloodLSA</a>(networkLSA);
            networkLSA-&gt;<a class="code" href="class_o_s_p_f_1_1_l_s_a_tracking_info.html#abf7755405bc9db270e9d3db6beb9f13d">IncrementInstallTime</a>();
        }
    }

    <span class="keywordflow">if</span> (rebuildRoutingTable) {
        intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a353330e70282153a34fcf9d4ee276acc">GetArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#a184025a0ac2c61dc9c580b2321a9c9a1">RebuildRoutingTable</a>();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a67e02942e33a243dd57f1130015f41b6"></a><!-- doxytag: member="OSPF::InterfaceState::GetState" ref="a67e02942e33a243dd57f1130015f41b6" args="(void) const =0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249">Interface::InterfaceStateType</a> <a class="el" href="class_o_s_p_f_1_1_interface_state.html#a67e02942e33a243dd57f1130015f41b6">OSPF::InterfaceState::GetState</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implemented in <a class="el" href="class_o_s_p_f_1_1_interface_state_backup.html#a85080008592dbbe949afc7ac3adb6584">OSPF::InterfaceStateBackup</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_designated_router.html#a42d492104adee9b397ff394f8fd36744">OSPF::InterfaceStateDesignatedRouter</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_down.html#a99b0dd96b7b945a60621e5c06b6fce5f">OSPF::InterfaceStateDown</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_loopback.html#a4db9f28a6eee35ee49217954152ee838">OSPF::InterfaceStateLoopback</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_not_designated_router.html#aa238a3961a33022f2cb6bb1c3908a4ea">OSPF::InterfaceStateNotDesignatedRouter</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_point_to_point.html#a8bb3dc631e34456b4ad8735db7526488">OSPF::InterfaceStatePointToPoint</a>, and <a class="el" href="class_o_s_p_f_1_1_interface_state_waiting.html#ad0568a18125c70edb03df5903b87caac">OSPF::InterfaceStateWaiting</a>.</p>

<p>Referenced by <a class="el" href="_o_s_p_f_interface_state_8cc_source.html#l00027">ChangeState()</a>.</p>

</div>
</div>
<a class="anchor" id="a2a41c0f4f5decb321c67e0fcceac9bca"></a><!-- doxytag: member="OSPF::InterfaceState::ProcessEvent" ref="a2a41c0f4f5decb321c67e0fcceac9bca" args="(Interface *intf, Interface::InterfaceEventType event)=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="class_o_s_p_f_1_1_interface_state.html#a2a41c0f4f5decb321c67e0fcceac9bca">OSPF::InterfaceState::ProcessEvent</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *&#160;</td>
          <td class="paramname"><em>intf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_s_p_f_1_1_interface.html#ae0aca9ab8ca338c25d9afa6e65fc8824">Interface::InterfaceEventType</a>&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implemented in <a class="el" href="class_o_s_p_f_1_1_interface_state_backup.html#a3cf01c564824be047a09ccc879e3bbf2">OSPF::InterfaceStateBackup</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_designated_router.html#a8d095bf645a3a0624395d66b694523e4">OSPF::InterfaceStateDesignatedRouter</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_down.html#a83cea8a35e1668a5c945c7deb8bf0c9b">OSPF::InterfaceStateDown</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_loopback.html#a314fe175f1d25591d684033d3a5c877d">OSPF::InterfaceStateLoopback</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_not_designated_router.html#a66a27381b680b112dff13e1eea9b1cdf">OSPF::InterfaceStateNotDesignatedRouter</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_point_to_point.html#ad1f8cf4997cd0466739dc1f92bd729c5">OSPF::InterfaceStatePointToPoint</a>, and <a class="el" href="class_o_s_p_f_1_1_interface_state_waiting.html#a1c171914cc5f51b2abfd31a2989f381f">OSPF::InterfaceStateWaiting</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_o_s_p_f_interface_state_8h_source.html">OSPFInterfaceState.h</a></li>
<li><a class="el" href="_o_s_p_f_interface_state_8cc_source.html">OSPFInterfaceState.cc</a></li>
</ul>
</div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespace_o_s_p_f.html">OSPF</a>      </li>
      <li class="navelem"><a class="el" href="class_o_s_p_f_1_1_interface_state.html">InterfaceState</a>      </li>

    <li class="footer">Generated on Thu Aug 30 2012 22:56:56 for INET Framework for OMNeT++/OMNEST by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
