<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>INET Framework for OMNeT++/OMNEST: OSPF::LinkStateRequestHandler Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">INET Framework for OMNeT++/OMNEST
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_o_s_p_f_1_1_link_state_request_handler.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">OSPF::LinkStateRequestHandler Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OSPF::LinkStateRequestHandler" --><!-- doxytag: inherits="OSPF::IMessageHandler" -->
<p><code>#include &lt;LinkStateRequestHandler.h&gt;</code></p>
<div class="dynheader">
Inheritance diagram for OSPF::LinkStateRequestHandler:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_o_s_p_f_1_1_link_state_request_handler.png" usemap="#OSPF::LinkStateRequestHandler_map" alt=""/>
  <map id="OSPF::LinkStateRequestHandler_map" name="OSPF::LinkStateRequestHandler_map">
<area href="class_o_s_p_f_1_1_i_message_handler.html" alt="OSPF::IMessageHandler" shape="rect" coords="0,0,192,24"/>
</map>
 </div></div>

<p><a href="class_o_s_p_f_1_1_link_state_request_handler-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_link_state_request_handler.html#a4173b4ad1ad0c30da932947490ef2c94">LinkStateRequestHandler</a> (<a class="el" href="class_o_s_p_f_1_1_router.html">Router</a> *containingRouter)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="timer__queue_8h.html#a07640d68b3fdfaa5c48a36265e8f10b8">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_link_state_request_handler.html#a523ca80639d942223ed598df83dd98cc">processPacket</a> (<a class="el" href="class_o_s_p_f_packet.html">OSPFPacket</a> *packet, <a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *intf, <a class="el" href="class_o_s_p_f_1_1_neighbor.html">Neighbor</a> *<a class="el" href="structneighbor.html">neighbor</a>)</td></tr>
</table>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a4173b4ad1ad0c30da932947490ef2c94"></a><!-- doxytag: member="OSPF::LinkStateRequestHandler::LinkStateRequestHandler" ref="a4173b4ad1ad0c30da932947490ef2c94" args="(Router *containingRouter)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_s_p_f_1_1_link_state_request_handler.html#a4173b4ad1ad0c30da932947490ef2c94">OSPF::LinkStateRequestHandler::LinkStateRequestHandler</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_s_p_f_1_1_router.html">OSPF::Router</a> *&#160;</td>
          <td class="paramname"><em>containingRouter</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                                                 :
    <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#afa003e6c747b4a1961dede68915231ee">OSPF::IMessageHandler</a>(containingRouter)
{
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a523ca80639d942223ed598df83dd98cc"></a><!-- doxytag: member="OSPF::LinkStateRequestHandler::processPacket" ref="a523ca80639d942223ed598df83dd98cc" args="(OSPFPacket *packet, Interface *intf, Neighbor *neighbor)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="timer__queue_8h.html#a07640d68b3fdfaa5c48a36265e8f10b8">void</a> <a class="el" href="class_o_s_p_f_1_1_link_state_request_handler.html#a523ca80639d942223ed598df83dd98cc">OSPF::LinkStateRequestHandler::processPacket</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_s_p_f_packet.html">OSPFPacket</a> *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_s_p_f_1_1_interface.html">OSPF::Interface</a> *&#160;</td>
          <td class="paramname"><em>intf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a> *&#160;</td>
          <td class="paramname"><em>neighbor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="class_o_s_p_f_1_1_i_message_handler.html#a12324915dcb49ccc22e87a3e489d869c">OSPF::IMessageHandler</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#a24cb6c6f9b62a4e403d5171a0d36f22a">router</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#a0142a9cc0f45692f0af116de386f9d6b">getMessageHandler</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#acb75420d7cb059d453368401786b053a">printEvent</a>(<span class="stringliteral">&quot;Link State Request packet received&quot;</span>, intf, neighbor);

    <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0a">OSPF::Neighbor::NeighborStateType</a> neighborState = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a8402e724645d205d658bb9d166d99aa6">getState</a>();

    <span class="keywordflow">if</span> ((neighborState == <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0aad5cc030cacf3612d64c1d30c2b27a63f">OSPF::Neighbor::EXCHANGE_STATE</a>) ||
        (neighborState == <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0aa446b2e6cb8487496c6a2ed568fb74f08">OSPF::Neighbor::LOADING_STATE</a>) ||
        (neighborState == <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0aa5a11a4afcf7487dae9dbcba44b8577d2">OSPF::Neighbor::FULL_STATE</a>))
    {
        <a class="code" href="class_o_s_p_f_link_state_request_packet.html" title="Class generated from networklayer/ospfv2/OSPFPacket.msg by opp_msgc.">OSPFLinkStateRequestPacket</a>* lsRequestPacket = check_and_cast&lt;<a class="code" href="class_o_s_p_f_link_state_request_packet.html" title="Class generated from networklayer/ospfv2/OSPFPacket.msg by opp_msgc.">OSPFLinkStateRequestPacket</a>*&gt; (packet);

        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> requestCount = lsRequestPacket-&gt;<a class="code" href="class_o_s_p_f_link_state_request_packet.html#a2afbba06af70d3f71fd3cf42305bc734">getRequestsArraySize</a>();
        <span class="keywordtype">bool</span> error = <span class="keyword">false</span>;
        std::vector&lt;OSPFLSA*&gt; lsas;

        <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;  Processing packet contents:\n&quot;</span>;

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i = 0; i &lt; requestCount; i++) {
            <a class="code" href="struct_l_s_a_request.html" title="Struct generated from networklayer/ospfv2/OSPFPacket.msg by opp_msgc.">LSARequest</a>&amp; request = lsRequestPacket-&gt;<a class="code" href="class_o_s_p_f_link_state_request_packet.html#a342c2d4e18333b935d114ec501ce4b80">getRequests</a>(i);
            <a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html">OSPF::LSAKeyType</a> lsaKey;

            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;    LSARequest: type=&quot;</span> &lt;&lt; request.<a class="code" href="struct_l_s_a_request.html#a0b47e91096b8c5d6074e3c6eb555a058">lsType</a>
               &lt;&lt; <span class="stringliteral">&quot;, LSID=&quot;</span> &lt;&lt; request.<a class="code" href="struct_l_s_a_request.html#a0eb54728b91e5bf5a1ffc1046366edf5">linkStateID</a>
               &lt;&lt; <span class="stringliteral">&quot;, advertisingRouter=&quot;</span> &lt;&lt; request.<a class="code" href="struct_l_s_a_request.html#a32ffd2724852d59a6841c5d17d85e110">advertisingRouter</a>
               &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

            lsaKey.<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html#a3a05e7e193451f3979803d5e93362ead">linkStateID</a> = request.<a class="code" href="struct_l_s_a_request.html#a0eb54728b91e5bf5a1ffc1046366edf5">linkStateID</a>;
            lsaKey.<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html#a583e0f1cf5e052a08dc21dbcd405e8b6">advertisingRouter</a> = request.<a class="code" href="struct_l_s_a_request.html#a32ffd2724852d59a6841c5d17d85e110">advertisingRouter</a>;

            <a class="code" href="class_o_s_p_f_l_s_a.html" title="Class generated from networklayer/ospfv2/OSPFPacket.msg by opp_msgc.">OSPFLSA</a>* lsaInDatabase = <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#a24cb6c6f9b62a4e403d5171a0d36f22a">router</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#aa2e591c3ef0241639b4e12b0cab7a8f9" title="Find the LSA identified by the input lsaKey in the database.">findLSA</a>(static_cast&lt;LSAType&gt; (request.<a class="code" href="struct_l_s_a_request.html#a0b47e91096b8c5d6074e3c6eb555a058">lsType</a>), lsaKey, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a42decc255df2e2adb5619f0d1cd52bc0">getArea</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a7271107db6ddbec5feece06f2a503706">getAreaID</a>());

            <span class="keywordflow">if</span> (lsaInDatabase != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
                lsas.push_back(lsaInDatabase);
            } <span class="keywordflow">else</span> {
                error = <span class="keyword">true</span>;
                neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a76006db06d34257a1c614a5e9e8fb878">processEvent</a>(<a class="code" href="class_o_s_p_f_1_1_neighbor.html#aa11c941b2bc4a36c36fba1cb453a4172a7d65babc9bec6ed53cd0b681cf39460c">OSPF::Neighbor::BAD_LINK_STATE_REQUEST</a>);
                <span class="keywordflow">break</span>;
            }
        }

        <span class="keywordflow">if</span> (!error) {
            <span class="keywordtype">int</span> updatesCount = lsas.size();
            <span class="keywordtype">int</span> <a class="code" href="_t_c_p___n_s_c_8cc.html#a4d402503271315376ddf4e47674d4965">ttl</a> = (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a29189950efe0c6411fb5181175d57310">getType</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4aca5ea9dce97089a750f8ad3c1ec49fa389">OSPF::Interface::VIRTUAL</a>) ? <a class="code" href="_o_s_p_fcommon_8h.html#a1d4e674fb39c33571b1b8b8f28f02b52">VIRTUAL_LINK_TTL</a> : 1;
            <a class="code" href="class_o_s_p_f_1_1_message_handler.html">OSPF::MessageHandler</a>* messageHandler = <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#a24cb6c6f9b62a4e403d5171a0d36f22a">router</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#a0142a9cc0f45692f0af116de386f9d6b">getMessageHandler</a>();

            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; updatesCount; j++) {
                <a class="code" href="class_o_s_p_f_link_state_update_packet.html" title="Class generated from networklayer/ospfv2/OSPFPacket.msg by opp_msgc.">OSPFLinkStateUpdatePacket</a>* updatePacket = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a1ab8bc7bfe66c16401bfb4d4d9a08db7">createUpdatePacket</a>(lsas[j]);
                <span class="keywordflow">if</span> (updatePacket != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
                    <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a29189950efe0c6411fb5181175d57310">getType</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4aca237bd0e7c65b27bf1d75ddeccf7f67f9">OSPF::Interface::BROADCAST</a>) {
                        <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#ad414101ce155a1956a4fe8a22be6d69f">getState</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a95589231f8e97343f94c3bd98dca00f4">OSPF::Interface::DESIGNATED_ROUTER_STATE</a>) ||
                            (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#ad414101ce155a1956a4fe8a22be6d69f">getState</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a0b693d60a39a1cf9ec33460ff8f46efd">OSPF::Interface::BACKUP_STATE</a>) ||
                            (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a0c7d7f3062298d134b6ef09d5935c21d">getDesignatedRouter</a>() == <a class="code" href="namespace_o_s_p_f.html#a29d73750cc11d3ebb94d7faf67bd7ff1">OSPF::NULL_DESIGNATEDROUTERID</a>))
                        {
                            messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#ad4fbc2caf82a689b42bd15ec2e7f9e83">sendPacket</a>(updatePacket, <a class="code" href="class_i_pv4_address.html#a77ed6f2a43dda6acc0456331738b6f76" title="224.0.0.5 All OSPF routers (DR Others)">IPv4Address::ALL_OSPF_ROUTERS_MCAST</a>, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7899e5633c881ee097813b858434b119">getIfIndex</a>(), <a class="code" href="_t_c_p___n_s_c_8cc.html#a4d402503271315376ddf4e47674d4965">ttl</a>);
                        } <span class="keywordflow">else</span> {
                            messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#ad4fbc2caf82a689b42bd15ec2e7f9e83">sendPacket</a>(updatePacket, <a class="code" href="class_i_pv4_address.html#a5a294d7462519b9d11452a242ea8af92" title="224.0.0.6 All OSPF Designated Routers">IPv4Address::ALL_OSPF_DESIGNATED_ROUTERS_MCAST</a>, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7899e5633c881ee097813b858434b119">getIfIndex</a>(), <a class="code" href="_t_c_p___n_s_c_8cc.html#a4d402503271315376ddf4e47674d4965">ttl</a>);
                        }
                    } <span class="keywordflow">else</span> {
                        <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a29189950efe0c6411fb5181175d57310">getType</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4acaa57573e6fff63738e0f342ee1d5d760f">OSPF::Interface::POINTTOPOINT</a>) {
                            messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#ad4fbc2caf82a689b42bd15ec2e7f9e83">sendPacket</a>(updatePacket, <a class="code" href="class_i_pv4_address.html#a77ed6f2a43dda6acc0456331738b6f76" title="224.0.0.5 All OSPF routers (DR Others)">IPv4Address::ALL_OSPF_ROUTERS_MCAST</a>, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7899e5633c881ee097813b858434b119">getIfIndex</a>(), <a class="code" href="_t_c_p___n_s_c_8cc.html#a4d402503271315376ddf4e47674d4965">ttl</a>);
                        } <span class="keywordflow">else</span> {
                            messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#ad4fbc2caf82a689b42bd15ec2e7f9e83">sendPacket</a>(updatePacket, neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a5de77058501383c2655be390494f1b92">getAddress</a>(), intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a7899e5633c881ee097813b858434b119">getIfIndex</a>(), <a class="code" href="_t_c_p___n_s_c_8cc.html#a4d402503271315376ddf4e47674d4965">ttl</a>);
                        }
                    }

                }
            }
            <span class="comment">// These update packets should not be placed on retransmission lists</span>
        }
    }
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_link_state_request_handler_8h.html">LinkStateRequestHandler.h</a></li>
<li><a class="el" href="_link_state_request_handler_8cc.html">LinkStateRequestHandler.cc</a></li>
</ul>
</div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespace_o_s_p_f.html">OSPF</a>      </li>
      <li class="navelem"><a class="el" href="class_o_s_p_f_1_1_link_state_request_handler.html">LinkStateRequestHandler</a>      </li>

    <li class="footer">Generated on Tue Aug 7 2012 16:01:33 for INET Framework for OMNeT++/OMNEST by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
