<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
      <link rel="stylesheet" type="text/css" href="style.css" />
   </head>
   <body onload="if (top.frames['componentsframe'] == undefined) { s = window.location.toString(); window.location = 'index.html?p=' + s.substring(s.lastIndexOf('/')+1); }">
<h2 class="comptitle">NED File <i>src/linklayer/ethernet/EthernetInterface.ned</i></h2>
<table class="typestable">
   <tr>
      <th class="name">Name</th>
      <th class="type">Type</th>
      <th class="description">Description</th>
   </tr>
<tr>
   <td>
<a href="inet.linklayer.ethernet.EthernetInterface.html">EthernetInterface</a>
   </td>
   <td>
<i>compound&nbsp;module</i>
   </td>
   <td>

<p>Ethernet network interface. Complements <a href="inet.linklayer.ethernet.EtherMAC.html">EtherMAC</a> and <a href="inet.linklayer.ethernet.EtherEncap.html">EtherEncap</a>
with an output queue for QoS and RED support.</p>

   </td>
</tr>
</table>
<h3 class="subtitle">Source code:</h3>
<pre class="src"><span style="color: #808080; font-style: italic; ">//
// Copyright (C) 2004 Andras Varga
//               2010 Zoltan Bojthe
//
// This program is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public License
// as published by the Free Software Foundation; either version 2
// of the License, or (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public License
// along with this program; if not, see &lt;http://www.gnu.org/licenses/&gt;.
//
</span><span style="color: #000000; ">


</span><span style="color: #800000; font-weight: bold; ">package</span><span style="color: #000000; "> </span><span style="color: #000000; ">inet</span><span style="color: #000000; ">.</span><span style="color: #000000; ">linklayer</span><span style="color: #000000; ">.</span><span style="color: #000000; ">ethernet</span><span style="color: #000000; ">;

</span><span style="color: #800000; font-weight: bold; ">import</span><span style="color: #000000; "> </span><span style="color: #000000; ">inet</span><span style="color: #000000; ">.</span><span style="color: #000000; ">base</span><span style="color: #000000; ">.</span><span style="color: #000000; ">IHook</span><span style="color: #000000; ">;
</span><span style="color: #800000; font-weight: bold; ">import</span><span style="color: #000000; "> </span><span style="color: #000000; ">inet</span><span style="color: #000000; ">.</span><span style="color: #000000; ">linklayer</span><span style="color: #000000; ">.</span><span style="color: #000000; ">IEtherMAC</span><span style="color: #000000; ">;
</span><span style="color: #800000; font-weight: bold; ">import</span><span style="color: #000000; "> </span><span style="color: #000000; ">inet</span><span style="color: #000000; ">.</span><span style="color: #000000; ">linklayer</span><span style="color: #000000; ">.</span><span style="color: #000000; ">IWiredNic</span><span style="color: #000000; ">;
</span><span style="color: #800000; font-weight: bold; ">import</span><span style="color: #000000; "> </span><span style="color: #000000; ">inet</span><span style="color: #000000; ">.</span><span style="color: #000000; ">linklayer</span><span style="color: #000000; ">.</span><span style="color: #000000; ">ITrafficConditioner</span><span style="color: #000000; ">;


</span><span style="color: #808080; font-style: italic; ">//
// Ethernet network interface. Complements ~EtherMAC and ~EtherEncap
// with an output queue for QoS and RED support.
//
</span><span style="color: #800000; font-weight: bold; ">module</span><span style="color: #000000; "> </span><span style="color: #000000; ">EthernetInterface</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">like</span><span style="color: #000000; "> </span><span style="color: #000000; ">IWiredNic</span><span style="color: #000000; ">
{
    </span><span style="color: #800000; font-weight: bold; ">parameters</span><span style="color: #000000; ">:
        </span><span style="color: #000080; font-weight: bold; ">bool</span><span style="color: #000000; "> </span><span style="color: #000000; ">csmacdSupport</span><span style="color: #000000; "> = </span><span style="color: #800000; font-weight: bold; ">default</span><span style="color: #000000; ">(</span><span style="color: #008000; ">false</span><span style="color: #000000; ">);  </span><span style="color: #808080; font-style: italic; ">// by default CSMA/CD is turned off, so only point-to-point duplex links are supported.
</span><span style="color: #000000; ">        </span><span style="color: #000080; font-weight: bold; ">bool</span><span style="color: #000000; "> </span><span style="color: #000000; ">useSNAP</span><span style="color: #000000; "> = </span><span style="color: #800000; font-weight: bold; ">default</span><span style="color: #000000; ">(</span><span style="color: #008000; ">false</span><span style="color: #000000; ">);  </span><span style="color: #808080; font-style: italic; ">// use EtherFrameWithSNAP instead EthernetIIFrame
</span><span style="color: #000000; ">        </span><span style="color: #000080; font-weight: bold; ">string</span><span style="color: #000000; "> </span><span style="color: #000000; ">macType</span><span style="color: #000000; "> = </span><span style="color: #800000; font-weight: bold; ">default</span><span style="color: #000000; ">(</span><span style="color: #000000; ">csmacdSupport</span><span style="color: #000000; "> ? </span><span style="color: #008000; ">&quot;EtherMAC&quot;</span><span style="color: #000000; "> : </span><span style="color: #008000; ">&quot;EtherMACFullDuplex&quot;</span><span style="color: #000000; ">); </span><span style="color: #808080; font-style: italic; ">// ~EtherMAC or ~EtherMACFullDuplex
</span><span style="color: #000000; ">        </span><span style="color: #000080; font-weight: bold; ">string</span><span style="color: #000000; "> </span><span style="color: #000000; ">queueType</span><span style="color: #000000; "> = </span><span style="color: #800000; font-weight: bold; ">default</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">); </span><span style="color: #808080; font-style: italic; ">// ~DropTailQueue, or a Diffserv queue; set to &quot;&quot; for use of an internal queue
</span><span style="color: #000000; ">        </span><span style="color: #000080; font-weight: bold; ">string</span><span style="color: #000000; "> </span><span style="color: #000000; ">ingressTCType</span><span style="color: #000000; "> = </span><span style="color: #800000; font-weight: bold; ">default</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">); </span><span style="color: #808080; font-style: italic; ">// a module type implementing ~ITrafficConditioner for optional traffic conditioning of incoming traffic
</span><span style="color: #000000; ">        </span><span style="color: #000080; font-weight: bold; ">string</span><span style="color: #000000; "> </span><span style="color: #000000; ">egressTCType</span><span style="color: #000000; "> = </span><span style="color: #800000; font-weight: bold; ">default</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">); </span><span style="color: #808080; font-style: italic; ">// a module type implementing ~ITrafficConditioner for optional traffic conditioning of outgoing traffic
</span><span style="color: #000000; ">        </span><span style="color: #000080; font-weight: bold; ">int</span><span style="color: #000000; "> </span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; "> = </span><span style="color: #800000; font-weight: bold; ">default</span><span style="color: #000000; ">(</span><span style="color: #008000; ">0</span><span style="color: #000000; ">);
        </span><span style="color: #000080; font-weight: bold; ">int</span><span style="color: #000000; "> </span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; "> = </span><span style="color: #800000; font-weight: bold; ">default</span><span style="color: #000000; ">(</span><span style="color: #008000; ">0</span><span style="color: #000000; ">);
        </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;i=block/ifcard;bgl=2&quot;</span><span style="color: #000000; ">);
    </span><span style="color: #800000; font-weight: bold; ">gates</span><span style="color: #000000; ">:
        </span><span style="color: #000080; font-weight: bold; ">input</span><span style="color: #000000; "> </span><span style="color: #000000; ">upperLayerIn</span><span style="color: #000000; ">;
        </span><span style="color: #000080; font-weight: bold; ">output</span><span style="color: #000000; "> </span><span style="color: #000000; ">upperLayerOut</span><span style="color: #000000; ">;
        </span><span style="color: #000080; font-weight: bold; ">inout</span><span style="color: #000000; "> </span><span style="color: #000000; ">phys</span><span style="color: #000000; "> </span><span style="color: #000000; font-weight: bold; ">@labels</span><span style="color: #000000; ">(</span><span style="color: #000000; ">EtherFrame</span><span style="color: #000000; ">);
    </span><span style="color: #800000; font-weight: bold; ">submodules</span><span style="color: #000000; ">:
        </span><span style="color: #000000; ">outputHook</span><span style="color: #000000; ">[</span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; ">]: &lt;</span><span style="color: #800000; font-weight: bold; ">default</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;Nop&quot;</span><span style="color: #000000; ">)&gt; </span><span style="color: #800000; font-weight: bold; ">like</span><span style="color: #000000; "> </span><span style="color: #000000; ">IHook</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; ">&gt;</span><span style="color: #008000; ">0</span><span style="color: #000000; "> {
            </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;p=80,98&quot;</span><span style="color: #000000; ">);
        }
        </span><span style="color: #000000; ">inputHook</span><span style="color: #000000; ">[</span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; ">]: &lt;</span><span style="color: #800000; font-weight: bold; ">default</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;Nop&quot;</span><span style="color: #000000; ">)&gt; </span><span style="color: #800000; font-weight: bold; ">like</span><span style="color: #000000; "> </span><span style="color: #000000; ">IHook</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; ">&gt;</span><span style="color: #008000; ">0</span><span style="color: #000000; "> {
            </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;p=265,83&quot;</span><span style="color: #000000; ">);
        }
        </span><span style="color: #000000; ">ingressTC</span><span style="color: #000000; ">: &lt;</span><span style="color: #000000; ">ingressTCType</span><span style="color: #000000; ">&gt; </span><span style="color: #800000; font-weight: bold; ">like</span><span style="color: #000000; "> </span><span style="color: #000000; ">ITrafficConditioner</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">ingressTCType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; "> {
            </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;p=292,158&quot;</span><span style="color: #000000; ">);
        }
        </span><span style="color: #000000; ">egressTC</span><span style="color: #000000; ">: &lt;</span><span style="color: #000000; ">egressTCType</span><span style="color: #000000; ">&gt; </span><span style="color: #800000; font-weight: bold; ">like</span><span style="color: #000000; "> </span><span style="color: #000000; ">ITrafficConditioner</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">egressTCType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; "> {
            </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;p=53,158&quot;</span><span style="color: #000000; ">);
        }
        </span><span style="color: #000000; ">queue</span><span style="color: #000000; ">: </span><span style="color: #000000; ">EtherQoSQueue</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">queueType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; "> {
            </span><span style="color: #800000; font-weight: bold; ">parameters</span><span style="color: #000000; ">:
                </span><span style="color: #000000; ">dataQueueType</span><span style="color: #000000; "> = </span><span style="color: #000000; ">queueType</span><span style="color: #000000; ">;
                </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;p=107,263;q=l2queue&quot;</span><span style="color: #000000; ">);
        }
        </span><span style="color: #000000; ">mac</span><span style="color: #000000; ">: &lt;</span><span style="color: #000000; ">macType</span><span style="color: #000000; ">&gt; </span><span style="color: #800000; font-weight: bold; ">like</span><span style="color: #000000; "> </span><span style="color: #000000; ">IEtherMAC</span><span style="color: #000000; "> {
            </span><span style="color: #800000; font-weight: bold; ">parameters</span><span style="color: #000000; ">:
                </span><span style="color: #000000; ">queueModule</span><span style="color: #000000; "> = (</span><span style="color: #000000; ">queueType</span><span style="color: #000000; "> == </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; "> ? </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; "> : </span><span style="color: #008000; ">&quot;queue&quot;</span><span style="color: #000000; ">);
                </span><span style="color: #000000; ">txQueueLimit</span><span style="color: #000000; "> = (</span><span style="color: #000000; ">queueType</span><span style="color: #000000; "> == </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; "> ? </span><span style="color: #008000; ">10000</span><span style="color: #000000; "> : </span><span style="color: #008000; ">1</span><span style="color: #000000; ">); </span><span style="color: #808080; font-style: italic; ">// queue sends one packet at a time
</span><span style="color: #000000; ">                </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;p=182,321&quot;</span><span style="color: #000000; ">);
        }
        </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">: </span><span style="color: #000000; ">EtherEncap</span><span style="color: #000000; "> {
            </span><span style="color: #800000; font-weight: bold; ">parameters</span><span style="color: #000000; ">:
                </span><span style="color: #000000; ">useSNAP</span><span style="color: #000000; "> = </span><span style="color: #000000; ">useSNAP</span><span style="color: #000000; ">;
                </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;p=182,205&quot;</span><span style="color: #000000; ">);
        }
    </span><span style="color: #800000; font-weight: bold; ">connections</span><span style="color: #000000; ">:
        </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">.</span><span style="color: #000000; ">lowerLayerOut</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">queue</span><span style="color: #000000; ">.</span><span style="color: #000000; ">in</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">queueType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">queue</span><span style="color: #000000; ">.</span><span style="color: #000000; ">out</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">mac</span><span style="color: #000000; ">.</span><span style="color: #000000; ">upperLayerIn</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">queueType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">.</span><span style="color: #000000; ">lowerLayerOut</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">mac</span><span style="color: #000000; ">.</span><span style="color: #000000; ">upperLayerIn</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">queueType</span><span style="color: #000000; "> == </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">.</span><span style="color: #000000; ">lowerLayerIn</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">&lt;--</span><span style="color: #000000; "> </span><span style="color: #000000; ">mac</span><span style="color: #000000; ">.</span><span style="color: #000000; ">upperLayerOut</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">mac</span><span style="color: #000000; ">.</span><span style="color: #000000; ">phys</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">&lt;--&gt;</span><span style="color: #000000; "> { </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;m=s&quot;</span><span style="color: #000000; ">); } </span><span style="color: #800000; font-weight: bold; ">&lt;--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">phys</span><span style="color: #000000; ">;

        </span><span style="color: #808080; font-style: italic; ">// chain input hooks
</span><span style="color: #000000; ">        </span><span style="color: #800000; font-weight: bold; ">for</span><span style="color: #000000; "> </span><span style="color: #000000; ">i</span><span style="color: #000000; ">=</span><span style="color: #008000; ">0</span><span style="color: #000000; ">..</span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; ">-</span><span style="color: #008000; ">2</span><span style="color: #000000; "> {
            </span><span style="color: #000000; ">inputHook</span><span style="color: #000000; ">[</span><span style="color: #000000; ">i</span><span style="color: #000000; ">].</span><span style="color: #000000; ">out</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">inputHook</span><span style="color: #000000; ">[</span><span style="color: #000000; ">i</span><span style="color: #000000; ">+</span><span style="color: #008000; ">1</span><span style="color: #000000; ">].</span><span style="color: #000000; ">in</span><span style="color: #000000; ">;
        }

        </span><span style="color: #808080; font-style: italic; ">// no input hooks, no ingressTC
</span><span style="color: #000000; ">        </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">.</span><span style="color: #000000; ">upperLayerOut</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> { </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;m=n&quot;</span><span style="color: #000000; ">); } </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">upperLayerOut</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; "> == </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">ingressTCType</span><span style="color: #000000; "> == </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;

        </span><span style="color: #808080; font-style: italic; ">// no input hooks, there is ingressTC
</span><span style="color: #000000; ">        </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">.</span><span style="color: #000000; ">upperLayerOut</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">ingressTC</span><span style="color: #000000; ">.</span><span style="color: #000000; ">in</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; "> == </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">ingressTCType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">ingressTC</span><span style="color: #000000; ">.</span><span style="color: #000000; ">out</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> { </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;m=n&quot;</span><span style="color: #000000; ">); } </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">upperLayerOut</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; "> == </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">ingressTCType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;

        </span><span style="color: #808080; font-style: italic; ">// there are input hooks, no ingressTC
</span><span style="color: #000000; ">        </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">.</span><span style="color: #000000; ">upperLayerOut</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">inputHook</span><span style="color: #000000; ">[</span><span style="color: #008000; ">0</span><span style="color: #000000; ">].</span><span style="color: #000000; ">in</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; "> &gt; </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">ingressTCType</span><span style="color: #000000; "> == </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">inputHook</span><span style="color: #000000; ">[</span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; ">-</span><span style="color: #008000; ">1</span><span style="color: #000000; ">].</span><span style="color: #000000; ">out</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> { </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;m=n&quot;</span><span style="color: #000000; ">); } </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">upperLayerOut</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; "> &gt; </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">ingressTCType</span><span style="color: #000000; "> == </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;

        </span><span style="color: #808080; font-style: italic; ">// there are input hooks, there is ingressTC
</span><span style="color: #000000; ">        </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">.</span><span style="color: #000000; ">upperLayerOut</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">ingressTC</span><span style="color: #000000; ">.</span><span style="color: #000000; ">in</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; "> &gt; </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">ingressTCType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">ingressTC</span><span style="color: #000000; ">.</span><span style="color: #000000; ">out</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">inputHook</span><span style="color: #000000; ">[</span><span style="color: #008000; ">0</span><span style="color: #000000; ">].</span><span style="color: #000000; ">in</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; "> &gt; </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">ingressTCType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">inputHook</span><span style="color: #000000; ">[</span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; ">-</span><span style="color: #008000; ">1</span><span style="color: #000000; ">].</span><span style="color: #000000; ">out</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> { </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;m=n&quot;</span><span style="color: #000000; ">); } </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">upperLayerOut</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; "> &gt; </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">ingressTCType</span><span style="color: #000000; "> == </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;

        </span><span style="color: #808080; font-style: italic; ">// chain output hooks
</span><span style="color: #000000; ">        </span><span style="color: #800000; font-weight: bold; ">for</span><span style="color: #000000; "> </span><span style="color: #000000; ">i</span><span style="color: #000000; ">=</span><span style="color: #008000; ">0</span><span style="color: #000000; ">..</span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; ">-</span><span style="color: #008000; ">2</span><span style="color: #000000; "> {
            </span><span style="color: #000000; ">outputHook</span><span style="color: #000000; ">[</span><span style="color: #000000; ">i</span><span style="color: #000000; ">].</span><span style="color: #000000; ">out</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">outputHook</span><span style="color: #000000; ">[</span><span style="color: #000000; ">i</span><span style="color: #000000; ">+</span><span style="color: #008000; ">1</span><span style="color: #000000; ">].</span><span style="color: #000000; ">in</span><span style="color: #000000; ">;
        }

        </span><span style="color: #808080; font-style: italic; ">// no output hooks, no egressTC
</span><span style="color: #000000; ">        </span><span style="color: #000000; ">upperLayerIn</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> { </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;m=n&quot;</span><span style="color: #000000; ">); } </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">.</span><span style="color: #000000; ">upperLayerIn</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; "> == </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">egressTCType</span><span style="color: #000000; "> == </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;

        </span><span style="color: #808080; font-style: italic; ">// no output hooks, there is egressTC
</span><span style="color: #000000; ">        </span><span style="color: #000000; ">upperLayerIn</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> { </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;m=n&quot;</span><span style="color: #000000; ">); } </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">egressTC</span><span style="color: #000000; ">.</span><span style="color: #000000; ">in</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; "> == </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">egressTCType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">egressTC</span><span style="color: #000000; ">.</span><span style="color: #000000; ">out</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">.</span><span style="color: #000000; ">upperLayerIn</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; "> == </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">egressTCType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;

        </span><span style="color: #808080; font-style: italic; ">// there are output hooks, no egressTC
</span><span style="color: #000000; ">        </span><span style="color: #000000; ">upperLayerIn</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> { </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;m=n&quot;</span><span style="color: #000000; ">); } </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">outputHook</span><span style="color: #000000; ">[</span><span style="color: #008000; ">0</span><span style="color: #000000; ">].</span><span style="color: #000000; ">in</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; "> &gt; </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">egressTCType</span><span style="color: #000000; "> == </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">outputHook</span><span style="color: #000000; ">[</span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; ">-</span><span style="color: #008000; ">1</span><span style="color: #000000; ">].</span><span style="color: #000000; ">out</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">.</span><span style="color: #000000; ">upperLayerIn</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; "> &gt; </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">egressTCType</span><span style="color: #000000; "> == </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;

        </span><span style="color: #808080; font-style: italic; ">// there are output hooks, there is egressTC
</span><span style="color: #000000; ">        </span><span style="color: #000000; ">upperLayerIn</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> { </span><span style="color: #000000; font-weight: bold; ">@display</span><span style="color: #000000; ">(</span><span style="color: #008000; ">&quot;m=n&quot;</span><span style="color: #000000; ">); } </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">outputHook</span><span style="color: #000000; ">[</span><span style="color: #008000; ">0</span><span style="color: #000000; ">].</span><span style="color: #000000; ">in</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; "> &gt; </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">egressTCType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">outputHook</span><span style="color: #000000; ">[</span><span style="color: #000000; ">numInputHooks</span><span style="color: #000000; ">-</span><span style="color: #008000; ">1</span><span style="color: #000000; ">].</span><span style="color: #000000; ">out</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">egressTC</span><span style="color: #000000; ">.</span><span style="color: #000000; ">in</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; "> &gt; </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">egressTCType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
        </span><span style="color: #000000; ">egressTC</span><span style="color: #000000; ">.</span><span style="color: #000000; ">out</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">--&gt;</span><span style="color: #000000; "> </span><span style="color: #000000; ">encap</span><span style="color: #000000; ">.</span><span style="color: #000000; ">upperLayerIn</span><span style="color: #000000; "> </span><span style="color: #800000; font-weight: bold; ">if</span><span style="color: #000000; "> </span><span style="color: #000000; ">numOutputHooks</span><span style="color: #000000; "> &gt; </span><span style="color: #008000; ">0</span><span style="color: #000000; "> &amp;&amp; </span><span style="color: #000000; ">egressTCType</span><span style="color: #000000; "> != </span><span style="color: #008000; ">&quot;&quot;</span><span style="color: #000000; ">;
}

</span></pre>
   </body>
</html>
